---
layout: post
title: "2015-01-08-Embed-Custom-Javascript-Library"
description: ""
category: R
tags: [rCharts, knitr]
customJS:
- jquery-1.9.1.min
- highcharts
- highcharts-more
- exporting
---
This is a quick example of producing a multiple bar chart using [rCharts]() package via implementing [HighCharts]() library. The original tutorial can be found in [rChart Gallery](http://rcharts.io/gallery/) but some functions are outdated as can be checked [here](https://github.com/ramnathv/rCharts/issues/251) - They are updated here.

Firstly _rCharts_ package needs to be installed from the GitHub repo if not installed.


{% highlight r %}
require(devtools)
install_github('rCharts', 'ramnathv')
{% endhighlight %}

The library is loaded.


{% highlight r %}
library(rCharts)
library(knitr)
{% endhighlight %}

The data is shown below.


{% highlight r %}
# Prepare data
x <- data.frame(USPersonalExpenditure)
colnames(x) <- substr(colnames(x), 2, 5)
kable(x)
{% endhighlight %}



|                    |   1940|   1945|  1950| 1955|  1960|
|:-------------------|------:|------:|-----:|----:|-----:|
|Food and Tobacco    | 22.200| 44.500| 59.60| 73.2| 86.80|
|Household Operation | 10.500| 15.500| 29.00| 36.5| 46.20|
|Medical and Health  |  3.530|  5.760|  9.71| 14.0| 21.10|
|Personal Care       |  1.040|  1.980|  2.45|  3.4|  5.40|
|Private Education   |  0.341|  0.974|  1.80|  2.6|  3.64|

The chart can be created as following. Note that the modified part is commented.


{% highlight r %}
# Create chart
a <- rCharts:::Highcharts$new() # modified
a$chart(type = "column")
a$title(text = "US Personal Expenditure")
a$xAxis(categories = rownames(x))
a$yAxis(title = list(text = "Billions of dollars"))
a$data(x)
{% endhighlight %}

Finally it is printed. Note that the `results` option should be set to be `'asis'`.


{% highlight r %}
# Print chart
a$print('chart 1', include_assets = TRUE) # modified
{% endhighlight %}

{% if page.customJS %}
  {% for file in page.customJS  %}
  <script src='/assets/src/{{ file }}.js' type="text/javascript"></script>
  {% endfor %}
{% endif %}

 <style>
  .rChart {
    display: block;
    margin-left: auto; 
    margin-right: auto;
    width: 800px;
    height: 400px;
  }  
  </style>
<div id = 'chart 1' class = 'rChart highcharts'></div>
<script type='text/javascript'>
    (function($){
        $(function () {
            var chart = new Highcharts.Chart({
 "dom": "chart 1",
"width":            800,
"height":            400,
"credits": {
 "href": null,
"text": null 
},
"exporting": {
 "enabled": false 
},
"title": {
 "text": "US Personal Expenditure" 
},
"yAxis": [
 {
 "title": {
 "text": "Billions of dollars" 
} 
} 
],
"chart": {
 "type": "column",
"renderTo": "chart 1" 
},
"xAxis": [
 {
 "categories": [ "Food and Tobacco", "Household Operation", "Medical and Health", "Personal Care", "Private Education" ] 
} 
],
"series": [
 {
 "name": "1940",
"data": [
           22.2,
          10.5,
          3.53,
          1.04,
         0.341 
] 
},
{
 "name": "1945",
"data": [
           44.5,
          15.5,
          5.76,
          1.98,
         0.974 
] 
},
{
 "name": "1950",
"data": [
           59.6,
            29,
          9.71,
          2.45,
           1.8 
] 
},
{
 "name": "1955",
"data": [
           73.2,
          36.5,
            14,
           3.4,
           2.6 
] 
},
{
 "name": "1960",
"data": [
           86.8,
          46.2,
          21.1,
           5.4,
          3.64 
] 
} 
],
"id": "chart 1" 
});
        });
    })(jQuery);
</script>

Note: _rCharts_ package is quite convenient but the chart didn't show when I pushed it into the blog repo. This was because 

- the auto-generated script tags were not parsed properly by _Jekyll_ as they were included in a paragraph tag (`<p></p>`)
- the paths were set according to the local paths which cannot be referenced in the remote repo as shown below.


{% highlight r %}
{% highlight r %}
# Print chart
a$print('chart 1', include_assets = TRUE) # modified
{% endhighlight %}

## script tags generated by rCharts cannot be referenced correctly as the paths are set according to the local machine as shown below.
<script type='text/javascript' src=/home/jaehyeon/R/x86_64-redhat-linux-gnu-library/3.1/rCharts/libraries/highcharts/js/jquery-1.9.1.min.js></script>
<script type='text/javascript' src=/home/jaehyeon/R/x86_64-redhat-linux-gnu-library/3.1/rCharts/libraries/highcharts/js/highcharts.js></script>
<script type='text/javascript' src=/home/jaehyeon/R/x86_64-redhat-linux-gnu-library/3.1/rCharts/libraries/highcharts/js/highcharts-more.js></script>
<script type='text/javascript' src=/home/jaehyeon/R/x86_64-redhat-linux-gnu-library/3.1/rCharts/libraries/highcharts/js/exporting.js></script>
{% endhighlight %}

In order to tackle down this issue, the following steps were followed.

- Download all javascript libraries and save it into */assets/src/* - [jQuery](http://code.jquery.com/jquery-1.9.1.min.js) and [highCharts-related](https://code.highcharts.com/) libraries were downloaded from their CDNs.
- Convert the Rmd file into a md file.
- Update YAML and add liquid logic in the md file - see [here](http://mattgemmell.com/page-specific-assets-with-jekyll/) for further details
- Commit and push

The upated YAML is shown below.


{% highlight r %}
---
layout: post
title: "2015-01-08-Embed-Custom-Javascript-Library"
description: ""
category: R
tags: [rCharts, knitr]
## customJS is added ##
customJS:
- jquery-1.9.1.min
- highcharts
- highcharts-more
- exporting
---
{% endhighlight %}

And the liquid logic used is as following. Note that the quotation marks that wrap `%` should be stripped out. They are kept as the code is either executed or not apppear correctly together.


{% highlight r %}
{'%' if page.customJS '%'}
  {'%' for file in page.customJS '%'}
    <script src='/assets/src/{{ file }}.js' type="text/javascript"></script>
  {'%' endfor '%'}
{'%' endif '%'}
{% endhighlight %}
