---
layout: post
title: "2015-01-08-Embed-Custom-Javascript-Library"
description: ""
category: R
tags: [rCharts, knitr]
---
{% include JB/setup %}

This is a quick example of producing a multiple bar chart using [rCharts]() package via implementing [HighCharts]() library. The original tutorial can be found in [rChart Gallery](http://rcharts.io/gallery/) but some functions are outdated as can be checked [here](https://github.com/ramnathv/rCharts/issues/251) - They are updated here.

Firstly _rCharts_ package needs to be installed from the GitHub repo if not installed.

```{r installPackages, eval=FALSE }
require(devtools)
install_github('rCharts', 'ramnathv')
```

The library is loaded.

```{r loadLibraries, message=FALSE, warning=FALSE}
library(rCharts)
library(knitr)
```

The data is shown below.

```{r prepareData, message=FALSE, warning=FALSE}
# Prepare data
x <- data.frame(USPersonalExpenditure)
colnames(x) <- substr(colnames(x), 2, 5)
kable(x)
```

The chart can be created as following. Note that the modified part is commented.

```{r createChart, message=FALSE, warning=FALSE}
# Create chart
a <- rCharts:::Highcharts$new() # modified
a$chart(type = "column")
a$title(text = "US Personal Expenditure")
a$xAxis(categories = rownames(x))
a$yAxis(title = list(text = "Billions of dollars"))
a$data(x)
```

Finally it is printed. Note that the `results` option should be set to be `'asis'`.

```{r printChart, message=FALSE, warning=FALSE, results='asis'}
# Print chart
a$print('chart 1', include_assets = TRUE) # modified
```

Note: _rCharts_ package is quite convenient but the chart didn't show when I pushed it into the blog repo. This was because 

- the auto-generated script tags were not parsed properly by _Jekyll_ as they were included in a paragraph tag (`<p></p>`)
- the paths were set according to the local paths which cannot be referenced in the remote repo as shown below.

```{r scriptTags, eval=FALSE}
{% highlight r %}
# Print chart
a$print('chart 1', include_assets = TRUE) # modified
{% endhighlight %}

## script tags generated by rCharts cannot be referenced correctly as the paths are set according to the local machine as shown below.
<script type='text/javascript' src=/home/jaehyeon/R/x86_64-redhat-linux-gnu-library/3.1/rCharts/libraries/highcharts/js/jquery-1.9.1.min.js></script>
<script type='text/javascript' src=/home/jaehyeon/R/x86_64-redhat-linux-gnu-library/3.1/rCharts/libraries/highcharts/js/highcharts.js></script>
<script type='text/javascript' src=/home/jaehyeon/R/x86_64-redhat-linux-gnu-library/3.1/rCharts/libraries/highcharts/js/highcharts-more.js></script>
<script type='text/javascript' src=/home/jaehyeon/R/x86_64-redhat-linux-gnu-library/3.1/rCharts/libraries/highcharts/js/exporting.js></script>
```

In order to tackle down this issue, the following steps were followed.

- Download all javascript libraries and save it into */assets/src/* - [jQuery](http://code.jquery.com/jquery-1.9.1.min.js) and [highCharts-related](https://code.highcharts.com/) libraries were downloaded from their CDNs.
- Convert the Rmd file into a md file.
- Update YAML and add liquid logic in the md file - see [here](http://mattgemmell.com/page-specific-assets-with-jekyll/) for further details
- Commit and push

The upated YAML is shown below.

```{r yamlMod, eval=FALSE}
---
layout: post
title: "2015-01-08-Embed-Custom-Javascript-Library"
description: ""
category: R
tags: [rCharts, knitr]
## customJS is added ##
customJS:
- jquery-1.9.1.min
- highcharts
- highcharts-more
- exporting
---
```

And the liquid logic used is as following (See the source if it doesn't appear correctly).

*{% if page.customJS %}*
*  {% for file in page.customJS  %}*
*  <script src='/assets/src/{{ file }}.js' type="text/javascript"></script>*
*  {% endfor %}*
*{% endif %}*

