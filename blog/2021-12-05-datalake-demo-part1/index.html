<!doctype html><html class=position-relative itemscope itemtype=http://schema.org/WebPage lang=en data-bs-theme=light data-palette=blue-gray><head><script src=/assets/init/bundle.min.c6bc3435372a5c0f294d5434bb5bf63963124d282c546af795b820a7174d321c.js integrity="sha256-xrw0NTcqXA8pTVQ0u1v2OWMSTSgsVGr3lbggpxdNMhw=" crossorigin=anonymous></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Data Lake Demo using Change Data Capture (CDC) on AWS – Part 1 Local Development - Jaehyeon</title><link rel=icon href=/favicon_huf63427acbec4fbe11db6a32164cc2763_6040_16x16_resize_q75_h2_box_2.webp sizes=16x16 type=image/webp><link rel=icon href=/favicon_huf63427acbec4fbe11db6a32164cc2763_6040_32x32_resize_q75_h2_box_2.webp sizes=32x32 type=image/webp><link rel=icon href=/favicon_huf63427acbec4fbe11db6a32164cc2763_6040_150x150_resize_q75_h2_box_2.webp sizes=150x150 type=image/webp><link rel=apple-touch-icon href=/favicon_huf63427acbec4fbe11db6a32164cc2763_6040_180x180_resize_q75_h2_box_2.webp sizes=180x180 type=image/webp><link rel=icon href=/favicon_huf63427acbec4fbe11db6a32164cc2763_6040_192x192_resize_q75_h2_box_2.webp sizes=192x192 type=image/webp><link rel=mask-icon href=/safari-pinned-tab.svg color=#6f42c1><meta name=keywords content="AWS,Data,Analytics,Containers,Serverless"><meta name=description content="Change data capture (CDC) on Amazon MSK and ingesting data using Apache Hudi on Amazon EMR can be used to build an efficient data lake solution. As a starting point, we’ll discuss the source database and CDC streaming infrastructure in the local environment."><meta name=robots content="index, follow"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jaehyeon.me/blog/2021-12-05-datalake-demo-part1/featured.png"><meta name=twitter:title content="Data Lake Demo using Change Data Capture (CDC) on AWS – Part 1 Local Development"><meta name=twitter:description content="Change data capture (CDC) on Amazon MSK and ingesting data using Apache Hudi on Amazon EMR can be used to build an efficient data lake solution. As a starting point, we’ll discuss the source database and CDC streaming infrastructure in the local environment."><meta property="og:title" content="Data Lake Demo using Change Data Capture (CDC) on AWS – Part 1 Local Development"><meta property="og:description" content="Change data capture (CDC) on Amazon MSK and ingesting data using Apache Hudi on Amazon EMR can be used to build an efficient data lake solution. As a starting point, we’ll discuss the source database and CDC streaming infrastructure in the local environment."><meta property="og:type" content="article"><meta property="og:url" content="https://jaehyeon.me/blog/2021-12-05-datalake-demo-part1/"><meta property="og:image" content="https://jaehyeon.me/blog/2021-12-05-datalake-demo-part1/featured.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-12-05T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-14T10:32:29+10:00"><meta property="og:see_also" content="https://jaehyeon.me/blog/2021-12-19-datalake-demo-part3/"><meta property="og:see_also" content="https://jaehyeon.me/blog/2021-12-12-datalake-demo-part2/"><meta itemprop=name content="Data Lake Demo using Change Data Capture (CDC) on AWS – Part 1 Local Development"><meta itemprop=description content="Change data capture (CDC) on Amazon MSK and ingesting data using Apache Hudi on Amazon EMR can be used to build an efficient data lake solution. As a starting point, we’ll discuss the source database and CDC streaming infrastructure in the local environment."><meta itemprop=datePublished content="2021-12-05T00:00:00+00:00"><meta itemprop=dateModified content="2023-04-14T10:32:29+10:00"><meta itemprop=wordCount content="3712"><meta itemprop=image content="https://jaehyeon.me/blog/2021-12-05-datalake-demo-part1/featured.png"><meta itemprop=keywords content="AWS,Amazon EMR,Amazon MSK,Amazon MSK Connect,Apache Spark,Apache Hudi,Apache Kafka,Change Data Capture,Data Lake,Docker,Docker Compose,"><link rel=manifest href=/manifest.json><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2764466088407958"></script>
<link data-precache rel=stylesheet href="/assets/main/bundle.min.58b5d95a736352dbba074d789c4e2dc9bfbc282c6ba3309e9225471726917ee1.css" integrity="sha256-WLXZWnNjUtu6B014nE4tyb+8KCxrozCekiVHFyaRfuE=" crossorigin=anonymous><link data-precache rel=stylesheet href=/assets/katex/bundle.min.222aac0b0b2e29944e5e468ecbd302b4ece09ac5ee29a0c811086b03659edd76.css integrity="sha256-IiqsCwsuKZROXkaOy9MCtOzgmsXuKaDIEQhrA2We3XY=" crossorigin=anonymous><link data-precache rel=stylesheet href=/assets/viewer/bundle.min.eb914844636cd41f221f109e99c887bbc3b6b5ffb2af7c664b284cea2d1b54b7.css integrity="sha256-65FIRGNs1B8iHxCemciHu8O2tf+yr3xmSyhM6i0bVLc=" crossorigin=anonymous></head><body><header><nav class="top-app-bar shadow navbar navbar-expand-xxl fixed-top"><div class=container><a class="navbar-brand d-flex align-items-center flex-grow-1 flex-xxl-grow-0 justify-content-xxl-start ms-2 ms-xxl-0 mx-auto me-xxl-2" href=https://jaehyeon.me/>Jaehyeon Kim</a><div class="offcanvas-xxl offcanvas-end flex-grow-1" data-bs-scroll=true tabindex=-1 id=navbarMenus aria-labelledby=navbarMenusLabel><div class="offcanvas-header px-4 pb-0"><div class="offcanvas-title h5" id=navbarMenusLabel>Jaehyeon Kim</div><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas data-bs-target=#navbarMenus aria-label=Close></button></div><div class="offcanvas-body p-4 pt-0 p-xxl-0"><hr class=d-xxl-none><ul class="navbar-nav flex-row flex-wrap align-items-center me-auto"><li class="nav-item col-12 col-xxl-auto dropdown px-0"><a href=# class="nav-link dropdown-toggle" id=navbarDropdownBlog role=button data-bs-toggle=dropdown aria-expanded=false><span class="menu-icon me-1"><i class="fas fa-fw fa-blog text-warning"></i></span>Blog</a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=navbarDropdownBlog data-bs-popper=none><li><a class="dropdown-item d-flex align-items-center text-wrap text-xxl-nowrap" href=https://jaehyeon.me/archives/><span class="dropdown-item-icon me-2 p-2 rounded"><i class="fas fa-fw fa-file-archive text-primary"></i></span><div class=dropdown-item-content><p class="dropdown-item-title mb-0">Archives</p></div></a></li><li><a class="dropdown-item d-flex align-items-center text-wrap text-xxl-nowrap" href=https://jaehyeon.me/series/><span class="dropdown-item-icon me-2 p-2 rounded"><i class="fas fa-fw fa-columns"></i></span><div class=dropdown-item-content><p class="dropdown-item-title mb-1">Series</p><p class="dropdown-item-description mb-0 text-secondary">List of series.</p></div></a></li><li><a class="dropdown-item d-flex align-items-center text-wrap text-xxl-nowrap" href=https://jaehyeon.me/categories/><span class="dropdown-item-icon me-2 p-2 rounded"><i class="fas fa-fw fa-folder text-success"></i></span><div class=dropdown-item-content><p class="dropdown-item-title mb-1">Categories</p><p class="dropdown-item-description mb-0 text-secondary">List of categories.</p></div></a></li><li><a class="dropdown-item d-flex align-items-center text-wrap text-xxl-nowrap" href=https://jaehyeon.me/tags/><span class="dropdown-item-icon me-2 p-2 rounded"><i class="fas fa-fw fa-tags"></i></span><div class=dropdown-item-content><p class="dropdown-item-title mb-1">Tags</p><p class="dropdown-item-description mb-0 text-secondary">List of tags.</p></div></a></li></ul></li></ul><hr class=d-xxl-none><form class="search-bar ms-auto my-1" action=/search/ novalidate><div class="input-group input-group-sm align-items-center"><span class="btn btn-search disabled position-absolute left-0 border-0 px-1"><i class="fas fa-fw fa-search fa-lg"></i></span>
<input class="my-1 form-control border-white rounded search-input bg-body" name=q type=search placeholder="Press / to search" aria-label=Search required></div></form><hr class=d-xxl-none><ul class="navbar-nav flex-row flex-wrap align-items-center ms-md-auto"><li class="nav-item py-2 py-xxl-1 col-12 col-xxl-auto"><nav class="social-links nav justify-content-center flex-row"><a class="nav-link social-link col-6 col-xxl-auto p-1" target=_blank href=https://github.com/jaehyeon-kim title=GitHub rel=me><i class="fa-fw fab fa-github"></i>
<span class="ms-1 d-xxl-none">Github</span></a>
<a class="nav-link social-link col-6 col-xxl-auto p-1" target=_blank href=https://linkedin.com/in/jaehyeon-kim-76b93429 title=LinkedIn rel=me><i class="fa-fw fab fa-linkedin-in"></i>
<span class="ms-1 d-xxl-none">Linkedin</span></a>
<a class="nav-link social-link col-6 col-xxl-auto p-1" target=_blank href=https://www.paypal.com/paypalme/dottami title=PayPal rel=me><i class="fa-fw fab fa-paypal"></i>
<span class="ms-1 d-xxl-none">Paypal</span></a>
<a class="nav-link social-link col-6 col-xxl-auto p-1" target=_blank href=/index.xml title=RSS rel=me><i class="fas fa-fw fa-rss"></i>
<span class="ms-1 d-xxl-none">RSS</span></a></nav></li><li class="nav-item py-2 py-xxl-1 col-12 col-xxl-auto"><div class="vr d-none d-xxl-flex h-100 mx-xxl-2 text-white"></div><hr class="d-xxl-none my-2"></li><li class="nav-item dropdown py-1 py-xxl-1 col-6 col-xxl-auto"><a class="nav-link px-0 px-xxl-1" href=# id=languageDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-globe"></i>
<span class=d-xxl-none>Language</span></a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=languageDropdown><li><a class="dropdown-item active" href=/>English</a></li><li><a class=dropdown-item href=/zh-cn/></a></li></ul></li><li class="nav-item py-1 col-12 col-xxl-auto"><div class="vr d-none d-xxl-flex h-100 mx-xxl-2 text-white"></div><hr class="d-xxl-none my-2"></li><li class="nav-item dropdown col-6 col-xxl-auto"><a class="nav-link px-0 py-2 px-xxl-1" href=# id=fontSizeDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-font"></i>
<span class=d-xxl-none>Font Size</span></a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=fontSizeDropdown><li><button class="font-size-item dropdown-item" data-size=xs>
Extra Small</button></li><li><button class="font-size-item dropdown-item" data-size=sm>
Small</button></li><li><button class="font-size-item dropdown-item active" data-size=md>
Medium</button></li><li><button class="font-size-item dropdown-item" data-size=lg>
Large</button></li><li><button class="font-size-item dropdown-item" data-size=xl>
Extra Large</button></li></ul></li><li class="nav-item dropdown col-6 col-xxl-auto"><a class="nav-link px-0 py-2 px-xxl-1" href=# id=paletteDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-palette"></i>
<span class=d-xxl-none>Palette</span></a><ul class="palette-dropdown-menu dropdown-menu dropdown-menu-end px-2 row g-2" aria-labelledby=paletteDropdown><li class="col-4 my-1"><a role=button id=palette-blue aria-label=Blue class="btn btn-sm w-100 palette text-bg-blue" data-palette=blue></a></li><li class="col-4 my-1"><a role=button id=palette-blue-gray aria-label="Blue Gray" class="btn btn-sm w-100 palette text-bg-blue-gray" data-palette=blue-gray></a></li><li class="col-4 my-1"><a role=button id=palette-brown aria-label=Brown class="btn btn-sm w-100 palette text-bg-brown" data-palette=brown></a></li><li class="col-4 my-1"><a role=button id=palette-cyan aria-label=Cyan class="btn btn-sm w-100 palette text-bg-cyan" data-palette=cyan></a></li><li class="col-4 my-1"><a role=button id=palette-green aria-label=Green class="btn btn-sm w-100 palette text-bg-green" data-palette=green></a></li><li class="col-4 my-1"><a role=button id=palette-indigo aria-label=Indigo class="btn btn-sm w-100 palette text-bg-indigo" data-palette=indigo></a></li><li class="col-4 my-1"><a role=button id=palette-orange aria-label=Orange class="btn btn-sm w-100 palette text-bg-orange" data-palette=orange></a></li><li class="col-4 my-1"><a role=button id=palette-pink aria-label=Pink class="btn btn-sm w-100 palette text-bg-pink" data-palette=pink></a></li><li class="col-4 my-1"><a role=button id=palette-purple aria-label=Purple class="btn btn-sm w-100 palette text-bg-purple" data-palette=purple></a></li><li class="col-4 my-1"><a role=button id=palette-red aria-label=Red class="btn btn-sm w-100 palette text-bg-red" data-palette=red></a></li><li class="col-4 my-1"><a role=button id=palette-teal aria-label=Teal class="btn btn-sm w-100 palette text-bg-teal" data-palette=teal></a></li><li class="col-4 my-1"><a role=button id=palette-yellow aria-label=Yellow class="btn btn-sm w-100 palette text-bg-yellow" data-palette=yellow></a></li></ul></li><li class="nav-item dropdown col-6 col-xxl-auto"><a class="nav-link px-0 py-2 px-xxl-1" href=# id=modeDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="mode-icon fas fa-fw fa-sun" id=modeIcon></i>
<span class=d-xxl-none>Mode</span></a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=modeDropdown><li class="mode-item active" data-color-mode=light data-icon=sun><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-sun"></i> Light</button></li><li class=mode-item data-color-mode=dark data-icon=moon><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-moon"></i> Dark</button></li><li class=mode-item data-color-mode=auto data-icon=adjust><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-adjust"></i> Auto</button></li></ul></li></ul></div></div><div class=d-flex><button class="navbar-toggler order-5 border-0" type=button data-bs-toggle=offcanvas data-bs-target=#navbarMenus aria-controls=navbarMenus aria-expanded=false aria-label="Toggle navigation">
<i class="fas fa-ellipsis-h"></i></button></div></div></nav></header><main class=container><div class="row content"><noscript><div class="alert alert-danger" role=alert>Your browser does not support JavaScript.</div></noscript><div class=col-xxl-8><div class=container><nav class="row card component" aria-label=breadcrumb><div class="card-body pb-0"><ol class="hbs-breadcrumb breadcrumb flex-nowrap"><li class="breadcrumb-item text-surface"><a href=/>Home</a></li><li class="breadcrumb-item text-surface"><a href=/blog/>Blogs</a></li><li class="breadcrumb-item active">Data Lake Demo Using Change Data Capture (CDC) on AWS – Part 1 Local Development</li></ol></div></nav><div class="post-panel-wrapper position-relative d-flex justify-content-center"><div class="d-flex flex-row justify-content-center rounded rounded-5 border border-primary post-panel position-fixed px-3 py-1 surface shadow"><a class="action action-toc d-none d-xxl-block" href=#postTOC role=button title="Table of contents"><i class="fas fa-fw fa-list-alt"></i></a>
<a class="action action-toc d-block d-xxl-none" href=#post-toc-container role=button title="Table of contents"><i class="fas fa-fw fa-list-alt"></i></a>
<a class="action action-post-comments" href=#post-comments role=button aria-label=Comments title=Comments><i class="fas fa-fw fa-comments"></i></a>
<a id=sidebarToggler class="action action-sidebar-toggler d-none d-xxl-block" role=button title="Sidebar toggler"><i class="fas fa-fw fa-expand-alt" data-fa-transform=rotate-45></i></a></div></div><article class="row card component mb-4 post"><div class=card-header><h1 class="card-title post-title my-2">Data Lake Demo Using Change Data Capture (CDC) on AWS – Part 1 Local Development</h1></div><div class=card-body><div class="post-meta mb-3"><span class="post-date me-1 mb-1" title="created on 2021-12-05 00:00:00 +0000 UTC, updated on 2023-04-14 00:32:29 +0000 UTC.">December 5, 2021</span><span class="post-reading-time me-1 mb-1">18 min read</span><a href=/categories/data-engineering/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-category">
<i class="fas fa-fw fa-folder me-1"></i>Data Engineering</a><a href=/series/data-lake-demo-using-change-data-capture/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-series">
<i class="fas fa-fw fa-columns me-1"></i>Data Lake Demo Using Change Data Capture</a><a href=/tags/amazon-emr/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Amazon EMR</a><a href=/tags/amazon-msk/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Amazon MSK</a><a href=/tags/amazon-msk-connect/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Amazon MSK Connect</a><a href=/tags/apache-hudi/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Apache Hudi</a><a href=/tags/apache-kafka/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Apache Kafka</a><a href=/tags/apache-spark/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Apache Spark</a><a href=/tags/aws/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">AWS</a><a href=/tags/change-data-capture/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Change Data Capture</a><a href=/tags/data-lake/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Data Lake</a><a href=/tags/docker/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Docker</a><a href=/tags/docker-compose/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Docker Compose</a></div><picture class="d-flex justify-content-center"><source srcset=/blog/2021-12-05-datalake-demo-part1/featured_hua25eccd3824300d3b1ed87f56797248c_164526_0x270_resize_box_3.png type=image/png media="(max-width: 576px)" width=588 height=270><img class="post-featured-img h-auto w-auto mb-3" alt="Data Lake Demo using Change Data Capture (CDC) on AWS – Part 1 Local Development" src=/blog/2021-12-05-datalake-demo-part1/featured_hua25eccd3824300d3b1ed87f56797248c_164526_0x480_resize_box_3.png width=1046 height=480 data-src=/blog/2021-12-05-datalake-demo-part1/featured.png></picture><div id=postTOC class="mb-3 text-surface"><h2 class=mb-3>Contents<a class="anchor ms-1" href=#postTOC></a></h2><nav id=TableOfContents><ul><li><a href=#architecture>Architecture</a></li><li><a href=#source-database>Source Database</a><ul><li><a href=#data-model>Data Model</a></li><li><a href=#outbox-table-and-event-generation>Outbox Table and Event Generation</a></li><li><a href=#create-initial-event-records>Create Initial Event Records</a></li><li><a href=#create-publication>Create Publication</a></li></ul></li><li><a href=#cdc-development>CDC Development</a><ul><li><a href=#docker-compose>Docker Compose</a><ul><li><a href=#install-connectors>Install Connectors</a></li></ul></li><li><a href=#start-services>Start Services</a></li><li><a href=#create-connectors>Create Connectors</a><ul><li><a href=#source-connector>Source Connector</a></li><li><a href=#sink-connector>Sink Connector</a></li></ul></li></ul></li><li><a href=#check-event-output-files>Check Event Output Files</a><ul><li><ul><li><a href=#update-event-example>Update Event Example</a></li><li><a href=#insert-event-example>Insert Event Example</a></li></ul></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav><hr class=text-secondary></div><div class="post-content mb-3" data-bs-spy=scroll data-bs-target=#TableOfContents tabindex=0><div id=post-content-body><p><strong><a href=https://cevo.com.au/post/data-lake-demo-using-cdc-part-1/ target=_blank rel="noopener noreferrer">This article<i class="fas fa-external-link-square-alt ms-1"></i></a> was originally posted on Tech Insights of <a href=https://cevo.com.au/ target=_blank rel="noopener noreferrer">Cevo Australia<i class="fas fa-external-link-square-alt ms-1"></i></a>.</strong></p><p><a href=https://www.redhat.com/en/topics/integration/what-is-change-data-capture#what-is-cdc target=_blank rel="noopener noreferrer">Change data capture (CDC)<i class="fas fa-external-link-square-alt ms-1"></i></a> is a proven data integration pattern that has a wide range of applications. Among those, data replication to data lakes is a good use case in data engineering. Coupled with <a href=https://lakefs.io/hudi-iceberg-and-delta-lake-data-lake-table-formats-compared/ target=_blank rel="noopener noreferrer">best-in-breed data lake formats<i class="fas fa-external-link-square-alt ms-1"></i></a> such as <a href=https://hudi.apache.org/ target=_blank rel="noopener noreferrer">Apache Hudi<i class="fas fa-external-link-square-alt ms-1"></i></a>, we can build an efficient data replication solution. This is the first post of the data lake demo series. Over time, we&rsquo;ll build a data lake that uses CDC. As a starting point, we&rsquo;ll discuss the source database and CDC streaming infrastructure in the local environment.</p><ul><li><a href=/blog/2021-12-05-datalake-demo-part1/#>Part 1 Local Development</a> (this post)</li><li><a href=/blog/2021-12-12-datalake-demo-part2>Part 2 Implement CDC</a></li><li><a href=/blog/2021-12-19-datalake-demo-part3>Part 3 Implement Data Lake</a></li></ul><h2 id=architecture data-numberify>Architecture<a class="anchor ms-1" href=#architecture></a></h2><p>As described in a <a href=https://www.redhat.com/en/topics/integration/what-is-change-data-capture target=_blank rel="noopener noreferrer">Red Hat IT topics article<i class="fas fa-external-link-square-alt ms-1"></i></a>, <em>change data capture (CDC) is a proven data integration pattern to track when and what changes occur in data then alert other systems and services that must respond to those changes. Change data capture helps maintain consistency and functionality across all systems that rely on data</em>.</p><p>The primary use of CDC is to enable applications to respond almost immediately whenever data in databases change. Specifically its use cases cover microservices integration, data replication with up-to-date data, building time-sensitive analytics dashboards, auditing and compliance, cache invalidation, full-text search and so on. There are a number of approaches for CDC - polling, dual writes and log-based CDC. Among those, <a href=https://debezium.io/blog/2018/07/19/advantages-of-log-based-change-data-capture/ target=_blank rel="noopener noreferrer">log-based CDC has advantages<i class="fas fa-external-link-square-alt ms-1"></i></a> to other approaches.</p><p>Both <a href=https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Task.CDC.html target=_blank rel="noopener noreferrer">Amazon DMS<i class="fas fa-external-link-square-alt ms-1"></i></a> and <a href=https://debezium.io/ target=_blank rel="noopener noreferrer">Debezium<i class="fas fa-external-link-square-alt ms-1"></i></a> implement log-based CDC. While the former is a managed service, the latter can be deployed to a Kafka cluster as a (source) connector. It uses <a href=https://www.redhat.com/en/topics/integration/what-is-apache-kafka target=_blank rel="noopener noreferrer">Apache Kafka<i class="fas fa-external-link-square-alt ms-1"></i></a> as a messaging service to deliver database change notifications to the applicable systems and applications. Note that Kafka Connect is a tool for streaming data between Apache Kafka and other data systems by connectors in a scalable and reliable way. In AWS, we can use <a href=https://aws.amazon.com/msk/ target=_blank rel="noopener noreferrer">Amazon MSK<i class="fas fa-external-link-square-alt ms-1"></i></a> and <a href=https://aws.amazon.com/msk/features/msk-connect/ target=_blank rel="noopener noreferrer">MSK Connect<i class="fas fa-external-link-square-alt ms-1"></i></a> for building a Debezium based CDC solution.</p><p>Data replication to data lakes using CDC can be much more effective if <a href=https://lakefs.io/hudi-iceberg-and-delta-lake-data-lake-table-formats-compared/ target=_blank rel="noopener noreferrer">data is stored to a format<i class="fas fa-external-link-square-alt ms-1"></i></a> that supports atomic transactions and consistent updates. Popular choices are <a href=https://hudi.apache.org/ target=_blank rel="noopener noreferrer">Apache Hudi<i class="fas fa-external-link-square-alt ms-1"></i></a>, <a href=https://iceberg.apache.org/ target=_blank rel="noopener noreferrer">Apache Iceberg<i class="fas fa-external-link-square-alt ms-1"></i></a> and <a href=https://delta.io/ target=_blank rel="noopener noreferrer">Delta Lake<i class="fas fa-external-link-square-alt ms-1"></i></a>. Among those, Apache Hudi can be a good option as it is <a href=https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-hudi.html target=_blank rel="noopener noreferrer">well-integrated with AWS services<i class="fas fa-external-link-square-alt ms-1"></i></a>.</p><p>Below shows the architecture of the data lake solution that we will be building in this series of posts.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2021-12-05-datalake-demo-part1/00-01-architecture.png loading=lazy width=1301 height=535></picture></p><ol><li>Employing the <a href=https://microservices.io/patterns/data/transactional-outbox.html target=_blank rel="noopener noreferrer">transactional outbox pattern<i class="fas fa-external-link-square-alt ms-1"></i></a>, the source database publishes change event records to the CDC event table. The event records are generated by triggers that listen to insert and update events on source tables.</li><li>CDC is implemented in a streaming environment and <a href=https://aws.amazon.com/msk/ target=_blank rel="noopener noreferrer">Amazon MSK<i class="fas fa-external-link-square-alt ms-1"></i></a> is used to build the streaming infrastructure. In order to process the real-time CDC event records, a source and sink connectors are set up in <a href=https://aws.amazon.com/msk/features/msk-connect/ target=_blank rel="noopener noreferrer">Amazon MSK Connect<i class="fas fa-external-link-square-alt ms-1"></i></a>. The <a href=https://debezium.io/documentation/reference/stable/connectors/postgresql.html target=_blank rel="noopener noreferrer">Debezium connector for PostgreSQL<i class="fas fa-external-link-square-alt ms-1"></i></a> is used as the source connector and the <a href=https://lenses.io/blog/2020/11/new-kafka-to-S3-connector/ target=_blank rel="noopener noreferrer">Lenses S3 connector<i class="fas fa-external-link-square-alt ms-1"></i></a> is used as the sink connector. The sink connector pushes messages to a S3 bucket.</li><li><a href=https://hudi.apache.org/docs/writing_data/#deltastreamer target=_blank rel="noopener noreferrer">Hudi DeltaStreamer<i class="fas fa-external-link-square-alt ms-1"></i></a> is run on <a href=https://aws.amazon.com/emr/ target=_blank rel="noopener noreferrer">Amazon EMR<i class="fas fa-external-link-square-alt ms-1"></i></a>. As a spark application, it reads files from the S3 bucket and upserts Hudi records to another S3 bucket. The Hudi table is created in the AWS Glue Data Catalog.</li><li>The Hudi table is queried in <a href=https://aws.amazon.com/athena/ target=_blank rel="noopener noreferrer">Amazon Athena<i class="fas fa-external-link-square-alt ms-1"></i></a> while the table is registered in the AWS Glue Data Catalog.</li><li>Dashboards are created in <a href=https://aws.amazon.com/quicksight/ target=_blank rel="noopener noreferrer">Amazon Quicksight<i class="fas fa-external-link-square-alt ms-1"></i></a> where the dataset is created using Amazon Athena.</li></ol><p>As a starting point, we&rsquo;ll discuss the source database and streaming infrastructure in the local environment.</p><h2 id=source-database data-numberify>Source Database<a class="anchor ms-1" href=#source-database></a></h2><h3 id=data-model data-numberify>Data Model<a class="anchor ms-1" href=#data-model></a></h3><p>We will use the Northwind database as the source database. It was originally created by Microsoft and used by various tutorials of their database products. It contains the sales data for a fictitious company called <em>Northwind Traders</em> that deals with specialty foods from around the world. As shown in the following entity relationship diagram, it includes a schema for a small business ERP with customers, products, orders, employees and so on. The version that is ported to PostgreSQL is obtained from <a href=https://docs.yugabyte.com/latest/sample-data/northwind/ target=_blank rel="noopener noreferrer">YugabyteDB sample datasets<i class="fas fa-external-link-square-alt ms-1"></i></a> and the SQL scripts can be found in the project <a href=https://github.com/jaehyeon-kim/data-lake-demo/tree/main/data/sql target=_blank rel="noopener noreferrer"><strong>GitHub repository</strong><i class="fas fa-external-link-square-alt ms-1"></i></a>. For local development, a service is created using docker compose, and it&rsquo;ll be illustrated in the next section.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2021-12-05-datalake-demo-part1/00-02-datalake-er.png loading=lazy width=620 height=738></picture></p><h3 id=outbox-table-and-event-generation data-numberify>Outbox Table and Event Generation<a class="anchor ms-1" href=#outbox-table-and-event-generation></a></h3><p>It is straightforward to capture changes from multiple tables in a database using Kafka connectors where a separate topic is created for each table. Data ingestion to Hudi, however, can be complicated if messages are stored in multiple Kafka topics. Note that we will use the <a href=https://hudi.apache.org/docs/writing_data/#deltastreamer target=_blank rel="noopener noreferrer">DeltaStreamer<i class="fas fa-external-link-square-alt ms-1"></i></a> utility, and it maps to a single topic. In order to simplify the data ingestion process, we can employ the <a href=https://microservices.io/patterns/data/transactional-outbox.html target=_blank rel="noopener noreferrer">transactional outbox pattern<i class="fas fa-external-link-square-alt ms-1"></i></a>. Using this pattern, we can create an outbox table (<code>cdc_events</code>) and <em>upsert</em> a record to it when a new transaction is made. In this way, all database changes can be pushed to a single topic, resulting in one DeltaStreamer process to listen to the change events.</p><p>Below shows the table creation statement of the outbox table. It aims to store all details of an order entry in a row. The columns that have the JSONB data type store attributes of other entities. For example, the <em>order_items</em> column includes ordered product information. As multiple products can be purchased, it keeps an array of product ID, unit price, quantity and discount.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=ln> 1</span><span class=cl><span class=c1>-- ./data/sql/03_cdc_events.sql
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>cdc_events</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>    </span><span class=n>order_id</span><span class=w>        </span><span class=nb>SMALLINT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=n>customer_id</span><span class=w>     </span><span class=n>BPCHAR</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>    </span><span class=n>order_date</span><span class=w>      </span><span class=nb>DATE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>    </span><span class=n>required_date</span><span class=w>   </span><span class=nb>DATE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=n>shipped_date</span><span class=w>    </span><span class=nb>DATE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=n>order_items</span><span class=w>     </span><span class=n>JSONB</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span><span class=n>products</span><span class=w>        </span><span class=n>JSONB</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>    </span><span class=n>customer</span><span class=w>        </span><span class=n>JSONB</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span><span class=n>employee</span><span class=w>        </span><span class=n>JSONB</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span><span class=n>shipper</span><span class=w>         </span><span class=n>JSONB</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>    </span><span class=n>shipment</span><span class=w>        </span><span class=n>JSONB</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>    </span><span class=n>updated_at</span><span class=w>      </span><span class=n>TIMESTAMPTZ</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>In order to create event records, triggers are added to the <em>orders</em> and <em>order_details</em> tables. They execute the <code>fn_insert_order_event</code> function after an INSERT or UPDATE action occurs to the respective tables. Note the DELETE action is not considered in the event generation process for simplicity. The trigger function basically collects details of an order entry and attempts to insert a new record to the outbox table. If a record with the same order ID exists, it updates the record instead.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=ln>  1</span><span class=cl><span class=c1>-- ./data/sql/03_cdc_events.sql
</span></span></span><span class=line><span class=ln>  2</span><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=n>orders_triggered</span><span class=w>
</span></span></span><span class=line><span class=ln>  3</span><span class=cl><span class=w>  </span><span class=k>AFTER</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>UPDATE</span><span class=w>
</span></span></span><span class=line><span class=ln>  4</span><span class=cl><span class=w>  </span><span class=k>ON</span><span class=w> </span><span class=n>orders</span><span class=w>
</span></span></span><span class=line><span class=ln>  5</span><span class=cl><span class=w>  </span><span class=k>FOR</span><span class=w> </span><span class=k>EACH</span><span class=w> </span><span class=k>ROW</span><span class=w>
</span></span></span><span class=line><span class=ln>  6</span><span class=cl><span class=w>  </span><span class=k>EXECUTE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>fn_insert_order_event</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln>  7</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln>  8</span><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=n>order_details_triggered</span><span class=w>
</span></span></span><span class=line><span class=ln>  9</span><span class=cl><span class=w>  </span><span class=k>AFTER</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>UPDATE</span><span class=w>
</span></span></span><span class=line><span class=ln> 10</span><span class=cl><span class=w>  </span><span class=k>ON</span><span class=w> </span><span class=n>order_details</span><span class=w>
</span></span></span><span class=line><span class=ln> 11</span><span class=cl><span class=w>  </span><span class=k>FOR</span><span class=w> </span><span class=k>EACH</span><span class=w> </span><span class=k>ROW</span><span class=w>
</span></span></span><span class=line><span class=ln> 12</span><span class=cl><span class=w>  </span><span class=k>EXECUTE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>fn_insert_order_event</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln> 13</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 14</span><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>fn_insert_order_event</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=ln> 15</span><span class=cl><span class=w>    </span><span class=k>RETURNS</span><span class=w> </span><span class=k>TRIGGER</span><span class=w>
</span></span></span><span class=line><span class=ln> 16</span><span class=cl><span class=w>    </span><span class=k>LANGUAGE</span><span class=w> </span><span class=n>PLPGSQL</span><span class=w>
</span></span></span><span class=line><span class=ln> 17</span><span class=cl><span class=w>    </span><span class=k>AS</span><span class=w>
</span></span></span><span class=line><span class=ln> 18</span><span class=cl><span class=w></span><span class=err>$$</span><span class=w>
</span></span></span><span class=line><span class=ln> 19</span><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=ln> 20</span><span class=cl><span class=w>    </span><span class=k>IF</span><span class=w> </span><span class=p>(</span><span class=n>TG_OP</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;INSERT&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;UPDATE&#39;</span><span class=p>))</span><span class=w> </span><span class=k>THEN</span><span class=w>
</span></span></span><span class=line><span class=ln> 21</span><span class=cl><span class=w>        </span><span class=k>WITH</span><span class=w> </span><span class=n>product_details</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln> 22</span><span class=cl><span class=w>            </span><span class=k>SELECT</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>product_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 23</span><span class=cl><span class=w>                  </span><span class=n>row_to_json</span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=o>*</span><span class=p>)::</span><span class=n>jsonb</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>product_details</span><span class=w>
</span></span></span><span class=line><span class=ln> 24</span><span class=cl><span class=w>            </span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln> 25</span><span class=cl><span class=w>                </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=ln> 26</span><span class=cl><span class=w>                </span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=ln> 27</span><span class=cl><span class=w>                </span><span class=k>JOIN</span><span class=w> </span><span class=n>suppliers</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>supplier_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>supplier_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 28</span><span class=cl><span class=w>                </span><span class=k>JOIN</span><span class=w> </span><span class=n>categories</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>category_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>category_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 29</span><span class=cl><span class=w>            </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=ln> 30</span><span class=cl><span class=w>        </span><span class=p>),</span><span class=w> </span><span class=n>order_items</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln> 31</span><span class=cl><span class=w>            </span><span class=k>SELECT</span><span class=w> </span><span class=n>od</span><span class=p>.</span><span class=n>order_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 32</span><span class=cl><span class=w>                  </span><span class=n>jsonb_agg</span><span class=p>(</span><span class=n>row_to_json</span><span class=p>(</span><span class=n>od</span><span class=p>.</span><span class=o>*</span><span class=p>)::</span><span class=n>jsonb</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=s1>&#39;order_id&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>order_items</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 33</span><span class=cl><span class=w>                  </span><span class=n>jsonb_agg</span><span class=p>(</span><span class=n>pd</span><span class=p>.</span><span class=n>product_details</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>products</span><span class=w>
</span></span></span><span class=line><span class=ln> 34</span><span class=cl><span class=w>            </span><span class=k>FROM</span><span class=w> </span><span class=n>order_details</span><span class=w> </span><span class=n>od</span><span class=w>
</span></span></span><span class=line><span class=ln> 35</span><span class=cl><span class=w>            </span><span class=k>JOIN</span><span class=w> </span><span class=n>product_details</span><span class=w> </span><span class=n>pd</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>od</span><span class=p>.</span><span class=n>product_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pd</span><span class=p>.</span><span class=n>product_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 36</span><span class=cl><span class=w>            </span><span class=k>WHERE</span><span class=w> </span><span class=n>od</span><span class=p>.</span><span class=n>order_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>order_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 37</span><span class=cl><span class=w>            </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>od</span><span class=p>.</span><span class=n>order_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 38</span><span class=cl><span class=w>        </span><span class=p>),</span><span class=w> </span><span class=n>emps</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln> 39</span><span class=cl><span class=w>            </span><span class=k>SELECT</span><span class=w> </span><span class=n>employee_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 40</span><span class=cl><span class=w>                  </span><span class=n>row_to_json</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=o>*</span><span class=p>)::</span><span class=n>jsonb</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>details</span><span class=w>
</span></span></span><span class=line><span class=ln> 41</span><span class=cl><span class=w>            </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=n>e</span><span class=w>
</span></span></span><span class=line><span class=ln> 42</span><span class=cl><span class=w>        </span><span class=p>),</span><span class=w> </span><span class=n>emp_territories</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln> 43</span><span class=cl><span class=w>            </span><span class=k>SELECT</span><span class=w> </span><span class=n>et</span><span class=p>.</span><span class=n>employee_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 44</span><span class=cl><span class=w>                  </span><span class=n>jsonb_agg</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln> 45</span><span class=cl><span class=w>                    </span><span class=n>row_to_json</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=o>*</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln> 46</span><span class=cl><span class=w>                  </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>territories</span><span class=w>
</span></span></span><span class=line><span class=ln> 47</span><span class=cl><span class=w>            </span><span class=k>FROM</span><span class=w> </span><span class=n>employee_territories</span><span class=w> </span><span class=n>et</span><span class=w>
</span></span></span><span class=line><span class=ln> 48</span><span class=cl><span class=w>            </span><span class=k>JOIN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln> 49</span><span class=cl><span class=w>                </span><span class=k>SELECT</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>territory_id</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>territory_description</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>region_id</span><span class=p>,</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>region_description</span><span class=w>
</span></span></span><span class=line><span class=ln> 50</span><span class=cl><span class=w>                </span><span class=k>FROM</span><span class=w> </span><span class=n>territories</span><span class=w> </span><span class=n>t</span><span class=w>
</span></span></span><span class=line><span class=ln> 51</span><span class=cl><span class=w>                </span><span class=k>JOIN</span><span class=w> </span><span class=n>region</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>region_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>region_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 52</span><span class=cl><span class=w>            </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>et</span><span class=p>.</span><span class=n>territory_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>territory_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 53</span><span class=cl><span class=w>            </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>et</span><span class=p>.</span><span class=n>employee_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 54</span><span class=cl><span class=w>        </span><span class=p>),</span><span class=w> </span><span class=n>emp_details</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln> 55</span><span class=cl><span class=w>            </span><span class=k>SELECT</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>employee_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 56</span><span class=cl><span class=w>                  </span><span class=n>e</span><span class=p>.</span><span class=n>details</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>jsonb_build_object</span><span class=p>(</span><span class=s1>&#39;territories&#39;</span><span class=p>,</span><span class=w> </span><span class=n>et</span><span class=p>.</span><span class=n>territories</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>details</span><span class=w>
</span></span></span><span class=line><span class=ln> 57</span><span class=cl><span class=w>            </span><span class=k>FROM</span><span class=w> </span><span class=n>emps</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>e</span><span class=w>
</span></span></span><span class=line><span class=ln> 58</span><span class=cl><span class=w>            </span><span class=k>JOIN</span><span class=w> </span><span class=n>emp_territories</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>et</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>employee_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>et</span><span class=p>.</span><span class=n>employee_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 59</span><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln> 60</span><span class=cl><span class=w>            </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>cdc_events</span><span class=w>
</span></span></span><span class=line><span class=ln> 61</span><span class=cl><span class=w>                </span><span class=k>SELECT</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 62</span><span class=cl><span class=w>                      </span><span class=n>o</span><span class=p>.</span><span class=n>customer_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 63</span><span class=cl><span class=w>                      </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 64</span><span class=cl><span class=w>                      </span><span class=n>o</span><span class=p>.</span><span class=n>required_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 65</span><span class=cl><span class=w>                      </span><span class=n>o</span><span class=p>.</span><span class=n>shipped_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 66</span><span class=cl><span class=w>                      </span><span class=n>oi</span><span class=p>.</span><span class=n>order_items</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 67</span><span class=cl><span class=w>                      </span><span class=n>oi</span><span class=p>.</span><span class=n>products</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 68</span><span class=cl><span class=w>                      </span><span class=n>row_to_json</span><span class=p>(</span><span class=k>c</span><span class=p>.</span><span class=o>*</span><span class=p>)::</span><span class=n>jsonb</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>customer</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 69</span><span class=cl><span class=w>                      </span><span class=n>ed</span><span class=p>.</span><span class=n>details</span><span class=p>::</span><span class=n>jsonb</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>employee</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 70</span><span class=cl><span class=w>                      </span><span class=n>row_to_json</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=o>*</span><span class=p>)::</span><span class=n>jsonb</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>shipper</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 71</span><span class=cl><span class=w>                      </span><span class=n>jsonb_build_object</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln> 72</span><span class=cl><span class=w>                        </span><span class=s1>&#39;freight&#39;</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>freight</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 73</span><span class=cl><span class=w>                        </span><span class=s1>&#39;ship_name&#39;</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>ship_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 74</span><span class=cl><span class=w>                        </span><span class=s1>&#39;ship_address&#39;</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>ship_address</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 75</span><span class=cl><span class=w>                        </span><span class=s1>&#39;ship_city&#39;</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>ship_city</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 76</span><span class=cl><span class=w>                        </span><span class=s1>&#39;ship_region&#39;</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>ship_region</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 77</span><span class=cl><span class=w>                        </span><span class=s1>&#39;ship_postal_code&#39;</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>ship_postal_code</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 78</span><span class=cl><span class=w>                        </span><span class=s1>&#39;ship_country&#39;</span><span class=p>,</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>ship_country</span><span class=w>
</span></span></span><span class=line><span class=ln> 79</span><span class=cl><span class=w>                      </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>shipment</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 80</span><span class=cl><span class=w>                      </span><span class=n>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=ln> 81</span><span class=cl><span class=w>                </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w>
</span></span></span><span class=line><span class=ln> 82</span><span class=cl><span class=w>                </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>order_items</span><span class=w> </span><span class=n>oi</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>order_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 83</span><span class=cl><span class=w>                </span><span class=k>JOIN</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>customer_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 84</span><span class=cl><span class=w>                </span><span class=k>JOIN</span><span class=w> </span><span class=n>emp_details</span><span class=w> </span><span class=n>ed</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>employee_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ed</span><span class=p>.</span><span class=n>employee_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 85</span><span class=cl><span class=w>                </span><span class=k>JOIN</span><span class=w> </span><span class=n>shippers</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>ship_via</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>shipper_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 86</span><span class=cl><span class=w>                </span><span class=k>WHERE</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>order_id</span><span class=w>
</span></span></span><span class=line><span class=ln> 87</span><span class=cl><span class=w>            </span><span class=k>ON</span><span class=w> </span><span class=n>CONFLICT</span><span class=w> </span><span class=p>(</span><span class=n>order_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln> 88</span><span class=cl><span class=w>            </span><span class=k>DO</span><span class=w> </span><span class=k>UPDATE</span><span class=w>
</span></span></span><span class=line><span class=ln> 89</span><span class=cl><span class=w>                </span><span class=k>SET</span><span class=w> </span><span class=n>order_id</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=n>excluded</span><span class=p>.</span><span class=n>order_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 90</span><span class=cl><span class=w>                    </span><span class=n>customer_id</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=n>excluded</span><span class=p>.</span><span class=n>customer_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 91</span><span class=cl><span class=w>                    </span><span class=n>order_date</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=n>excluded</span><span class=p>.</span><span class=n>order_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 92</span><span class=cl><span class=w>                    </span><span class=n>required_date</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=n>excluded</span><span class=p>.</span><span class=n>required_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 93</span><span class=cl><span class=w>                    </span><span class=n>shipped_date</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=n>excluded</span><span class=p>.</span><span class=n>shipped_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 94</span><span class=cl><span class=w>                    </span><span class=n>order_items</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=n>excluded</span><span class=p>.</span><span class=n>order_items</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 95</span><span class=cl><span class=w>                    </span><span class=n>products</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=n>excluded</span><span class=p>.</span><span class=n>products</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 96</span><span class=cl><span class=w>                    </span><span class=n>customer</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=n>excluded</span><span class=p>.</span><span class=n>customer</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 97</span><span class=cl><span class=w>                    </span><span class=n>shipper</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=n>excluded</span><span class=p>.</span><span class=n>shipper</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 98</span><span class=cl><span class=w>                    </span><span class=n>shipment</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=n>excluded</span><span class=p>.</span><span class=n>shipment</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln> 99</span><span class=cl><span class=w>                    </span><span class=n>updated_at</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=n>excluded</span><span class=p>.</span><span class=n>updated_at</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>100</span><span class=cl><span class=w>    </span><span class=k>END</span><span class=w> </span><span class=k>IF</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>101</span><span class=cl><span class=w>    </span><span class=k>RETURN</span><span class=w> </span><span class=k>NULL</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>102</span><span class=cl><span class=w></span><span class=k>END</span><span class=w> 
</span></span></span><span class=line><span class=ln>103</span><span class=cl><span class=w></span><span class=err>$$</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=create-initial-event-records data-numberify>Create Initial Event Records<a class="anchor ms-1" href=#create-initial-event-records></a></h3><p>In order to create event records for existing order entries, a stored procedure is created - <code>usp_init_order_events</code>. It is quite similar to the trigger function and can be checked in the project <a href=https://github.com/jaehyeon-kim/data-lake-demo/blob/main/data/sql/03_cdc_events.sql#L161 target=_blank rel="noopener noreferrer"><strong>GitHub repository</strong><i class="fas fa-external-link-square-alt ms-1"></i></a>. The procedure is called at database initialization and a total of 829 event records are created by that.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=ln>1</span><span class=cl><span class=c1>-- ./data/sql/03_cdc_events.sql
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1></span><span class=k>CALL</span><span class=w> </span><span class=n>usp_init_order_events</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>Below shows a simplified event record, converted into JSON. For the order with ID 10248, 3 products are ordered by a customer whose ID is VINET.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln> 1</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=nt>&#34;order_id&#34;</span><span class=p>:</span> <span class=mi>10248</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=nt>&#34;customer_id&#34;</span><span class=p>:</span> <span class=s2>&#34;VINET&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=nt>&#34;order_date&#34;</span><span class=p>:</span> <span class=s2>&#34;1996-07-04&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=nt>&#34;required_date&#34;</span><span class=p>:</span> <span class=s2>&#34;1996-08-01&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=nt>&#34;shipped_date&#34;</span><span class=p>:</span> <span class=s2>&#34;1996-07-16&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=nt>&#34;order_items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=p>{</span> <span class=nt>&#34;discount&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nt>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>12</span><span class=p>,</span> <span class=nt>&#34;product_id&#34;</span><span class=p>:</span> <span class=mi>11</span><span class=p>,</span> <span class=nt>&#34;unit_price&#34;</span><span class=p>:</span> <span class=mi>14</span> <span class=p>},</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=p>{</span> <span class=nt>&#34;discount&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nt>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span> <span class=nt>&#34;product_id&#34;</span><span class=p>:</span> <span class=mi>42</span><span class=p>,</span> <span class=nt>&#34;unit_price&#34;</span><span class=p>:</span> <span class=mf>9.8</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=p>{</span> <span class=nt>&#34;discount&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nt>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span> <span class=nt>&#34;product_id&#34;</span><span class=p>:</span> <span class=mi>72</span><span class=p>,</span> <span class=nt>&#34;unit_price&#34;</span><span class=p>:</span> <span class=mf>34.8</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=nt>&#34;products&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=p>{</span> <span class=nt>&#34;product_id&#34;</span><span class=p>:</span> <span class=mi>11</span><span class=p>,</span> <span class=nt>&#34;product_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Queso Cabrales&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=p>{</span> <span class=nt>&#34;product_id&#34;</span><span class=p>:</span> <span class=mi>42</span><span class=p>,</span> <span class=nt>&#34;product_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Singaporean Hokkien Fried Mee&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=p>{</span> <span class=nt>&#34;product_id&#34;</span><span class=p>:</span> <span class=mi>72</span><span class=p>,</span> <span class=nt>&#34;product_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Mozzarella di Giovanni&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=nt>&#34;customer&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=nt>&#34;customer_id&#34;</span><span class=p>:</span> <span class=s2>&#34;VINET&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=nt>&#34;company_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Vins et alcools Chevalier&#34;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>  <span class=nt>&#34;employee&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Sales Manager&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>    <span class=nt>&#34;last_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Buchanan&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=nt>&#34;employee_id&#34;</span><span class=p>:</span> <span class=mi>5</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>  <span class=nt>&#34;shipper&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>    <span class=nt>&#34;company_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Federal Shipping&#34;</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>  <span class=nt>&#34;shipment&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=nt>&#34;freight&#34;</span><span class=p>:</span> <span class=mf>32.38</span><span class=p>,</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>    <span class=nt>&#34;ship_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Vins et alcools Chevalier&#34;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>  <span class=nt>&#34;updated_at&#34;</span><span class=p>:</span> <span class=s2>&#34;2021-11-27T20:30:13.644579+11:00&#34;</span>
</span></span><span class=line><span class=ln>34</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=create-publication data-numberify>Create Publication<a class="anchor ms-1" href=#create-publication></a></h3><p>As discussed further in the next section, we&rsquo;ll be using the native <code>pgoutput</code> logical replication stream support. Debezium, Kafka source connector, automatically creates a <a href=https://www.postgresql.org/docs/current/logical-replication-publication.html target=_blank rel="noopener noreferrer">publication<i class="fas fa-external-link-square-alt ms-1"></i></a> that contains all tables if it doesn&rsquo;t exist. It can cause trouble to update a record to a table that doesn&rsquo;t have the primary key or replica identity. In order to handle such an issue, a publication that contains only the outbox table is created. This publication will be used when configuring the source connector.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=ln>1</span><span class=cl><span class=c1>-- ./data/sql/03_cdc_events.sql
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=n>PUBLICATION</span><span class=w> </span><span class=n>cdc_publication</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>    </span><span class=k>FOR</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>cdc_events</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=cdc-development data-numberify>CDC Development<a class="anchor ms-1" href=#cdc-development></a></h2><h3 id=docker-compose data-numberify>Docker Compose<a class="anchor ms-1" href=#docker-compose></a></h3><p>The Confluent platform can be handy for local development, although we&rsquo;ll be deploying the solution using <a href=https://aws.amazon.com/msk/ target=_blank rel="noopener noreferrer">Amazon MSK<i class="fas fa-external-link-square-alt ms-1"></i></a> and <a href=https://aws.amazon.com/msk/features/msk-connect/ target=_blank rel="noopener noreferrer">MSK Connect<i class="fas fa-external-link-square-alt ms-1"></i></a>. The <a href=https://docs.confluent.io/platform/current/quickstart/ce-docker-quickstart.html target=_blank rel="noopener noreferrer">quick start guide<i class="fas fa-external-link-square-alt ms-1"></i></a> provides a docker compose file that includes its various components in separate services. It also contains the control center, a graphical user interface, which helps check brokers, topics, messages and connectors easily.</p><p>Additionally, we need a PostgreSQL instance for the Northwind database and a service named <code>postgres</code> is added. The database is initialised by a set of SQL scripts. They are executed by volume-mapping to the initialisation folder - the scripts can be found in the project <a href=https://github.com/jaehyeon-kim/data-lake-demo/tree/main/data/sql target=_blank rel="noopener noreferrer"><strong>GitHub repository</strong><i class="fas fa-external-link-square-alt ms-1"></i></a>. Also, the Kafka Connect instance, running in the <em>connect</em> service, needs an update to include the source and sink connectors. It&rsquo;ll be illustrated further below.</p><p>Below shows a cut-down version of the docker compose file that we use for local development. The complete file can be found in the project <a href=https://github.com/jaehyeon-kim/data-lake-demo/blob/main/docker-compose.yml target=_blank rel="noopener noreferrer"><strong>GitHub repository</strong><i class="fas fa-external-link-square-alt ms-1"></i></a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=c># ./docker-compose.yml</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>postgres</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>debezium/postgres:13</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>      </span>- <span class=m>5432</span><span class=p>:</span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>      </span>- <span class=l>./data/sql:/docker-entrypoint-initdb.d</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_DB=devdb</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_USER=devuser</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_PASSWORD=password</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>  </span><span class=nt>zookeeper</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>confluentinc/cp-zookeeper:6.2.1</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>      </span>- <span class=s2>&#34;2181:2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w>  </span><span class=nt>broker</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>confluentinc/cp-server:6.2.1</span><span class=w>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=w>      </span>- <span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=w>      </span>- <span class=s2>&#34;9092:9092&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=w>      </span>- <span class=s2>&#34;9101:9101&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>30</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>32</span><span class=cl><span class=w>      </span><span class=nt>KAFKA_ADVERTISED_LISTENERS</span><span class=p>:</span><span class=w> </span><span class=l>PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092</span><span class=w>
</span></span></span><span class=line><span class=ln>33</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=w>  </span><span class=nt>schema-registry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>35</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>confluentinc/cp-schema-registry:6.2.1</span><span class=w>
</span></span></span><span class=line><span class=ln>36</span><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>37</span><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>38</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>39</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>40</span><span class=cl><span class=w>      </span>- <span class=s2>&#34;8081:8081&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>41</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>42</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>43</span><span class=cl><span class=w>  </span><span class=nt>connect</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>44</span><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.connector/local/cp-server-connect-datagen</span><span class=w>
</span></span></span><span class=line><span class=ln>45</span><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>46</span><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>47</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>48</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>49</span><span class=cl><span class=w>      </span>- <span class=s2>&#34;8083:8083&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>50</span><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>51</span><span class=cl><span class=w>      </span>- <span class=l>${HOME}/.aws:/home/appuser/.aws</span><span class=w>
</span></span></span><span class=line><span class=ln>52</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>53</span><span class=cl><span class=w>      </span><span class=nt>CONNECT_BOOTSTRAP_SERVERS</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;broker:29092&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>54</span><span class=cl><span class=w>      </span><span class=nt>CONNECT_REST_ADVERTISED_HOST_NAME</span><span class=p>:</span><span class=w> </span><span class=l>connect</span><span class=w>
</span></span></span><span class=line><span class=ln>55</span><span class=cl><span class=w>      </span><span class=nt>CONNECT_REST_PORT</span><span class=p>:</span><span class=w> </span><span class=m>8083</span><span class=w>
</span></span></span><span class=line><span class=ln>56</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>57</span><span class=cl><span class=w>      </span><span class=c># include /usr/local/share/kafka/plugins for community connectors</span><span class=w>
</span></span></span><span class=line><span class=ln>58</span><span class=cl><span class=w>      </span><span class=nt>CONNECT_PLUGIN_PATH</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/usr/share/java,/usr/share/confluent-hub-components,/usr/local/share/kafka/plugins&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>59</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>60</span><span class=cl><span class=w>  </span><span class=nt>control-center</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>61</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>confluentinc/cp-enterprise-control-center:6.2.1</span><span class=w>
</span></span></span><span class=line><span class=ln>62</span><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>63</span><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>64</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>65</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>66</span><span class=cl><span class=w>      </span>- <span class=s2>&#34;9021:9021&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>67</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>68</span><span class=cl><span class=w>      </span><span class=nt>CONTROL_CENTER_BOOTSTRAP_SERVERS</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;broker:29092&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>69</span><span class=cl><span class=w>      </span><span class=nt>CONTROL_CENTER_CONNECT_CONNECT-DEFAULT_CLUSTER</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;connect:8083&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>70</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>71</span><span class=cl><span class=w>      </span><span class=nt>PORT</span><span class=p>:</span><span class=w> </span><span class=m>9021</span><span class=w>
</span></span></span><span class=line><span class=ln>72</span><span class=cl><span class=w>  </span><span class=nt>rest-proxy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>73</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>confluentinc/cp-kafka-rest:6.2.1</span><span class=w>
</span></span></span><span class=line><span class=ln>74</span><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>75</span><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>76</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=ln>77</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>78</span><span class=cl><span class=w>      </span>- <span class=m>8082</span><span class=p>:</span><span class=m>8082</span><span class=w>
</span></span></span><span class=line><span class=ln>79</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>80</span><span class=cl><span class=w>      </span><span class=l>...</span><span class=w>
</span></span></span></code></pre></div><h4 id=install-connectors data-numberify>Install Connectors<a class="anchor ms-1" href=#install-connectors></a></h4><p>We use the <a href=https://debezium.io/documentation/reference/stable/connectors/postgresql.html target=_blank rel="noopener noreferrer">Debezium connector for PostgreSQL<i class="fas fa-external-link-square-alt ms-1"></i></a> as the source connector and <a href=https://docs.lenses.io/4.1/integrations/connectors/stream-reactor/sinks/s3sinkconnector/ target=_blank rel="noopener noreferrer">Lenses S3 Connector<i class="fas fa-external-link-square-alt ms-1"></i></a> as the sink connector. The source connector is installed via the confluent hub client while the sink connector is <a href=https://docs.confluent.io/home/connect/community.html target=_blank rel="noopener noreferrer">added as a community connector<i class="fas fa-external-link-square-alt ms-1"></i></a>. Note that the environment variable of CONNECT_PLUGIN_PATH is updated to include the kafka plugin folder (<code>/usr/local/share/kafka/plugins</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=ln> 1</span><span class=cl><span class=c># .connector/local/cp-server-connect-datagen/Dockerfile</span><span class=err>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> cnfldemos/cp-server-connect-datagen:0.5.0-6.2.1</span><span class=err>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=err>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=err></span><span class=c># install debezium postgresql connector from confluent hub</span><span class=err>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=err></span><span class=k>RUN</span> confluent-hub install --no-prompt debezium/debezium-connector-postgresql:1.7.1<span class=err>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=err>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=err></span><span class=c># install lenses S3 connector as a community connector - https://docs.confluent.io/home/connect/community.html</span><span class=err>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=err></span><span class=k>USER</span><span class=s> root</span><span class=err>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=err></span><span class=k>RUN</span> mkdir -p /usr/local/share/kafka/plugins/kafka-connect-aws-s3 <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=se></span>  curl -SsL https://github.com/lensesio/stream-reactor/releases/download/3.0.0/kafka-connect-aws-s3-3.0.0-2.5.0-all.tar.gz <span class=se>\
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=se></span>    <span class=p>|</span> tar -C /usr/local/share/kafka/plugins/kafka-connect-aws-s3 --warning<span class=o>=</span>no-unknown-keyword -xzf -<span class=err>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=err>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=err></span><span class=c># update connect plugin path</span><span class=err>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>CONNECT_PLUGIN_PATH</span><span class=o>=</span><span class=nv>$CONNECT_PLUGIN_PATH</span>,/usr/local/share/kafka/plugins<span class=err>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=err></span><span class=k>USER</span><span class=s> appuser</span><span class=err>
</span></span></span></code></pre></div><h3 id=start-services data-numberify>Start Services<a class="anchor ms-1" href=#start-services></a></h3><p>After starting the docker compose services, we can check a local Kafka cluster in the control center via <code>http://localhost:9021</code>. We can go to the cluster overview page by clicking the cluster card item.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2021-12-05-datalake-demo-part1/01-confluent-cluster.png loading=lazy width=598 height=764></picture></p><p>We can check an overview of the cluster in the page. For example, it shows the cluster has 1 broker and there is no running connector. On the left side, there are menus for individual components. Among those, Topics and Connect will be our main interest in this post.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2021-12-05-datalake-demo-part1/02-confluent-overview.png loading=lazy width=1509 height=881></picture></p><h3 id=create-connectors data-numberify>Create Connectors<a class="anchor ms-1" href=#create-connectors></a></h3><h4 id=source-connector data-numberify>Source Connector<a class="anchor ms-1" href=#source-connector></a></h4><p><a href=https://debezium.io/documentation/reference/stable/connectors/postgresql.html target=_blank rel="noopener noreferrer">Debezium&rsquo;s PostgreSQL connector<i class="fas fa-external-link-square-alt ms-1"></i></a> captures row-level changes in the schemas of a PostgreSQL database. PostgreSQL versions 9.6, 10, 11, 12 and 13 are supported. The first time it connects to a PostgreSQL server or cluster, the connector takes a consistent snapshot of all schemas. After that snapshot is complete, the connector continuously captures row-level changes that insert, update, and delete database content and that were committed to a PostgreSQL database. The connector generates data change event records and streams them to Kafka topics. For each table, the default behavior is that the connector streams all generated events to a separate Kafka topic for that table. Applications and services consume data change event records from that topic.</p><p>The connector has a number of connector properties including name, connector class, database connection details, key/value converter and so on - the full list of properties can be found in <a href=https://debezium.io/documentation/reference/stable/connectors/postgresql.html#postgresql-connector-properties target=_blank rel="noopener noreferrer">this page<i class="fas fa-external-link-square-alt ms-1"></i></a>. The properties that need explanation are listed below.</p><ul><li><code>plugin.name</code> - Using the <a href=https://www.postgresql.org/docs/current/logicaldecoding-explanation.html target=_blank rel="noopener noreferrer">logical decoding<i class="fas fa-external-link-square-alt ms-1"></i></a> feature, an output plug-in enables clients to consume changes to the transaction log in a user-friendly manner. Debezium supports <code>decoderbufs</code>, <code>wal2json</code> and <code>pgoutput</code> plug-ins. Both <code>wal2json</code> and <code>pgoutput</code> are available in Amazon RDS for PostgreSQL and Amazon Aurora PostgreSQL. <code>decoderbufs</code> requires a separate installation, and it is excluded from the option. Among the 2 supported plug-ins, <code>pgoutput</code> is selected because it is the standard logical decoding output plug-in in PostgreSQL 10+ and <a href=https://debezium.io/blog/2020/02/25/lessons-learned-running-debezium-with-postgresql-on-rds/ target=_blank rel="noopener noreferrer">has better performance for large transactions<i class="fas fa-external-link-square-alt ms-1"></i></a>.</li><li><code>publication.name</code> - With the <code>pgoutput</code> plug-in, the Debezium connector creates a publication (if not exists) and sets <code>publication.autocreate.mode</code> to <em>all_tables</em>. It can cause an issue to update a record to a table that doesn&rsquo;t have the primary key or replica identity. We can set the value to <em>filtered</em> where the connector adjusts the applicable tables by other property values. Alternatively we can create a publication on our own and add the name to <em>publication.name</em> property. I find creating a publication explicitly is easier to maintain. Note a publication alone is not sufficient to handle the issue. All affected tables by the publication should have the primary key or replica identity. In our example, the _orders _and _order_details _tables should meet the condition. In short, creating an explicit publication can prevent the event generation process from interrupting other processes by limiting the scope of CDC event generation.</li><li><code>key.converter/value.converter</code> - Although <a href=https://debezium.io/documentation/reference/stable/configuration/avro.html target=_blank rel="noopener noreferrer">Avro serialization<i class="fas fa-external-link-square-alt ms-1"></i></a> is recommended, JSON is a format that can be generated without schema registry and can be read by DeltaStreamer.</li><li><code>transforms</code> - A Debezium event data has a complex structure that provides a wealth of information. It can be quite difficult to process such a structure using DeltaStreamer. Debezium&rsquo;s event flattening <a href=https://debezium.io/documentation/reference/stable/transformations/event-flattening.html target=_blank rel="noopener noreferrer">single message transformation (SMT)<i class="fas fa-external-link-square-alt ms-1"></i></a> is configured to flatten the output payload.</li></ul><p>Note once the connector is deployed, the CDC event records will be published to <code>demo.datalake.cdc_events</code> topic.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// ./connector/local/source-debezium.json
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;orders-source&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=nt>&#34;config&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=nt>&#34;connector.class&#34;</span><span class=p>:</span> <span class=s2>&#34;io.debezium.connector.postgresql.PostgresConnector&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=nt>&#34;tasks.max&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=nt>&#34;plugin.name&#34;</span><span class=p>:</span> <span class=s2>&#34;pgoutput&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=nt>&#34;publication.name&#34;</span><span class=p>:</span> <span class=s2>&#34;cdc_publication&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=nt>&#34;database.hostname&#34;</span><span class=p>:</span> <span class=s2>&#34;postgres&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=nt>&#34;database.port&#34;</span><span class=p>:</span> <span class=s2>&#34;5432&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=nt>&#34;database.user&#34;</span><span class=p>:</span> <span class=s2>&#34;devuser&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=nt>&#34;database.password&#34;</span><span class=p>:</span> <span class=s2>&#34;password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=nt>&#34;database.dbname&#34;</span><span class=p>:</span> <span class=s2>&#34;devdb&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=nt>&#34;database.server.name&#34;</span><span class=p>:</span> <span class=s2>&#34;demo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nt>&#34;schema.include&#34;</span><span class=p>:</span> <span class=s2>&#34;datalake&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=nt>&#34;table.include.list&#34;</span><span class=p>:</span> <span class=s2>&#34;datalake.cdc_events&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=nt>&#34;key.converter&#34;</span><span class=p>:</span> <span class=s2>&#34;org.apache.kafka.connect.json.JsonConverter&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=nt>&#34;value.converter&#34;</span><span class=p>:</span> <span class=s2>&#34;org.apache.kafka.connect.json.JsonConverter&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=nt>&#34;transforms&#34;</span><span class=p>:</span> <span class=s2>&#34;unwrap&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=nt>&#34;transforms.unwrap.type&#34;</span><span class=p>:</span> <span class=s2>&#34;io.debezium.transforms.ExtractNewRecordState&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=nt>&#34;transforms.unwrap.drop.tombstones&#34;</span><span class=p>:</span> <span class=s2>&#34;false&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=nt>&#34;transforms.unwrap.delete.handling.mode&#34;</span><span class=p>:</span> <span class=s2>&#34;rewrite&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>    <span class=nt>&#34;transforms.unwrap.add.fields&#34;</span><span class=p>:</span> <span class=s2>&#34;op,db,table,schema,lsn,source.ts_ms&#34;</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The source connector is created using the API and its status can be checked as shown below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl><span class=c1>## create debezium source connector</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>curl -i -X POST -H <span class=s2>&#34;Accept:application/json&#34;</span> -H  <span class=s2>&#34;Content-Type:application/json&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=se></span>  http://localhost:8083/connectors/ -d @connector/local/source-debezium.json
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1>## check connector status</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>curl http://localhost:8083/connectors/orders-source/status
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1>#{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1>#  &#34;name&#34;: &#34;orders-source&#34;,</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1>#  &#34;connector&#34;: { &#34;state&#34;: &#34;RUNNING&#34;, &#34;worker_id&#34;: &#34;connect:8083&#34; },</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1>#  &#34;tasks&#34;: [{ &#34;id&#34;: 0, &#34;state&#34;: &#34;RUNNING&#34;, &#34;worker_id&#34;: &#34;connect:8083&#34; }],</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1>#  &#34;type&#34;: &#34;source&#34;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1>#}</span>
</span></span></code></pre></div><h4 id=sink-connector data-numberify>Sink Connector<a class="anchor ms-1" href=#sink-connector></a></h4><p><a href=https://lenses.io/blog/2020/11/new-kafka-to-S3-connector/ target=_blank rel="noopener noreferrer">Lenses S3 Connector<i class="fas fa-external-link-square-alt ms-1"></i></a> is a Kafka Connect sink connector for writing records from Kafka to AWS S3 Buckets. It extends the standard connect config adding a parameter for a SQL command (Lenses Kafka Connect Query Language or &ldquo;KCQL&rdquo;). This defines how to map data from the source (in this case Kafka) to the target (S3). Importantly, it also includes how data should be partitioned into S3, the bucket names and the serialization format (support includes JSON, Avro, Parquet, Text, CSV and binary).</p><p>I find the Lenses S3 connector is more straightforward to configure than the Confluent S3 sink connector for its <a href=https://docs.lenses.io/4.1/integrations/connectors/stream-reactor/sinks/s3sinkconnector/ target=_blank rel="noopener noreferrer">SQL-like syntax<i class="fas fa-external-link-square-alt ms-1"></i></a>. The KCQL configuration indicates that object files are set to be</p><ul><li>moved from a Kafka topic (<code>demo.datalake.cdc_events</code>) to an S3 bucket (<code>data-lake-demo-cevo</code>) with object prefix of _<code>cdc-events-local</code>,</li><li>partitioned by <em>customer_id</em> and <em>order_id</em> e.g. <code>customer_id=&lt;customer-id>/order_id=&lt;order-id></code>,</li><li>stored as the JSON format and,</li><li>flushed every 60 seconds or when there are 50 records.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// ./connector/local/sink-s3.json
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;orders-sink&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=nt>&#34;config&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=nt>&#34;connector.class&#34;</span><span class=p>:</span> <span class=s2>&#34;io.lenses.streamreactor.connect.aws.s3.sink.S3SinkConnector&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=nt>&#34;tasks.max&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=nt>&#34;connect.s3.kcql&#34;</span><span class=p>:</span> <span class=s2>&#34;INSERT INTO data-lake-demo-cevo:cdc-events-local SELECT * FROM demo.datalake.cdc_events PARTITIONBY customer_id,order_id STOREAS `json` WITH_FLUSH_INTERVAL = 60 WITH_FLUSH_COUNT = 50&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=nt>&#34;aws.region&#34;</span><span class=p>:</span> <span class=s2>&#34;ap-southeast-2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=nt>&#34;aws.custom.endpoint&#34;</span><span class=p>:</span> <span class=s2>&#34;https://s3.ap-southeast-2.amazonaws.com/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=nt>&#34;topics&#34;</span><span class=p>:</span> <span class=s2>&#34;demo.datalake.cdc_events&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=nt>&#34;key.converter.schemas.enable&#34;</span><span class=p>:</span> <span class=s2>&#34;false&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=nt>&#34;schema.enable&#34;</span><span class=p>:</span> <span class=s2>&#34;false&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=nt>&#34;errors.log.enable&#34;</span><span class=p>:</span> <span class=s2>&#34;true&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=nt>&#34;key.converter&#34;</span><span class=p>:</span> <span class=s2>&#34;org.apache.kafka.connect.json.JsonConverter&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nt>&#34;value.converter&#34;</span><span class=p>:</span> <span class=s2>&#34;org.apache.kafka.connect.json.JsonConverter&#34;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The sink connector is created using the API and its status can be checked as shown below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl><span class=c1>### create s3 sink connector</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>curl -i -X POST -H <span class=s2>&#34;Accept:application/json&#34;</span> -H  <span class=s2>&#34;Content-Type:application/json&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=se></span>  http://localhost:8083/connectors/ -d @connector/local/sink-s3.json
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1>## check connector status</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>curl http://localhost:8083/connectors/orders-sink/status
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1>#{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1>#  &#34;name&#34;: &#34;orders-sink&#34;,</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1>#  &#34;connector&#34;: { &#34;state&#34;: &#34;RUNNING&#34;, &#34;worker_id&#34;: &#34;connect:8083&#34; },</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1>#  &#34;tasks&#34;: [{ &#34;id&#34;: 0, &#34;state&#34;: &#34;RUNNING&#34;, &#34;worker_id&#34;: &#34;connect:8083&#34; }],</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1>#  &#34;type&#34;: &#34;sink&#34;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1>#}</span>
</span></span></code></pre></div><p>We can also check the details of the connectors from the control center.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2021-12-05-datalake-demo-part1/03-confluent-connectors.png loading=lazy width=1509 height=564></picture></p><p>In the <em>Topics</em> menu, we are able to see that the <em>demo.datalake.cdc_events</em> topic is created by the Debezium connector.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2021-12-05-datalake-demo-part1/04-confluent-topic-list.png loading=lazy width=1509 height=473></picture></p><p>We can check messages of a topic by clicking the topic name. After adding an offset value (e.g. 0) to the input element, we are able to see messages of the topic. We can check message fields on the left-hand side or download a message in the JSON or CSV format.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2021-12-05-datalake-demo-part1/05-confluent-topic-messages.png loading=lazy width=1611 height=808></picture></p><h2 id=check-event-output-files data-numberify>Check Event Output Files<a class="anchor ms-1" href=#check-event-output-files></a></h2><p>We can check the output files that are processed by the sink connector in S3. Below shows an example record where _customer_id _is RATTC and _order_id _is 11077. As configured, the objects are prefixed by <code>cdc-events-local</code> and further partitioned by _customer_id _and <em>order_id</em>. The naming convention of output files is <code>&lt;topic-name>(partition_offset).ext</code>.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2021-12-05-datalake-demo-part1/06-01-message.png loading=lazy width=1293 height=472></picture></p><h4 id=update-event-example data-numberify>Update Event Example<a class="anchor ms-1" href=#update-event-example></a></h4><p>The above order record has a NULL <em>shipped_date</em> value. When we update it using the following SQL statement, we should be able to see a new output file with the updated value.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=ln>1</span><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>    </span><span class=k>UPDATE</span><span class=w> </span><span class=n>orders</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>    </span><span class=k>SET</span><span class=w> </span><span class=n>shipped_date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;1998-06-15&#39;</span><span class=p>::</span><span class=nb>date</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>order_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>11077</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>In S3, we are able to see that a new output file is stored. In the new output file, the _shipped_date _value is updated to 10392. Note that the <a href=https://debezium.io/documentation/reference/stable/connectors/postgresql.html#postgresql-temporal-types target=_blank rel="noopener noreferrer">Debezium connector converts the DATE type to the INT32 type<i class="fas fa-external-link-square-alt ms-1"></i></a>, which represents the number of days since the epoch.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2021-12-05-datalake-demo-part1/06-02-s3-message-update.png loading=lazy width=1292 height=499></picture></p><h4 id=insert-event-example data-numberify>Insert Event Example<a class="anchor ms-1" href=#insert-event-example></a></h4><p>When a new order is created, it&rsquo;ll insert a record to the _orders _table as well as one or more order items to the _order_details _table. Therefore, we expect multiple event records will be created when a new order is created. We can check it by inserting an order and related order details items.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=ln>1</span><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>11075</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;RICSU&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1998-05-06&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1998-06-03&#39;</span><span class=p>,</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>.</span><span class=mi>19000006</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Richter Supermarkt&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Starenweg 5&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Genève&#39;</span><span class=p>,</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1204&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Switzerland&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>order_details</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>11075</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>19</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>150000006</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>order_details</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>11075</span><span class=p>,</span><span class=w> </span><span class=mi>46</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>150000006</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>order_details</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>11075</span><span class=p>,</span><span class=w> </span><span class=mi>76</span><span class=p>,</span><span class=w> </span><span class=mi>18</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>150000006</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>We can see the output file includes 4 JSON objects where the first object has NULL _order_items _and _products _value. We can also see that those values are expanded gradually in subsequent event records.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2021-12-05-datalake-demo-part1/07-new-message.png loading=lazy width=1511 height=531></picture></p><h2 id=conclusion data-numberify>Conclusion<a class="anchor ms-1" href=#conclusion></a></h2><p>We discussed a data lake solution where data ingestion is performed using change data capture (CDC) and the output files are <em>upserted</em> to a Hudi table. Being registered to Glue Data Catalog, it can be used for ad-hoc queries and report/dashboard creation. For the solution, the Northwind database is used as the source database and, following the transactional outbox pattern, order-related changes are upserted to an outbox table by triggers. The data ingestion is developed in the local Confluent platform where the Debezium for PostgreSQL is used as the source connector and the Lenses S3 sink connector is used as the sink connector. We confirmed order creation and update events are captured as expected. In the next post, we&rsquo;ll build the data ingestion part of the solution with Amazon MSK and MSK Connect.</p></div></div></div><div class=card-footer><div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev"><i class="fas fa-fw fa-chevron-down post-prev-icon me-1" data-fa-transform=rotate-90></i>
<a href=/blog/2021-11-14-glue-3-local-development/>Local Development of AWS Glue 3.0 and Later</a></div><div class="post-nav post-next"><a href=/blog/2021-12-12-datalake-demo-part2/>Data Lake Demo Using Change Data Capture (CDC) on AWS – Part 2 Implement CDC</a>
<i class="fas fa-fw fa-chevron-down post-next-icon ms-1" data-fa-transform=rotate-270></i></div></div></div></article><section class="related-posts row card component"><div class=card-header><h2 class="card-title fs-4 my-2 text-surface">Related Posts</h2></div><div class="card-body slide px-1"><div class="slide-inner row gx-0"><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2021-11-14-glue-3-local-development/featured_hu689859cb443a98b1c98384fedaa00395_30923_500x0_resize_box_3.png media="(max-width: 576px)" height=296 width=500><img class=img-fluid height=107 width=180 alt=featured.png src=/blog/2021-11-14-glue-3-local-development/featured_hu689859cb443a98b1c98384fedaa00395_30923_180x0_resize_box_3.png data-src=/blog/2021-11-14-glue-3-local-development/featured.png loading=lazy></picture>
<a class=post-title href=/blog/2021-11-14-glue-3-local-development/>Local Development of AWS Glue 3.0 and Later</a><div class="post-meta mb-0">November 14, 2021</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2021-08-20-glue-local-development/featured_hu248b4052e45f408d4fe80445a9d59f15_19535_500x0_resize_box_3.png media="(max-width: 576px)" height=141 width=500><img class=img-fluid height=51 width=180 alt=featured.png src=/blog/2021-08-20-glue-local-development/featured_hu248b4052e45f408d4fe80445a9d59f15_19535_180x0_resize_box_3.png data-src=/blog/2021-08-20-glue-local-development/featured.png loading=lazy></picture>
<a class=post-title href=/blog/2021-08-20-glue-local-development/>AWS Glue Local Development With Docker and Visual Studio Code</a><div class="post-meta mb-0">August 20, 2021</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2020-04-13-airflow-lambda-operator/featured_hu1fb366ed8468cd95c289e8b53adf2b4c_44994_500x0_resize_box_3.png media="(max-width: 576px)" height=144 width=500><img class=img-fluid height=52 width=180 alt=featured.png src=/blog/2020-04-13-airflow-lambda-operator/featured_hu1fb366ed8468cd95c289e8b53adf2b4c_44994_180x0_resize_box_3.png data-src=/blog/2020-04-13-airflow-lambda-operator/featured.png loading=lazy></picture>
<a class=post-title href=/blog/2020-04-13-airflow-lambda-operator/>Thoughts on Apache Airflow AWS Lambda Operator</a><div class="post-meta mb-0">April 13, 2020</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2019-07-20-aws-localstack/featured_hu76363859e2b475a85e538ad8f869426e_164886_500x0_resize_box_3.png media="(max-width: 576px)" height=300 width=500><img class=img-fluid height=108 width=180 alt=featured.png src=/blog/2019-07-20-aws-localstack/featured_hu76363859e2b475a85e538ad8f869426e_164886_180x0_resize_box_3.png data-src=/blog/2019-07-20-aws-localstack/featured.png loading=lazy></picture>
<a class=post-title href=/blog/2019-07-20-aws-localstack/>AWS Local Development With LocalStack</a><div class="post-meta mb-0">July 20, 2019</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2019-11-29-traefik-example/featured_huf02131f0aec4656166a63d0e0c90fae1_139790_500x0_resize_box_3.png media="(max-width: 576px)" height=260 width=500><img class=img-fluid height=93 width=180 alt=featured.png src=/blog/2019-11-29-traefik-example/featured_huf02131f0aec4656166a63d0e0c90fae1_139790_180x0_resize_box_3.png data-src=/blog/2019-11-29-traefik-example/featured.png loading=lazy></picture>
<a class=post-title href=/blog/2019-11-29-traefik-example/>Dynamic Routing and Centralized Auth With Traefik, Python and R Example</a><div class="post-meta mb-0">November 29, 2019</div></div></div></div><button class=slide-control-left>
<i class="fas fa-2x fa-chevron-circle-down" data-fa-transform=rotate-90></i>
<span class=visually-hidden>Left</span></button>
<button class=slide-control-right>
<i class="fas fa-2x fa-chevron-circle-down" data-fa-transform=rotate-270></i>
<span class=visually-hidden>Right</span></button></div></section><div class="card component row post-comments" id=post-comments><div class=card-header><h2 class="card-title my-2 fs-4 text-surface">Comments</h2></div><div class=card-body><div class=giscus></div></div></div></div></div><aside class="col-xxl-4 sidebar d-flex"><div class="container d-flex flex-column"><div class="accordion profile"><div class="accordion-item card row text-center component"><div class="accordion-header card-header border-0" id=profile-header><a class="accordion-button d-lg-none mb-2 shadow-none p-0 bg-transparent text-surface" role=button data-bs-toggle=collapse href=#profile aria-expanded=true aria-controls=profile>Profile</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id=profile aria-labelledby=profile-header><div class="col-12 d-flex align-items-center justify-content-center"><picture><img class="profile-avatar rounded-circle" alt="Jaehyeon Kim" src=https://jaehyeon.me/images/profile.png loading=lazy data-viewer-invisible width=200 height=200></picture></div><div class="col-12 profile-meta"><div class="profile-name fw-fold fs-lg">Jaehyeon Kim</div><div class=profile-bio>Consultant at Cevo 🇦🇺 ▪️ ☁ AWS Community Builder ▪️ 💭 Blogger ▪️ 🔥 Real-time Enthusiast</div><a class="profile-about text-primary" href=/about/><i class="fas fa-fw fa-user"></i>About</a><a class="profile-contact text-primary" href=/contact/><i class="fas fa-fw fa-question-circle"></i>Contact Me</a></div><nav class="social-links nav justify-content-center mt-1 justify-content-around"><a class="nav-link social-link" href=mailto:dottami@gmail.com title=Email><i class="fas fa-fw fa-2x fa-envelope" style=color:#0963ac></i></a>
<a class="nav-link social-link" target=_blank href=https://github.com/jaehyeon-kim title=GitHub rel=me><i class="fa-fw fa-2x fab fa-github"></i></a>
<a class="nav-link social-link" target=_blank href=https://linkedin.com/in/jaehyeon-kim-76b93429 title=LinkedIn rel=me><i class="fa-fw fa-2x fab fa-linkedin-in" style=color:#0a66c2></i></a>
<a class="nav-link social-link" target=_blank href=https://www.paypal.com/paypalme/dottami title=PayPal rel=me><i class="fa-fw fa-2x fab fa-paypal"></i></a></nav></div></div></div><div class="accordion taxonomies-toggle"><div class="row card component accordion-item"><div class="accordion-header card-header border-0"><a class="accordion-button d-lg-none mb-1 shadow-none p-0 bg-transparent" role=button data-bs-toggle=collapse href=#taxonomies-toggle aria-expanded=true aria-controls=taxonomies-toggle>Taxonomies</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id=taxonomies-toggle><ul class="nav nav-pills nav-fill" role=tablist><li class=nav-item role=presentation><button class="nav-link active" id=taxonomyCategoriesTab data-bs-toggle=tab data-bs-target=#taxonomyCategories type=button role=tab aria-controls=taxonomyCategories aria-selected=true>
Categories</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomyTagsTab data-bs-toggle=tab data-bs-target=#taxonomyTags type=button role=tab aria-controls=taxonomyTags aria-selected=true>
Tags</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomySeriesTab data-bs-toggle=tab data-bs-target=#taxonomySeries type=button role=tab aria-controls=taxonomySeries aria-selected=true>
Series</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomyArchivesTab data-bs-toggle=tab data-bs-target=#taxonomyArchives type=button role=tab aria-controls=taxonomyArchives aria-selected=true>
Archives</button></li></ul><div class="tab-content mt-3"><div class="tab-pane active" id=taxonomyCategories role=tabpanel aria-labelledby=taxonomyCategoriesTab tabindex=0><a href=/categories/data-engineering/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Data Engineering">Data Engineering
<span class="badge badge-sm text-secondary bg-white ms-1">25</span></a>
<a href=/categories/engineering/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=Engineering>Engineering
<span class="badge badge-sm text-secondary bg-white ms-1">23</span></a>
<a href=/categories/machine-learning/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Machine Learning">Machine Learning
<span class="badge badge-sm text-secondary bg-white ms-1">6</span></a>
<a href=/categories/serverless/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=Serverless>Serverless
<span class="badge badge-sm text-secondary bg-white ms-1">6</span></a>
<a href=/categories/web-development/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Web Development">Web Development
<span class="badge badge-sm text-secondary bg-white ms-1">5</span></a></div><div class=tab-pane id=taxonomyTags role=tabpanel aria-labelledby=taxonomyTagsTab tabindex=0><a href=/tags/r/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=R>R
<span class="badge badge-sm text-secondary bg-white ms-1">36</span></a>
<a href=/tags/aws/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=AWS>AWS
<span class="badge badge-sm text-secondary bg-white ms-1">28</span></a>
<a href=/tags/python/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Python>Python
<span class="badge badge-sm text-secondary bg-white ms-1">18</span></a>
<a href=/tags/docker/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Docker>Docker
<span class="badge badge-sm text-secondary bg-white ms-1">17</span></a>
<a href=/tags/apache-spark/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Apache Spark">Apache Spark
<span class="badge badge-sm text-secondary bg-white ms-1">16</span></a>
<a href=/tags/terraform/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Terraform>Terraform
<span class="badge badge-sm text-secondary bg-white ms-1">13</span></a>
<a href=/tags/docker-compose/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Docker Compose">Docker Compose
<span class="badge badge-sm text-secondary bg-white ms-1">12</span></a>
<a href=/tags/aws-lambda/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="AWS Lambda">AWS Lambda
<span class="badge badge-sm text-secondary bg-white ms-1">11</span></a>
<a href=/tags/amazon-emr/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon EMR">Amazon EMR
<span class="badge badge-sm text-secondary bg-white ms-1">10</span></a>
<a href=/tags/apache-kafka/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Apache Kafka">Apache Kafka
<span class="badge badge-sm text-secondary bg-white ms-1">8</span></a>
<a href=https://jaehyeon.me/tags class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=ALL>ALL
<span class="badge badge-sm text-secondary bg-white ms-1">66</span></a></div><div class=tab-pane id=taxonomySeries role=tabpanel aria-labelledby=taxonomySeriesTab tabindex=0><a href=/series/tree-based-methods-in-r/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Tree based methods in R">Tree based methods in R
<span class="badge badge-sm text-secondary bg-white ms-1">6</span></a>
<a href=/series/dbt-for-effective-data-transformation-on-aws/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="DBT for Effective Data Transformation on AWS">DBT for Effective Data Transformation on AWS
<span class="badge badge-sm text-secondary bg-white ms-1">5</span></a>
<a href=/series/serverless-data-product/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Serverless Data Product">Serverless Data Product
<span class="badge badge-sm text-secondary bg-white ms-1">4</span></a>
<a href=/series/data-lake-demo-using-change-data-capture/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Data Lake Demo Using Change Data Capture">Data Lake Demo Using Change Data Capture
<span class="badge badge-sm text-secondary bg-white ms-1">3</span></a>
<a href=/series/parallel-processing-on-single-machine/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Parallel processing on single machine">Parallel processing on single machine
<span class="badge badge-sm text-secondary bg-white ms-1">3</span></a>
<a href=/series/api-development-with-r/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="API development with R">API development with R
<span class="badge badge-sm text-secondary bg-white ms-1">2</span></a>
<a href=/series/integrate-schema-registry-with-msk-connect/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Integrate Schema Registry with MSK Connect">Integrate Schema Registry with MSK Connect
<span class="badge badge-sm text-secondary bg-white ms-1">2</span></a>
<a href=/series/simplify-streaming-ingestion-on-aws/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Simplify Streaming Ingestion on AWS">Simplify Streaming Ingestion on AWS
<span class="badge badge-sm text-secondary bg-white ms-1">2</span></a></div><div class=tab-pane id=taxonomyArchives role=tabpanel aria-labelledby=taxonomyArchivesTab tabindex=0><a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2023>2023 <span class="badge badge-sm text-secondary bg-white ms-1">3</span></a>
<a href=/archives/2022/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2022>2022 <span class="badge badge-sm text-secondary bg-white ms-1">15</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2021>2021 <span class="badge badge-sm text-secondary bg-white ms-1">7</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2020>2020 <span class="badge badge-sm text-secondary bg-white ms-1">1</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2019>2019 <span class="badge badge-sm text-secondary bg-white ms-1">5</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2018>2018 <span class="badge badge-sm text-secondary bg-white ms-1">2</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2017>2017 <span class="badge badge-sm text-secondary bg-white ms-1">6</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2016>2016 <span class="badge badge-sm text-secondary bg-white ms-1">6</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2015>2015 <span class="badge badge-sm text-secondary bg-white ms-1">15</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2014>2014 <span class="badge badge-sm text-secondary bg-white ms-1">5</span></a></div></div></div></div></div><div class="accordion posts-toggle"><div class="row card component accordion-item"><div class="accordion-header card-header border-0"><a class="accordion-button d-lg-none mb-1 shadow-none p-0 bg-transparent" role=button data-bs-toggle=collapse href=#posts-toggle aria-expanded=true aria-controls=posts-toggle>Posts</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id=posts-toggle><ul class="nav nav-pills nav-fill" role=tablist><li class=nav-item role=presentation><button class="nav-link active" id=recent-posts-tab data-bs-toggle=tab data-bs-target=#recent-posts type=button role=tab aria-controls=recent-posts aria-selected=true>
Recent Posts</button></li></ul><div class="tab-content mt-3"><div class="tab-pane active" id=recent-posts role=tabpanel aria-labelledby=recent-posts-tab tabindex=0><ul class="post-list list-unstyled ms-1"><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2023-03-14-simplify-streaming-ingestion-athena/featured_huef6334952f8505bdd5ee5a48de258194_43403_500x0_resize_box_3.png media="(max-width: 576px)" height=258 width=500><img class=img-fluid height=93 width=180 alt=featured.png src=/blog/2023-03-14-simplify-streaming-ingestion-athena/featured_huef6334952f8505bdd5ee5a48de258194_43403_180x0_resize_box_3.png data-src=/blog/2023-03-14-simplify-streaming-ingestion-athena/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2023-03-14-simplify-streaming-ingestion-athena/>Simplify Streaming Ingestion on AWS – Part 2 MSK and Athena</a><div class="post-meta mt-2"><span class=post-date>March 14, 2023</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2023-02-08-simplify-streaming-ingestion-redshift/featured_hu77abd5c8ed84cebc51bde5ecaefc7320_32864_500x0_resize_box_3.png media="(max-width: 576px)" height=239 width=500><img class=img-fluid height=86 width=180 alt=featured.png src=/blog/2023-02-08-simplify-streaming-ingestion-redshift/featured_hu77abd5c8ed84cebc51bde5ecaefc7320_32864_180x0_resize_box_3.png data-src=/blog/2023-02-08-simplify-streaming-ingestion-redshift/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2023-02-08-simplify-streaming-ingestion-redshift/>Simplify Streaming Ingestion on AWS – Part 1 MSK and Redshift</a><div class="post-meta mt-2"><span class=post-date>February 8, 2023</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2023-01-10-kafka-consumer-seek-offsets/featured_hua222fe3eeaae92dfa98b24cdf7061694_47217_500x0_resize_box_3.png media="(max-width: 576px)" height=368 width=500><img class=img-fluid height=132 width=180 alt=featured.png src=/blog/2023-01-10-kafka-consumer-seek-offsets/featured_hua222fe3eeaae92dfa98b24cdf7061694_47217_180x0_resize_box_3.png data-src=/blog/2023-01-10-kafka-consumer-seek-offsets/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2023-01-10-kafka-consumer-seek-offsets/>How to Configure Kafka Consumers to Seek Offsets by Timestamp</a><div class="post-meta mt-2"><span class=post-date>January 10, 2023</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2022-12-06-dbt-on-aws-part-5-athena/featured_hu2cb992d854f23cc962e70e6949802760_91796_500x0_resize_box_3.png media="(max-width: 576px)" height=243 width=500><img class=img-fluid height=87 width=180 alt=featured.png src=/blog/2022-12-06-dbt-on-aws-part-5-athena/featured_hu2cb992d854f23cc962e70e6949802760_91796_180x0_resize_box_3.png data-src=/blog/2022-12-06-dbt-on-aws-part-5-athena/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2022-12-06-dbt-on-aws-part-5-athena/>Data Build Tool (Dbt) for Effective Data Transformation on AWS – Part 5 Athena</a><div class="post-meta mt-2"><span class=post-date>December 6, 2022</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2022-11-01-dbt-on-aws-part-4-emr-eks/featured_huad7bc56c3140ba61f8a863cb7496d5ad_91067_500x0_resize_box_3.png media="(max-width: 576px)" height=244 width=500><img class=img-fluid height=88 width=180 alt=featured.png src=/blog/2022-11-01-dbt-on-aws-part-4-emr-eks/featured_huad7bc56c3140ba61f8a863cb7496d5ad_91067_180x0_resize_box_3.png data-src=/blog/2022-11-01-dbt-on-aws-part-4-emr-eks/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2022-11-01-dbt-on-aws-part-4-emr-eks/>Data Build Tool (Dbt) for Effective Data Transformation on AWS – Part 4 EMR on EKS</a><div class="post-meta mt-2"><span class=post-date>November 1, 2022</span></div></div></div></li></ul></div></div></div></div></div></div></aside></div></main><footer class="footer mt-auto py-3 text-center container"><div class="offcanvas offcanvas-bottom h-auto" tabindex=-1 id=offcanvasActionsPanel aria-labelledby=offcanvasActionsPanelLabel><div class=offcanvas-header><div class="offcanvas-title h5" id=offcanvasActionsPanelLabel><i class="fas fa-fw fa-th-large me-1"></i>
Actions</div><button type=button class="btn-close ms-auto" data-bs-dismiss=offcanvas data-bs-target=offcanvasActionsPanel aria-label=Close></button></div><div class="offcanvas-body mt-2"><div class="actions d-flex overflow-auto align-items-center"><a role=button class="action action-go-back d-flex flex-column align-items-center me-3" href="javascript: window.history.back();"><span class="action-icon mb-2"><i class="fas fa-2x fa-chevron-circle-down" data-fa-transform=rotate-90></i></span> Go back</a>
<a role=button class="action action-reload-page d-flex flex-column align-items-center me-3"><span class="action-icon mb-2"><i class="fas fa-2x fa-redo-alt"></i></span> Reload</a>
<a role=button class="action action-copy-url d-flex flex-column align-items-center me-3"><span class="action-icon mb-2"><i class="fas fa-2x fa-link"></i></span> Copy URL</a></div></div></div><div class="row text-center"><div class="col-12 mt-2"><p class=mb-2>Jaehyeon</p><p class="text-secondary mb-2"><small>Jaehyeon works as a consultant focused on working with customers to design and build their data and analtyics solutions on AWS. He is a real-time enthusiast and writes posts on AWS, Data, Analytics, Containers and Serverless.</small></p><div class="copyright mb-2 text-secondary"><small>Copyright © 2023-2023 Jaehyeon Kim. All Rights Reserved.</small></div><nav class="social-links nav justify-content-center mb-2 mt-3"><a class="nav-link social-link p-0 me-1 mb-2" target=_blank href=/index.xml title=RSS rel=me><i class="fas fa-fw fa-2x fa-rss" style=color:#ea6221></i></a></nav></div><div class="col-12 col-lg-8 offset-0 offset-lg-1"></div></div></footer><script data-precache src=/assets/main/bundle.min.a8b2ee53f5834e0f1982fb1e1c2d427ebc1db4b3443fe433e7af402f4db481b7.js integrity="sha256-qLLuU/WDTg8ZgvseHC1CfrwdtLNEP+Qz569AL020gbc=" crossorigin=anonymous async></script><script data-precache src=/assets/icons/bundle.min.4f30d5267a9f2f9d45ed93969d45ec626100a969a8b91f71f753315a261e9034.js integrity="sha256-TzDVJnqfL51F7ZOWnUXsYmEAqWmouR9x91MxWiYekDQ=" crossorigin=anonymous defer></script>
<script data-precache src=/assets/viewer/bundle.min.7f7e123a50432aec1a2b911aa055ea464134e1c29cbdd67ff0ec18fab6ab3335.js integrity="sha256-f34SOlBDKuwaK5EaoFXqRkE04cKcvdZ/8OwY+rarMzU=" crossorigin=anonymous defer></script>
<script data-precache defer src=/assets/katex/bundle.min.f2bed17e252bf9064f3762211c0c01ca20721553c300c0870497712bd9ae4b9d.js integrity="sha256-8r7RfiUr+QZPN2IhHAwByiByFVPDAMCHBJdxK9muS50=" crossorigin=anonymous></script>
<script data-precache defer src=/assets/mermaid/bundle.min.6ac89481082878c4db0f641e78a7c950995fe4d7978008551531a080754919ca.js integrity="sha256-asiUgQgoeMTbD2QeeKfJUJlf5NeXgAhVFTGggHVJGco=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-076N8WCGWZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-076N8WCGWZ",{anonymize_ip:!1})}</script><script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.min.js").then(function(e){console.log("Successfully registered service worker",e)}).catch(function(e){console.warn("Error whilst registering service worker",e)})})</script><script src=https://giscus.app/client.js data-repo=jaehyeon-kim/jaehyeon-kim.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkyNjgwMjU0NQ==" data-category data-category-id=DIC_kwDOAZj5cc4CV2fp data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=1 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous defer></script></body></html>