<!doctype html><html class=position-relative itemscope itemtype=https://schema.org/WebPage lang=en data-bs-theme=light data-palette=blue-gray><head><script src=/assets/init/bundle.min.99cb2d6502b2c6f5d76f21079aa7b7ea5ad83125c684ac755e2a5af62cc7ad71.js integrity="sha256-mcstZQKyxvXXbyEHmqe36lrYMSXGhKx1Xipa9izHrXE=" crossorigin=anonymous></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Integrate Glue Schema Registry with Your Python Kafka App - Jaehyeon Kim</title>
<link rel=icon href=/favicon_huf63427acbec4fbe11db6a32164cc2763_6040_16x16_resize_q75_h2_box_2.webp sizes=16x16 type=image/webp><link rel=icon href=/favicon_huf63427acbec4fbe11db6a32164cc2763_6040_32x32_resize_q75_h2_box_2.webp sizes=32x32 type=image/webp><link rel=icon href=/favicon_huf63427acbec4fbe11db6a32164cc2763_6040_150x150_resize_q75_h2_box_2.webp sizes=150x150 type=image/webp><link rel=apple-touch-icon href=/favicon_huf63427acbec4fbe11db6a32164cc2763_6040_180x180_resize_q75_h2_box_2.webp sizes=180x180 type=image/webp><link rel=icon href=/favicon_huf63427acbec4fbe11db6a32164cc2763_6040_192x192_resize_q75_h2_box_2.webp sizes=192x192 type=image/webp><link rel=mask-icon href=/safari-pinned-tab.svg color=#6f42c1><meta name=keywords content="Analytics,Real-time Analytics,Data Engineering,Data Streaming,Architecture"><meta name=description content="Glue Schema Registry provides a centralized repository for managing and validating schemas for topic message data. Its features can be utilized by many AWS services when building data streaming applications. In this post, we will discuss how to integrate Python Kafka producer and consumer apps in AWS Lambda with the Glue Schema Registry."><meta name=robots content="index, follow"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jaehyeon.me/blog/2023-04-12-integrate-glue-schema-registry/featured.png"><meta name=twitter:title content="Integrate Glue Schema Registry with Your Python Kafka App"><meta name=twitter:description content="Glue Schema Registry provides a centralized repository for managing and validating schemas for topic message data. Its features can be utilized by many AWS services when building data streaming applications. In this post, we will discuss how to integrate Python Kafka producer and consumer apps in AWS Lambda with the Glue Schema Registry."><meta property="og:title" content="Integrate Glue Schema Registry with Your Python Kafka App"><meta property="og:description" content="Glue Schema Registry provides a centralized repository for managing and validating schemas for topic message data. Its features can be utilized by many AWS services when building data streaming applications. In this post, we will discuss how to integrate Python Kafka producer and consumer apps in AWS Lambda with the Glue Schema Registry."><meta property="og:type" content="article"><meta property="og:url" content="https://jaehyeon.me/blog/2023-04-12-integrate-glue-schema-registry/"><meta property="og:image" content="https://jaehyeon.me/blog/2023-04-12-integrate-glue-schema-registry/featured.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-04-12T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-25T06:29:56+11:00"><meta itemprop=name content="Integrate Glue Schema Registry with Your Python Kafka App"><meta itemprop=description content="Glue Schema Registry provides a centralized repository for managing and validating schemas for topic message data. Its features can be utilized by many AWS services when building data streaming applications. In this post, we will discuss how to integrate Python Kafka producer and consumer apps in AWS Lambda with the Glue Schema Registry."><meta itemprop=datePublished content="2023-04-12T00:00:00+00:00"><meta itemprop=dateModified content="2024-01-25T06:29:56+11:00"><meta itemprop=wordCount content="5361"><meta itemprop=image content="https://jaehyeon.me/blog/2023-04-12-integrate-glue-schema-registry/featured.png"><meta itemprop=keywords content="AWS,Amazon MSK,AWS Glue Schema Registry,AWS Lambda,AWS Serverless Application Model,Apache Kafka,Python,Docker,Docker Compose,Terraform,"><link rel=manifest href=/manifest.json><script async src="https://www.googletagmanager.com/gtag/js?id=G-076N8WCGWZ"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-076N8WCGWZ",{anonymize_ip:!1})}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2764466088407958"></script><link data-precache rel=stylesheet href="/assets/main/bundle.min.dc910a9364ba50e03d47ecf493e01f798a7ff46d1f793a172c8412e0c9867284.css" integrity="sha256-3JEKk2S6UOA9R+z0k+AfeYp/9G0feToXLIQS4MmGcoQ=" crossorigin=anonymous><link data-precache rel=stylesheet href=/assets/katex/bundle.min.a06a916255e286562e9c3684403a944bb85aebe51b00e2f1ef537987349ead12.css integrity="sha256-oGqRYlXihlYunDaEQDqUS7ha6+UbAOLx71N5hzSerRI=" crossorigin=anonymous><link data-precache rel=stylesheet href=/assets/viewer/bundle.min.8c1002839fa22c1350d6ae1eef6593120e108f973c41348be9b5065430566aaf.css integrity="sha256-jBACg5+iLBNQ1q4e72WTEg4Qj5c8QTSL6bUGVDBWaq8=" crossorigin=anonymous></head><body><header class="mb-4 sticky-top"><nav class="top-app-bar shadow navbar navbar-expand-xxl"><div class=container><a class="navbar-brand d-flex align-items-center flex-grow-1 flex-xxl-grow-0 justify-content-xxl-start ms-2 ms-xxl-0 mx-auto me-xxl-2" href=https://jaehyeon.me/>Jaehyeon Kim</a><div class="offcanvas-xxl offcanvas-end flex-grow-1" data-bs-scroll=true tabindex=-1 id=navbarMenus aria-labelledby=navbarMenusLabel><div class="offcanvas-header px-4 pb-0"><div class="offcanvas-title h5" id=navbarMenusLabel>Jaehyeon Kim</div><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas data-bs-target=#navbarMenus aria-label=Close></button></div><div class="offcanvas-body p-4 pt-0 p-xxl-0"><hr class=d-xxl-none><ul class="navbar-nav flex-row flex-wrap align-items-center me-auto"><li class="nav-item col-12 col-xxl-auto dropdown px-0"><a href=# class="nav-link dropdown-toggle" id=navbarDropdownBlog role=button data-bs-toggle=dropdown aria-expanded=false><span class="menu-icon me-1"><i class="fas fa-fw fa-blog text-warning"></i></span>Blog</a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=navbarDropdownBlog data-bs-popper=none><li><a class="dropdown-item d-flex align-items-center text-wrap text-xxl-nowrap" href=https://jaehyeon.me/archives/><span class="dropdown-item-icon me-2 p-2 rounded"><i class="fas fa-fw fa-file-archive text-primary"></i></span><div class=dropdown-item-content><p class="dropdown-item-title mb-0">Archives</p></div></a></li><li><a class="dropdown-item d-flex align-items-center text-wrap text-xxl-nowrap" href=https://jaehyeon.me/series/><span class="dropdown-item-icon me-2 p-2 rounded"><i class="fas fa-fw fa-columns"></i></span><div class=dropdown-item-content><p class="dropdown-item-title mb-1">Series</p><p class="dropdown-item-description mb-0 text-secondary">List of series.</p></div></a></li><li><a class="dropdown-item d-flex align-items-center text-wrap text-xxl-nowrap" href=https://jaehyeon.me/series/_index.zh-cn/><span class="dropdown-item-icon me-2 p-2 rounded"><i class="fas fa-fw fa-columns"></i></span><div class=dropdown-item-content><p class="dropdown-item-title mb-1">专栏</p><p class="dropdown-item-description mb-0 text-secondary">List of series.</p></div></a></li><li><a class="dropdown-item d-flex align-items-center text-wrap text-xxl-nowrap" href=https://jaehyeon.me/categories/><span class="dropdown-item-icon me-2 p-2 rounded"><i class="fas fa-fw fa-folder text-success"></i></span><div class=dropdown-item-content><p class="dropdown-item-title mb-1">Categories</p><p class="dropdown-item-description mb-0 text-secondary">List of categories.</p></div></a></li><li><a class="dropdown-item d-flex align-items-center text-wrap text-xxl-nowrap" href=https://jaehyeon.me/categories/_index.zh-cn/><span class="dropdown-item-icon me-2 p-2 rounded"><i class="fas fa-fw fa-folder text-success"></i></span><div class=dropdown-item-content><p class="dropdown-item-title mb-1">分类</p><p class="dropdown-item-description mb-0 text-secondary">List of categories.</p></div></a></li><li><a class="dropdown-item d-flex align-items-center text-wrap text-xxl-nowrap" href=https://jaehyeon.me/tags/><span class="dropdown-item-icon me-2 p-2 rounded"><i class="fas fa-fw fa-tags"></i></span><div class=dropdown-item-content><p class="dropdown-item-title mb-1">Tags</p><p class="dropdown-item-description mb-0 text-secondary">List of tags.</p></div></a></li><li><a class="dropdown-item d-flex align-items-center text-wrap text-xxl-nowrap" href=https://jaehyeon.me/tags/_index.zh-cn/><span class="dropdown-item-icon me-2 p-2 rounded"><i class="fas fa-fw fa-tags"></i></span><div class=dropdown-item-content><p class="dropdown-item-title mb-1">标签</p><p class="dropdown-item-description mb-0 text-secondary">List of tags.</p></div></a></li></ul></li></ul><hr class=d-xxl-none><form class="search-bar ms-auto my-auto" action=/search/ novalidate><div class="input-group align-items-center"><span class="btn btn-search disabled position-absolute left-0 border-0 px-1"><i class="fas fa-fw fa-search fa-lg"></i>
</span><input class="my-1 form-control border-white rounded-5 search-input bg-body" name=q type=search placeholder=Search aria-label=Search required>
<span class="search-shortcut position-absolute end-0 top-0 me-2"><kbd class="text-dark bg-white opacity-75 rounded-3 shadow border border-primary py-1 fw-bold">/</kbd></span></div></form><hr class=d-xxl-none><ul class="navbar-nav flex-row flex-wrap align-items-center ms-md-auto"><li class="nav-item py-2 py-xxl-1 col-12 col-xxl-auto"><nav class="social-links nav justify-content-center flex-row"><a class="nav-link social-link col-6 col-xxl-auto p-1" target=_blank href=https://github.com/jaehyeon-kim title=GitHub rel=me><i class="fa-fw fab fa-github"></i>
<span class="ms-1 d-xxl-none">Github</span>
</a><a class="nav-link social-link col-6 col-xxl-auto p-1" target=_blank href=https://linkedin.com/in/jaehyeon-kim-76b93429 title=LinkedIn rel=me><i class="fa-fw fab fa-linkedin-in"></i>
<span class="ms-1 d-xxl-none">Linkedin</span>
</a><a class="nav-link social-link col-6 col-xxl-auto p-1" target=_blank href=https://www.paypal.com/paypalme/dottami title=PayPal rel=me><i class="fa-fw fab fa-paypal"></i>
<span class="ms-1 d-xxl-none">Paypal</span>
</a><a class="nav-link social-link col-6 col-xxl-auto p-1" target=_blank href=/index.xml title=RSS rel=me><i class="fas fa-fw fa-rss"></i>
<span class="ms-1 d-xxl-none">RSS</span></a></nav></li><li class="nav-item py-2 py-xxl-1 col-12 col-xxl-auto"><div class="vr d-none d-xxl-flex h-100 mx-xxl-2 text-white"></div><hr class="d-xxl-none my-2"></li><li class="nav-item dropdown col-6 col-xxl-auto"><a class="nav-link px-0 py-2 px-xxl-1" href=# id=fontSizeDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-font"></i>
<span class=d-xxl-none>Font Size</span></a><ul class="font-size-dropdown-menu dropdown-menu dropdown-menu-end" aria-labelledby=fontSizeDropdown><li><button class="font-size-item dropdown-item" data-size=xs>
Extra Small</button></li><li><button class="font-size-item dropdown-item" data-size=sm>
Small</button></li><li><button class="font-size-item dropdown-item active" data-size=md>
Medium</button></li><li><button class="font-size-item dropdown-item" data-size=lg>
Large</button></li><li><button class="font-size-item dropdown-item" data-size=xl>
Extra Large</button></li></ul></li><li class="nav-item dropdown col-6 col-xxl-auto"><a class="nav-link px-0 py-2 px-xxl-1" href=# id=paletteDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-palette"></i>
<span class=d-xxl-none>Palette</span></a><ul class="palette-dropdown-menu dropdown-menu dropdown-menu-end px-2 row g-2" aria-labelledby=paletteDropdown><li class="col-4 my-1"><a role=button id=palette-blue aria-label=Blue class="btn btn-sm w-100 palette text-bg-blue" data-palette=blue></a></li><li class="col-4 my-1"><a role=button id=palette-blue-gray aria-label="Blue Gray" class="btn btn-sm w-100 palette text-bg-blue-gray" data-palette=blue-gray></a></li><li class="col-4 my-1"><a role=button id=palette-brown aria-label=Brown class="btn btn-sm w-100 palette text-bg-brown" data-palette=brown></a></li><li class="col-4 my-1"><a role=button id=palette-cyan aria-label=Cyan class="btn btn-sm w-100 palette text-bg-cyan" data-palette=cyan></a></li><li class="col-4 my-1"><a role=button id=palette-green aria-label=Green class="btn btn-sm w-100 palette text-bg-green" data-palette=green></a></li><li class="col-4 my-1"><a role=button id=palette-indigo aria-label=Indigo class="btn btn-sm w-100 palette text-bg-indigo" data-palette=indigo></a></li><li class="col-4 my-1"><a role=button id=palette-orange aria-label=Orange class="btn btn-sm w-100 palette text-bg-orange" data-palette=orange></a></li><li class="col-4 my-1"><a role=button id=palette-pink aria-label=Pink class="btn btn-sm w-100 palette text-bg-pink" data-palette=pink></a></li><li class="col-4 my-1"><a role=button id=palette-purple aria-label=Purple class="btn btn-sm w-100 palette text-bg-purple" data-palette=purple></a></li><li class="col-4 my-1"><a role=button id=palette-red aria-label=Red class="btn btn-sm w-100 palette text-bg-red" data-palette=red></a></li><li class="col-4 my-1"><a role=button id=palette-teal aria-label=Teal class="btn btn-sm w-100 palette text-bg-teal" data-palette=teal></a></li><li class="col-4 my-1"><a role=button id=palette-yellow aria-label=Yellow class="btn btn-sm w-100 palette text-bg-yellow" data-palette=yellow></a></li></ul></li><li class="nav-item dropdown col-6 col-xxl-auto"><a class="nav-link px-0 py-2 px-xxl-1" href=# id=modeDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="mode-icon fas fa-fw fa-sun" id=modeIcon></i>
<span class=d-xxl-none>Mode</span></a><ul class="mode-dropdown-menu dropdown-menu dropdown-menu-end" aria-labelledby=modeDropdown><li class="mode-item active" data-color-mode=light data-icon=sun><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-sun"></i> Light</button></li><li class=mode-item data-color-mode=dark data-icon=moon><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-moon"></i> Dark</button></li><li class=mode-item data-color-mode=auto data-icon=adjust><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-adjust"></i> Auto</button></li></ul></li></ul></div></div><div class=d-flex><button class="navbar-toggler order-5 border-0" type=button data-bs-toggle=offcanvas data-bs-target=#navbarMenus aria-controls=navbarMenus aria-expanded=false aria-label="Toggle navigation">
<i class="fas fa-ellipsis-h"></i></button></div></div></nav></header><main class=container><div class="row content"><noscript><div class="alert alert-danger" role=alert>Your browser does not support JavaScript.</div></noscript><div class=col-xxl-8><div class=container><nav class="row card component" aria-label=breadcrumb><div class="card-body pb-0"><ol class="hbs-breadcrumb breadcrumb flex-nowrap"><li class="breadcrumb-item text-surface"><a href=/>Home</a></li><li class="breadcrumb-item text-surface"><a href=/blog/>Blogs</a></li><li class="breadcrumb-item active">Integrate Glue Schema Registry With Your Python Kafka App</li></ol></div></nav><div class="post-panel-wrapper position-relative d-flex justify-content-center"><div class="d-flex flex-row justify-content-center rounded-5 border post-panel position-fixed px-3 py-1 surface shadow-1"><a class="action action-toc d-none d-xxl-block" href=#postTOC role=button title=Contents><i class="fas fa-fw fa-list-alt"></i>
</a><a class="action action-toc d-block d-xxl-none" href=#post-toc-container role=button title=Contents><i class="fas fa-fw fa-list-alt"></i>
</a><a class="action action-post-comments" href=#post-comments role=button aria-label=Comments title=Comments><i class="fas fa-fw fa-comments"></i>
</a><a id=sidebarToggler class="action action-sidebar-toggler d-none d-xxl-block" role=button title="Toggle sidebar"><i class="fas fa-fw fa-expand-alt" data-fa-transform=rotate-45></i></a></div></div><article class="row card component mb-4 post"><div class=card-header><h1 class="card-title post-title my-2">Integrate Glue Schema Registry With Your Python Kafka App</h1></div><div class=card-body><div class="post-meta mb-3"><span class="post-date me-1 mb-1" title="created on 2023-04-12 00:00:00 +0000 UTC, updated on 2024-01-24 19:29:56 +0000 UTC.">April 12, 2023</span><span class="post-reading-time me-1 mb-1">26 min read</span><a href=/categories/data-streaming/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-category">
<i class="fas fa-fw fa-folder me-1"></i>Data Streaming</a><a href=/tags/amazon-msk/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Amazon MSK</a><a href=/tags/apache-kafka/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Apache Kafka</a><a href=/tags/aws/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">AWS</a><a href=/tags/aws-glue-schema-registry/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">AWS Glue Schema Registry</a><a href=/tags/aws-lambda/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">AWS Lambda</a><a href=/tags/aws-serverless-application-model/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">AWS Serverless Application Model</a><a href=/tags/docker/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Docker</a><a href=/tags/docker-compose/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Docker Compose</a><a href=/tags/python/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Python</a><a href=/tags/terraform/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Terraform</a></div><picture class="d-flex justify-content-center"><source srcset=/blog/2023-04-12-integrate-glue-schema-registry/featured_hu57e44328735e0754f0de2b0f6335f8bb_46040_0x270_resize_box_3.png type=image/png media="(max-width: 576px)" width=443 height=270><img class="post-featured-img h-auto w-auto mb-3" alt="Integrate Glue Schema Registry with Your Python Kafka App" src=/blog/2023-04-12-integrate-glue-schema-registry/featured_hu57e44328735e0754f0de2b0f6335f8bb_46040_0x480_resize_box_3.png width=787 height=480 data-src=/blog/2023-04-12-integrate-glue-schema-registry/featured.png></picture><p class="lead mb-3 text-body-emphasis">Glue Schema Registry provides a centralized repository for managing and validating schemas for topic message data. Its features can be utilized by many AWS services when building data streaming applications. In this post, we will discuss how to integrate Python Kafka producer and consumer apps in AWS Lambda with the Glue Schema Registry.</p><div id=postTOC class="mb-3 text-surface"><h2 class=mb-3>Contents<a class="anchor ms-1" href=#postTOC></a></h2><nav id=TableOfContents><ul><li><a href=#architecture>Architecture</a></li><li><a href=#infrastructure>Infrastructure</a><ul><li><a href=#msk>MSK</a><ul><li><a href=#security-groups>Security Groups</a></li></ul></li></ul></li><li><a href=#kafka-apps>Kafka Apps</a><ul><li><a href=#producer-app>Producer App</a><ul><li><a href=#order-data>Order Data</a></li><li><a href=#producer>Producer</a></li><li><a href=#lambda-handler>Lambda Handler</a></li><li><a href=#lambda-resource>Lambda Resource</a><ul><li><a href=#iam-permission>IAM Permission</a></li></ul></li><li><a href=#eventbridge-rule>EventBridge Rule</a></li></ul></li><li><a href=#consumer-app>Consumer App</a><ul><li><a href=#lambda-handler-1>Lambda Handler</a></li><li><a href=#lambda-resource-1>Lambda Resource</a><ul><li><a href=#iam-permission-1>IAM Permission</a></li></ul></li></ul></li></ul></li><li><a href=#schema-evolution-demo>Schema Evolution Demo</a></li><li><a href=#deployment>Deployment</a><ul><li><a href=#topic-creation>Topic Creation</a></li><li><a href=#local-testing-with-sam>Local Testing with SAM</a></li><li><a href=#kafka-app-deployment>Kafka App Deployment</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav><hr class=text-secondary></div><div class="post-content mb-3" data-bs-spy=scroll data-bs-target=#TableOfContents tabindex=0><div id=post-content-body><p>As Kafka producer and consumer apps are decoupled, they operate on Kafka topics rather than communicating with each other directly. As described in the <a href=https://docs.confluent.io/platform/current/schema-registry/index.html#sr-overview target=_blank rel="noopener noreferrer">Confluent document<i class="fas fa-external-link-square-alt ms-1"></i></a>, <em>Schema Registry</em> provides a centralized repository for managing and validating schemas for topic message data, and for serialization and deserialization of the data over the network. Producers and consumers to Kafka topics can use schemas to ensure data consistency and compatibility as schemas evolve. In AWS, the <a href=https://docs.aws.amazon.com/glue/latest/dg/schema-registry.html target=_blank rel="noopener noreferrer">Glue Schema Registry<i class="fas fa-external-link-square-alt ms-1"></i></a> supports features to manage and enforce schemas on data streaming applications using convenient integrations with Apache Kafka, <a href=https://aws.amazon.com/msk/ target=_blank rel="noopener noreferrer">Amazon Managed Streaming for Apache Kafka<i class="fas fa-external-link-square-alt ms-1"></i></a>, <a href=https://aws.amazon.com/kinesis/data-streams/ target=_blank rel="noopener noreferrer">Amazon Kinesis Data Streams<i class="fas fa-external-link-square-alt ms-1"></i></a>, <a href=https://aws.amazon.com/kinesis/data-analytics/ target=_blank rel="noopener noreferrer">Amazon Kinesis Data Analytics for Apache Flink<i class="fas fa-external-link-square-alt ms-1"></i></a>, and <a href=https://aws.amazon.com/lambda/ target=_blank rel="noopener noreferrer">AWS Lambda<i class="fas fa-external-link-square-alt ms-1"></i></a>. In this post, we will discuss how to integrate Python Kafka producer and consumer apps In AWS Lambda with the Glue Schema Registry.</p><h2 id=architecture data-numberify>Architecture<a class="anchor ms-1" href=#architecture></a></h2><p>Fake online order data is generated by multiple Lambda functions that are invoked by an EventBridge schedule rule. The schedule is set to run every minute and the associating rule has a configurable number (e.g. 5) of targets. Each target points to the same Kafka producer Lambda function. In this way we are able to generate test data using multiple Lambda functions according to the desired volume of messages. Note that, before sending a message, the producer validates the schema and registers a new one if it is not registered yet. Then it serializes the message and sends it to the cluster.</p><p>Once messages are sent to a Kafka topic, they can be consumed by Lambda where <a href=https://docs.aws.amazon.com/lambda/latest/dg/with-msk.html target=_blank rel="noopener noreferrer">Amazon MSK is configured as an event source<i class="fas fa-external-link-square-alt ms-1"></i></a>. The serialized record (message key or value) includes the schema ID so that the consumer can request the schema from the schema registry (if not cached) in order to deserialize it.</p><p>The infrastructure is built by Terraform and the AWS SAM CLI is used to develop the producer Lambda function locally before deploying to AWS.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2023-04-12-integrate-glue-schema-registry/featured.png loading=lazy width=986 height=601></picture></p><h2 id=infrastructure data-numberify>Infrastructure<a class="anchor ms-1" href=#infrastructure></a></h2><p>A VPC with 3 public and private subnets is created using the <a href=https://registry.terraform.io/modules/terraform-aws-modules/vpc/aws/latest target=_blank rel="noopener noreferrer">AWS VPC Terraform module<i class="fas fa-external-link-square-alt ms-1"></i></a> (<code>vpc.tf</code>). Also, a <a href=https://www.softether.org/ target=_blank rel="noopener noreferrer">SoftEther VPN<i class="fas fa-external-link-square-alt ms-1"></i></a> server is deployed in order to access the resources in the private subnets from the developer machine (<code>vpn.tf</code>). It is particularly useful to monitor and manage the MSK cluster and Kafka topic as well as developing the Kafka producer Lambda function locally. The details about how to configure the VPN server can be found in an <a href=/blog/2022-02-06-dev-infra-terraform>earlier post</a>. The source can be found in the <a href=https://github.com/jaehyeon-kim/kafka-pocs/tree/main/glue-schema-registry target=_blank rel="noopener noreferrer"><strong>GitHub repository</strong><i class="fas fa-external-link-square-alt ms-1"></i></a> of this post.</p><h3 id=msk data-numberify>MSK<a class="anchor ms-1" href=#msk></a></h3><p>An MSK cluster with 3 brokers is created. The broker nodes are deployed with the <code>kafka.m5.large</code> instance type in private subnets and IAM authentication is used for the client authentication method. Finally, additional server configurations are added such as enabling auto creation of topics and topic deletion.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/infra/variable.tf
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=nx>locals</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=na>msk</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=na>version</span>          = <span class=s2>&#34;3.3.1&#34;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=na>instance_size</span>    = <span class=s2>&#34;kafka.m5.large&#34;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=na>ebs_volume_size</span>  = <span class=m>20</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=na>log_retention_ms</span> = <span class=m>604800000</span><span class=c1> # 7 days
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=p>}</span><span class=c1>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1># glue-schema-registry/infra/msk.tf
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_msk_cluster&#34;</span> <span class=s2>&#34;msk_data_cluster&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=na>cluster_name</span>           = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=s2>-msk-cluster&#34;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=na>kafka_version</span>          = <span class=nx>local</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>version</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=na>number_of_broker_nodes</span> =<span class=nb> length</span><span class=p>(</span><span class=nb>module</span><span class=p>.</span><span class=nx>vpc</span><span class=p>.</span><span class=nx>private_subnets</span><span class=p>)</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=nx>configuration_info</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=na>arn</span>      = <span class=nx>aws_msk_configuration</span><span class=p>.</span><span class=nx>msk_config</span><span class=p>.</span><span class=nx>arn</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=na>revision</span> = <span class=nx>aws_msk_configuration</span><span class=p>.</span><span class=nx>msk_config</span><span class=p>.</span><span class=nx>latest_revision</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>
</span></span><span class=line><span class=ln>22</span><span class=cl>  <span class=nx>broker_node_group_info</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>    <span class=na>instance_type</span>   = <span class=nx>local</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>instance_size</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=na>client_subnets</span>  = <span class=nb>module</span><span class=p>.</span><span class=nx>vpc</span><span class=p>.</span><span class=nx>private_subnets</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=na>security_groups</span> = <span class=p>[</span><span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>id</span><span class=p>]</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>    <span class=nx>storage_info</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>      <span class=nx>ebs_storage_info</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>        <span class=na>volume_size</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>ebs_volume_size</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>
</span></span><span class=line><span class=ln>33</span><span class=cl>  <span class=nx>client_authentication</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>    <span class=nx>sasl</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>      <span class=na>iam</span> = <span class=kc>true</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>
</span></span><span class=line><span class=ln>39</span><span class=cl>  <span class=nx>logging_info</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>    <span class=nx>broker_logs</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>      <span class=nx>cloudwatch_logs</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>        <span class=na>enabled</span>   = <span class=kc>true</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>        <span class=na>log_group</span> = <span class=nx>aws_cloudwatch_log_group</span><span class=p>.</span><span class=nx>msk_cluster_lg</span><span class=p>.</span><span class=nx>name</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>      <span class=nx>s3</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>        <span class=na>enabled</span> = <span class=kc>true</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>        <span class=na>bucket</span>  = <span class=nx>aws_s3_bucket</span><span class=p>.</span><span class=nx>default_bucket</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>        <span class=na>prefix</span>  = <span class=s2>&#34;logs/msk/cluster-&#34;</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>
</span></span><span class=line><span class=ln>53</span><span class=cl>  <span class=na>tags</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>tags</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>
</span></span><span class=line><span class=ln>55</span><span class=cl>  <span class=na>depends_on</span> = <span class=p>[</span><span class=nx>aws_msk_configuration</span><span class=p>.</span><span class=nx>msk_config</span><span class=p>]</span>
</span></span><span class=line><span class=ln>56</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>57</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>58</span><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_msk_configuration&#34;</span> <span class=s2>&#34;msk_config&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>  <span class=na>name</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=s2>-msk-configuration&#34;</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>
</span></span><span class=line><span class=ln>61</span><span class=cl>  <span class=na>kafka_versions</span> = <span class=p>[</span><span class=nx>local</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>version</span><span class=p>]</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>
</span></span><span class=line><span class=ln>63</span><span class=cl>  <span class=na>server_properties</span> = <span class=o>&lt;&lt;PROPERTIES</span><span class=s>
</span></span></span><span class=line><span class=ln>64</span><span class=cl><span class=s>    auto.create.topics.enable = true
</span></span></span><span class=line><span class=ln>65</span><span class=cl><span class=s>    delete.topic.enable = true
</span></span></span><span class=line><span class=ln>66</span><span class=cl><span class=s>    log.retention.ms = ${local.msk.log_retention_ms}
</span></span></span><span class=line><span class=ln>67</span><span class=cl><span class=s>  </span><span class=o>PROPERTIES</span>
</span></span><span class=line><span class=ln>68</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=security-groups data-numberify>Security Groups<a class="anchor ms-1" href=#security-groups></a></h4><p>Two security groups are created - one for the MSK cluster and the other for the Lambda apps.</p><p>The inbound/outbound rules of the former are created for accessing the cluster by</p><ul><li>Event Source Mapping (ESM) for Lambda<ul><li>This is for the Lambda consumer that subscribes the MSK cluster. As described in the <a href=https://repost.aws/knowledge-center/lambda-trigger-msk-kafka-cluster target=_blank rel="noopener noreferrer">AWS re:Post doc<i class="fas fa-external-link-square-alt ms-1"></i></a>, when a Lambda function is configured with an Amazon MSK trigger or a self-managed Kafka trigger, an ESM resource is automatically created. An ESM is separate from the Lambda function, and it continuously polls records from the topic in the Kafka cluster. The ESM bundles those records into a payload. Then, it calls the Lambda Invoke API to deliver the payload to your Lambda function for processing. Note it doesn&rsquo;t inherit the VPC network settings of the Lambda function but uses the subnet and security group settings that are configured on the target MSK cluster. Therefore, the MSK cluster&rsquo;s security group must include a rule that grants ingress traffic from itself and egress traffic to itself. For us, the rules on port 9098 as the cluster only supports IAM authentication. Also, an additional egress rule is created to access the Glue Schema Registry.</li></ul></li><li>Other Resources<ul><li>Two ingress rules are created for the VPN server and Lambda. The latter is only for the Lambda producer because the consumer doesn&rsquo;t rely on the Lambda network setting.</li></ul></li></ul><p>The second security group is created here, while the Lambda function is created in a different Terraform stack. This is for ease of adding it to the inbound rule of the MSK&rsquo;s security group. Later we will discuss how to make use of it with the Lambda function. The outbound rule allows all outbound traffic although only port 9098 for the MSK cluster and 443 for the Glue Schema Registry would be sufficient.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/infra/msk.tf
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_security_group&#34;</span> <span class=s2>&#34;msk&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=na>name</span>   = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=s2>-msk-sg&#34;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=na>vpc_id</span> = <span class=nb>module</span><span class=p>.</span><span class=nx>vpc</span><span class=p>.</span><span class=nx>vpc_id</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=nx>lifecycle</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=na>create_before_destroy</span> = <span class=kc>true</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=na>tags</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>tags</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=p>}</span><span class=c1>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1># for lambda event source mapping
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_security_group_rule&#34;</span> <span class=s2>&#34;msk_ingress_self_broker&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=na>type</span>                     = <span class=s2>&#34;ingress&#34;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=na>description</span>              = <span class=s2>&#34;msk ingress self&#34;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=na>security_group_id</span>        = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>  <span class=na>protocol</span>                 = <span class=s2>&#34;tcp&#34;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=na>from_port</span>                = <span class=m>9098</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>  <span class=na>to_port</span>                  = <span class=m>9098</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>  <span class=na>source_security_group_id</span> = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_security_group_rule&#34;</span> <span class=s2>&#34;msk_egress_self_broker&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>  <span class=na>type</span>                     = <span class=s2>&#34;egress&#34;</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>  <span class=na>description</span>              = <span class=s2>&#34;msk egress self&#34;</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>  <span class=na>security_group_id</span>        = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>  <span class=na>protocol</span>                 = <span class=s2>&#34;tcp&#34;</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>  <span class=na>from_port</span>                = <span class=m>9098</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>  <span class=na>to_port</span>                  = <span class=m>9098</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>  <span class=na>source_security_group_id</span> = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=ln>32</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>33</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_security_group_rule&#34;</span> <span class=s2>&#34;msk_all_outbound&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>  <span class=na>type</span>              = <span class=s2>&#34;egress&#34;</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>  <span class=na>description</span>       = <span class=s2>&#34;allow outbound all&#34;</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>  <span class=na>security_group_id</span> = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>  <span class=na>protocol</span>          = <span class=s2>&#34;-1&#34;</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>  <span class=na>from_port</span>         = <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>  <span class=na>to_port</span>           = <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>  <span class=na>cidr_blocks</span>       = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>42</span><span class=cl><span class=p>}</span><span class=c1>
</span></span></span><span class=line><span class=ln>43</span><span class=cl><span class=c1>
</span></span></span><span class=line><span class=ln>44</span><span class=cl><span class=c1># for other resources
</span></span></span><span class=line><span class=ln>45</span><span class=cl><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_security_group_rule&#34;</span> <span class=s2>&#34;msk_vpn_inbound&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>  <span class=na>count</span>                    = <span class=nx>local</span><span class=p>.</span><span class=nx>vpn</span><span class=p>.</span><span class=nx>to_create</span> <span class=o>?</span> <span class=m>1</span> <span class=o>:</span> <span class=m>0</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>  <span class=na>type</span>                     = <span class=s2>&#34;ingress&#34;</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>  <span class=na>description</span>              = <span class=s2>&#34;VPN access&#34;</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>  <span class=na>security_group_id</span>        = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>  <span class=na>protocol</span>                 = <span class=s2>&#34;tcp&#34;</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>  <span class=na>from_port</span>                = <span class=m>9098</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>  <span class=na>to_port</span>                  = <span class=m>9098</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>  <span class=na>source_security_group_id</span> = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>vpn</span><span class=p>[</span><span class=m>0</span><span class=p>].</span><span class=nx>id</span>
</span></span><span class=line><span class=ln>54</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>55</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>56</span><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_security_group_rule&#34;</span> <span class=s2>&#34;msk_lambda_inbound&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>  <span class=na>type</span>                     = <span class=s2>&#34;ingress&#34;</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>  <span class=na>description</span>              = <span class=s2>&#34;lambda access&#34;</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>  <span class=na>security_group_id</span>        = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>msk</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>  <span class=na>protocol</span>                 = <span class=s2>&#34;tcp&#34;</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>  <span class=na>from_port</span>                = <span class=m>9098</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>  <span class=na>to_port</span>                  = <span class=m>9098</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>  <span class=na>source_security_group_id</span> = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>kafka_app_lambda</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=ln>64</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>65</span><span class=cl>
</span></span><span class=line><span class=ln>66</span><span class=cl><span class=p>...</span><span class=c1>
</span></span></span><span class=line><span class=ln>67</span><span class=cl><span class=c1>
</span></span></span><span class=line><span class=ln>68</span><span class=cl><span class=c1># lambda security group
</span></span></span><span class=line><span class=ln>69</span><span class=cl><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_security_group&#34;</span> <span class=s2>&#34;kafka_app_lambda&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>70</span><span class=cl>  <span class=na>name</span>   = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=s2>-lambda-msk-access&#34;</span>
</span></span><span class=line><span class=ln>71</span><span class=cl>  <span class=na>vpc_id</span> = <span class=nb>module</span><span class=p>.</span><span class=nx>vpc</span><span class=p>.</span><span class=nx>vpc_id</span>
</span></span><span class=line><span class=ln>72</span><span class=cl>
</span></span><span class=line><span class=ln>73</span><span class=cl>  <span class=nx>lifecycle</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>74</span><span class=cl>    <span class=na>create_before_destroy</span> = <span class=kc>true</span>
</span></span><span class=line><span class=ln>75</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>76</span><span class=cl>
</span></span><span class=line><span class=ln>77</span><span class=cl>  <span class=na>tags</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>tags</span>
</span></span><span class=line><span class=ln>78</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>79</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>80</span><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_security_group_rule&#34;</span> <span class=s2>&#34;kafka_app_lambda_msk_egress&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>81</span><span class=cl>  <span class=na>type</span>              = <span class=s2>&#34;egress&#34;</span>
</span></span><span class=line><span class=ln>82</span><span class=cl>  <span class=na>description</span>       = <span class=s2>&#34;allow outbound all&#34;</span>
</span></span><span class=line><span class=ln>83</span><span class=cl>  <span class=na>security_group_id</span> = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>kafka_app_lambda</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=ln>84</span><span class=cl>  <span class=na>protocol</span>          = <span class=s2>&#34;-1&#34;</span>
</span></span><span class=line><span class=ln>85</span><span class=cl>  <span class=na>from_port</span>         = <span class=m>0</span>
</span></span><span class=line><span class=ln>86</span><span class=cl>  <span class=na>to_port</span>           = <span class=m>0</span>
</span></span><span class=line><span class=ln>87</span><span class=cl>  <span class=na>cidr_blocks</span>       = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>88</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=kafka-apps data-numberify>Kafka Apps<a class="anchor ms-1" href=#kafka-apps></a></h2><p>The resources related to the Kafka producer and consumer Lambda functions are managed in a separate Terraform stack. This is because it is easier to build the relevant resources iteratively. Note the SAM CLI builds the whole Terraform stack even for a small change of code, and it wouldn’t be convenient if the entire resources are managed in the same stack.</p><h3 id=producer-app data-numberify>Producer App<a class="anchor ms-1" href=#producer-app></a></h3><h4 id=order-data data-numberify>Order Data<a class="anchor ms-1" href=#order-data></a></h4><p>Fake order data is generated using the <a href=https://faker.readthedocs.io/en/master/ target=_blank rel="noopener noreferrer">Faker<i class="fas fa-external-link-square-alt ms-1"></i></a> package and the <a href=https://pypi.org/project/dataclasses-avroschema/ target=_blank rel="noopener noreferrer">dataclasses_avroschema<i class="fas fa-external-link-square-alt ms-1"></i></a> package is used to automatically generate the Avro schema according to its attributes. A mixin class called <em>InjectCompatMixin</em> is injected into the <em>Order</em> class, which specifies a schema <a href=https://docs.aws.amazon.com/glue/latest/dg/schema-registry.html#schema-registry-compatibility target=_blank rel="noopener noreferrer">compatibility mode<i class="fas fa-external-link-square-alt ms-1"></i></a> into the generated schema. The <code>auto()</code> class method is used to instantiate the class automatically. Finally, the <em>OrderMore</em> class is created for the schema evolution demo, which will be discussed later.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/app/producer/src/order.py</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=kn>import</span> <span class=nn>typing</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=kn>import</span> <span class=nn>dataclasses</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=kn>import</span> <span class=nn>enum</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=kn>from</span> <span class=nn>faker</span> <span class=kn>import</span> <span class=n>Faker</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=kn>from</span> <span class=nn>dataclasses_avroschema</span> <span class=kn>import</span> <span class=n>AvroModel</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=k>class</span> <span class=nc>Compatibility</span><span class=p>(</span><span class=n>enum</span><span class=o>.</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=n>NONE</span> <span class=o>=</span> <span class=s2>&#34;NONE&#34;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=n>DISABLED</span> <span class=o>=</span> <span class=s2>&#34;DISABLED&#34;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=n>BACKWARD</span> <span class=o>=</span> <span class=s2>&#34;BACKWARD&#34;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=n>BACKWARD_ALL</span> <span class=o>=</span> <span class=s2>&#34;BACKWARD_ALL&#34;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=n>FORWARD</span> <span class=o>=</span> <span class=s2>&#34;FORWARD&#34;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=n>FORWARD_ALL</span> <span class=o>=</span> <span class=s2>&#34;FORWARD_ALL&#34;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=n>FULL</span> <span class=o>=</span> <span class=s2>&#34;FULL&#34;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=n>FULL_ALL</span> <span class=o>=</span> <span class=s2>&#34;FULL_ALL&#34;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>
</span></span><span class=line><span class=ln>23</span><span class=cl>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=k>class</span> <span class=nc>InjectCompatMixin</span><span class=p>:</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=nd>@classmethod</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>    <span class=k>def</span> <span class=nf>updated_avro_schema_to_python</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>compat</span><span class=p>:</span> <span class=n>Compatibility</span> <span class=o>=</span> <span class=n>Compatibility</span><span class=o>.</span><span class=n>BACKWARD</span><span class=p>):</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>        <span class=n>schema</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>avro_schema_to_python</span><span class=p>()</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>        <span class=n>schema</span><span class=p>[</span><span class=s2>&#34;compatibility&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>compat</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>        <span class=k>return</span> <span class=n>schema</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>
</span></span><span class=line><span class=ln>31</span><span class=cl>    <span class=nd>@classmethod</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>    <span class=k>def</span> <span class=nf>updated_avro_schema</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>compat</span><span class=p>:</span> <span class=n>Compatibility</span> <span class=o>=</span> <span class=n>Compatibility</span><span class=o>.</span><span class=n>BACKWARD</span><span class=p>):</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>        <span class=n>schema</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>updated_avro_schema_to_python</span><span class=p>(</span><span class=n>compat</span><span class=p>)</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>schema</span><span class=p>)</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>
</span></span><span class=line><span class=ln>36</span><span class=cl>
</span></span><span class=line><span class=ln>37</span><span class=cl><span class=nd>@dataclasses.dataclass</span>
</span></span><span class=line><span class=ln>38</span><span class=cl><span class=k>class</span> <span class=nc>OrderItem</span><span class=p>(</span><span class=n>AvroModel</span><span class=p>):</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>    <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>    <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>
</span></span><span class=line><span class=ln>42</span><span class=cl>
</span></span><span class=line><span class=ln>43</span><span class=cl><span class=nd>@dataclasses.dataclass</span>
</span></span><span class=line><span class=ln>44</span><span class=cl><span class=k>class</span> <span class=nc>Order</span><span class=p>(</span><span class=n>AvroModel</span><span class=p>,</span> <span class=n>InjectCompatMixin</span><span class=p>):</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>    <span class=s2>&#34;Online fake order item&#34;</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>    <span class=n>order_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>    <span class=n>ordered_at</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>    <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>    <span class=n>order_items</span><span class=p>:</span> <span class=n>typing</span><span class=o>.</span><span class=n>List</span><span class=p>[</span><span class=n>OrderItem</span><span class=p>]</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>
</span></span><span class=line><span class=ln>51</span><span class=cl>    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>        <span class=n>namespace</span> <span class=o>=</span> <span class=s2>&#34;Order V1&#34;</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>
</span></span><span class=line><span class=ln>54</span><span class=cl>    <span class=k>def</span> <span class=nf>asdict</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>        <span class=k>return</span> <span class=n>dataclasses</span><span class=o>.</span><span class=n>asdict</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>
</span></span><span class=line><span class=ln>57</span><span class=cl>    <span class=nd>@classmethod</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>    <span class=k>def</span> <span class=nf>auto</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>fake</span><span class=p>:</span> <span class=n>Faker</span> <span class=o>=</span> <span class=n>Faker</span><span class=p>()):</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>        <span class=n>rand_int</span> <span class=o>=</span> <span class=n>fake</span><span class=o>.</span><span class=n>random_int</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>        <span class=n>user_id</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>            <span class=p>[</span><span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span><span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>s</span><span class=p>)]</span> <span class=k>if</span> <span class=n>s</span><span class=o>.</span><span class=n>isdigit</span><span class=p>()</span> <span class=k>else</span> <span class=n>s</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=nb>hex</span><span class=p>(</span><span class=n>rand_int</span><span class=p>)]</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>        <span class=p>)[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>        <span class=n>order_items</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>            <span class=n>OrderItem</span><span class=p>(</span><span class=n>fake</span><span class=o>.</span><span class=n>random_int</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>9999</span><span class=p>),</span> <span class=n>fake</span><span class=o>.</span><span class=n>random_int</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=ln>65</span><span class=cl>            <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>fake</span><span class=o>.</span><span class=n>random_int</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=ln>66</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>67</span><span class=cl>        <span class=k>return</span> <span class=bp>cls</span><span class=p>(</span><span class=n>fake</span><span class=o>.</span><span class=n>uuid4</span><span class=p>(),</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>(),</span> <span class=n>user_id</span><span class=p>,</span> <span class=n>order_items</span><span class=p>)</span>
</span></span><span class=line><span class=ln>68</span><span class=cl>
</span></span><span class=line><span class=ln>69</span><span class=cl>    <span class=k>def</span> <span class=nf>create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>num</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=ln>70</span><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>auto</span><span class=p>()</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num</span><span class=p>)]</span>
</span></span><span class=line><span class=ln>71</span><span class=cl>
</span></span><span class=line><span class=ln>72</span><span class=cl>
</span></span><span class=line><span class=ln>73</span><span class=cl><span class=nd>@dataclasses.dataclass</span>
</span></span><span class=line><span class=ln>74</span><span class=cl><span class=k>class</span> <span class=nc>OrderMore</span><span class=p>(</span><span class=n>Order</span><span class=p>):</span>
</span></span><span class=line><span class=ln>75</span><span class=cl>    <span class=n>is_prime</span><span class=p>:</span> <span class=nb>bool</span>
</span></span><span class=line><span class=ln>76</span><span class=cl>
</span></span><span class=line><span class=ln>77</span><span class=cl>    <span class=nd>@classmethod</span>
</span></span><span class=line><span class=ln>78</span><span class=cl>    <span class=k>def</span> <span class=nf>auto</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>fake</span><span class=p>:</span> <span class=n>Faker</span> <span class=o>=</span> <span class=n>Faker</span><span class=p>()):</span>
</span></span><span class=line><span class=ln>79</span><span class=cl>        <span class=n>o</span> <span class=o>=</span> <span class=n>Order</span><span class=o>.</span><span class=n>auto</span><span class=p>()</span>
</span></span><span class=line><span class=ln>80</span><span class=cl>        <span class=k>return</span> <span class=bp>cls</span><span class=p>(</span><span class=n>o</span><span class=o>.</span><span class=n>order_id</span><span class=p>,</span> <span class=n>o</span><span class=o>.</span><span class=n>ordered_at</span><span class=p>,</span> <span class=n>o</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span> <span class=n>o</span><span class=o>.</span><span class=n>order_items</span><span class=p>,</span> <span class=n>fake</span><span class=o>.</span><span class=n>pybool</span><span class=p>())</span>
</span></span></code></pre></div><p>The generated schema of the <code>Order</code> class can be found below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln> 1</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>	<span class=nt>&#34;doc&#34;</span><span class=p>:</span> <span class=s2>&#34;Online fake order item&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>	<span class=nt>&#34;namespace&#34;</span><span class=p>:</span> <span class=s2>&#34;Order V1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>	<span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Order&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>	<span class=nt>&#34;compatibility&#34;</span><span class=p>:</span> <span class=s2>&#34;BACKWARD&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>	<span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;record&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>	<span class=nt>&#34;fields&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>			<span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;order_id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>			<span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>			<span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;ordered_at&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>			<span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>				<span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;long&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>				<span class=nt>&#34;logicalType&#34;</span><span class=p>:</span> <span class=s2>&#34;timestamp-millis&#34;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>			<span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;user_id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>			<span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>			<span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;order_items&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>			<span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>				<span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;array&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>				<span class=nt>&#34;items&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>					<span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;record&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>					<span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;OrderItem&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>					<span class=nt>&#34;fields&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>						<span class=p>{</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>							<span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;product_id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>							<span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;long&#34;</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>						<span class=p>},</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>						<span class=p>{</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>							<span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;quantity&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>							<span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;long&#34;</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>						<span class=p>}</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>					<span class=p>]</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>				<span class=p>},</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>				<span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;order_item&#34;</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>	<span class=p>]</span>
</span></span><span class=line><span class=ln>45</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Below shows an example order record.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln> 1</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=nt>&#34;order_id&#34;</span><span class=p>:</span> <span class=s2>&#34;53263c42-81b3-4a53-8067-fcdb44fa5479&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=nt>&#34;ordered_at&#34;</span><span class=p>:</span> <span class=mi>1680745813045</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=nt>&#34;user_id&#34;</span><span class=p>:</span> <span class=s2>&#34;dicxa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=nt>&#34;order_items&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>      <span class=nt>&#34;product_id&#34;</span><span class=p>:</span> <span class=mi>5947</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>      <span class=nt>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>8</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=producer data-numberify>Producer<a class="anchor ms-1" href=#producer></a></h4><p>The <a href=https://pypi.org/project/aws-glue-schema-registry/ target=_blank rel="noopener noreferrer">aws-glue-schema-registry<i class="fas fa-external-link-square-alt ms-1"></i></a> package is used serialize the value of order messages. It provides the <em>KafkaSerializer</em> class that validates, registers and serializes the relevant records. It supports Json and Avro schemas, and we can add it to the <em>value_serializer</em> argument of the <em>KafkaProducer</em> class. By default, the schemas are named as <code>&lt;topic>-key</code> and <code>&lt;topic>-value</code> and it can be changed by updating the <a href=https://github.com/DisasterAWARE/aws-glue-schema-registry-python/blob/main/src/aws_schema_registry/serde.py#L54 target=_blank rel="noopener noreferrer"><em>schema_naming_strategy</em> argument<i class="fas fa-external-link-square-alt ms-1"></i></a>. Note that, when sending a message, the value should be a tuple of data and schema. Note also that the stable version of the <a href=https://kafka-python.readthedocs.io/en/master/index.html target=_blank rel="noopener noreferrer">kafka-python<i class="fas fa-external-link-square-alt ms-1"></i></a> package does not support the IAM authentication method. Therefore, we need to install the package from a forked repository as discussed in this <a href=https://github.com/dpkp/kafka-python/pull/2255 target=_blank rel="noopener noreferrer">GitHub issue<i class="fas fa-external-link-square-alt ms-1"></i></a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/app/producer/src/producer.py</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=kn>import</span> <span class=nn>typing</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=kn>import</span> <span class=nn>botocore.exceptions</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=kn>from</span> <span class=nn>kafka</span> <span class=kn>import</span> <span class=n>KafkaProducer</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=kn>from</span> <span class=nn>aws_schema_registry</span> <span class=kn>import</span> <span class=n>SchemaRegistryClient</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=kn>from</span> <span class=nn>aws_schema_registry.avro</span> <span class=kn>import</span> <span class=n>AvroSchema</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=kn>from</span> <span class=nn>aws_schema_registry.adapter.kafka</span> <span class=kn>import</span> <span class=n>KafkaSerializer</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=kn>from</span> <span class=nn>aws_schema_registry.exception</span> <span class=kn>import</span> <span class=n>SchemaRegistryException</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=kn>from</span> <span class=nn>.order</span> <span class=kn>import</span> <span class=n>Order</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=k>class</span> <span class=nc>Producer</span><span class=p>:</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bootstrap_servers</span><span class=p>:</span> <span class=nb>list</span><span class=p>,</span> <span class=n>topic</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>registry</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>is_local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span> <span class=o>=</span> <span class=n>bootstrap_servers</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>topic</span> <span class=o>=</span> <span class=n>topic</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>registry</span> <span class=o>=</span> <span class=n>registry</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>glue_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>            <span class=s2>&#34;glue&#34;</span><span class=p>,</span> <span class=n>region_name</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;AWS_DEFAULT_REGION&#34;</span><span class=p>,</span> <span class=s2>&#34;ap-southeast-2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_local</span> <span class=o>=</span> <span class=n>is_local</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create</span><span class=p>()</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=nd>@property</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=k>def</span> <span class=nf>serializer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>        <span class=n>client</span> <span class=o>=</span> <span class=n>SchemaRegistryClient</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>glue_client</span><span class=p>,</span> <span class=n>registry_name</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>registry</span><span class=p>)</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>        <span class=k>return</span> <span class=n>KafkaSerializer</span><span class=p>(</span><span class=n>client</span><span class=p>)</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>
</span></span><span class=line><span class=ln>34</span><span class=cl>    <span class=k>def</span> <span class=nf>create</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>            <span class=s2>&#34;bootstrap_servers&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>bootstrap_servers</span><span class=p>,</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>            <span class=s2>&#34;key_serializer&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>serialize</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>            <span class=s2>&#34;value_serializer&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>serializer</span><span class=p>,</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_local</span><span class=p>:</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>            <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>                <span class=o>**</span><span class=n>params</span><span class=p>,</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>                <span class=o>**</span><span class=p>{</span><span class=s2>&#34;security_protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;SASL_SSL&#34;</span><span class=p>,</span> <span class=s2>&#34;sasl_mechanism&#34;</span><span class=p>:</span> <span class=s2>&#34;AWS_MSK_IAM&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>        <span class=k>return</span> <span class=n>KafkaProducer</span><span class=p>(</span><span class=o>**</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>
</span></span><span class=line><span class=ln>47</span><span class=cl>    <span class=k>def</span> <span class=nf>send</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>orders</span><span class=p>:</span> <span class=n>typing</span><span class=o>.</span><span class=n>List</span><span class=p>[</span><span class=n>Order</span><span class=p>],</span> <span class=n>schema</span><span class=p>:</span> <span class=n>AvroSchema</span><span class=p>):</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_registry</span><span class=p>():</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;registry not found, create </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>registry</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>create_registry</span><span class=p>()</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>
</span></span><span class=line><span class=ln>52</span><span class=cl>        <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=n>orders</span><span class=p>:</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>order</span><span class=o>.</span><span class=n>asdict</span><span class=p>()</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;order_id&#34;</span><span class=p>:</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;order_id&#34;</span><span class=p>]},</span> <span class=n>value</span><span class=o>=</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>schema</span><span class=p>)</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>            <span class=k>except</span> <span class=n>SchemaRegistryException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>                <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&#34;fails to send a message&#34;</span><span class=p>)</span> <span class=kn>from</span> <span class=nn>e</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>
</span></span><span class=line><span class=ln>62</span><span class=cl>    <span class=k>def</span> <span class=nf>serialize</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>):</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>):</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>            <span class=k>return</span> <span class=n>obj</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=ln>65</span><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>date</span><span class=p>):</span>
</span></span><span class=line><span class=ln>66</span><span class=cl>            <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
</span></span><span class=line><span class=ln>67</span><span class=cl>        <span class=k>return</span> <span class=n>obj</span>
</span></span><span class=line><span class=ln>68</span><span class=cl>
</span></span><span class=line><span class=ln>69</span><span class=cl>    <span class=k>def</span> <span class=nf>check_registry</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=ln>70</span><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=ln>71</span><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>glue_client</span><span class=o>.</span><span class=n>get_registry</span><span class=p>(</span><span class=n>RegistryId</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;RegistryName&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>registry</span><span class=p>})</span>
</span></span><span class=line><span class=ln>72</span><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=ln>73</span><span class=cl>        <span class=k>except</span> <span class=n>botocore</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>ClientError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=ln>74</span><span class=cl>            <span class=k>if</span> <span class=n>e</span><span class=o>.</span><span class=n>response</span><span class=p>[</span><span class=s2>&#34;Error&#34;</span><span class=p>][</span><span class=s2>&#34;Code&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;EntityNotFoundException&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=ln>75</span><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=ln>76</span><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=ln>77</span><span class=cl>                <span class=k>raise</span> <span class=n>e</span>
</span></span><span class=line><span class=ln>78</span><span class=cl>
</span></span><span class=line><span class=ln>79</span><span class=cl>    <span class=k>def</span> <span class=nf>create_registry</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=ln>80</span><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=ln>81</span><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>glue_client</span><span class=o>.</span><span class=n>create_registry</span><span class=p>(</span><span class=n>RegistryName</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>registry</span><span class=p>)</span>
</span></span><span class=line><span class=ln>82</span><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=ln>83</span><span class=cl>        <span class=k>except</span> <span class=n>botocore</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>ClientError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=ln>84</span><span class=cl>            <span class=k>if</span> <span class=n>e</span><span class=o>.</span><span class=n>response</span><span class=p>[</span><span class=s2>&#34;Error&#34;</span><span class=p>][</span><span class=s2>&#34;Code&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;AlreadyExistsException&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=ln>85</span><span class=cl>                <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=ln>86</span><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=ln>87</span><span class=cl>                <span class=k>raise</span> <span class=n>e</span>
</span></span></code></pre></div><h4 id=lambda-handler data-numberify>Lambda Handler<a class="anchor ms-1" href=#lambda-handler></a></h4><p>The Lambda function sends 100 records at a time followed by sleeping for 1 second. It repeats until it reaches <em>MAX_RUN_SEC</em> (e.g. 60) environment variable value. The last conditional block is for demonstrating a schema evolution example, which will be discussed later.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/app/producer/lambda_handler.py</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=kn>from</span> <span class=nn>aws_schema_registry.avro</span> <span class=kn>import</span> <span class=n>AvroSchema</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=kn>from</span> <span class=nn>src.order</span> <span class=kn>import</span> <span class=n>Order</span><span class=p>,</span> <span class=n>OrderMore</span><span class=p>,</span> <span class=n>Compatibility</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=kn>from</span> <span class=nn>src.producer</span> <span class=kn>import</span> <span class=n>Producer</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=k>def</span> <span class=nf>lambda_function</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=n>producer</span> <span class=o>=</span> <span class=n>Producer</span><span class=p>(</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>        <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&#34;BOOTSTRAP_SERVERS&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>        <span class=n>topic</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&#34;TOPIC_NAME&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=n>registry</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&#34;REGISTRY_NAME&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=n>ttl_rec</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>        <span class=n>orders</span> <span class=o>=</span> <span class=n>Order</span><span class=o>.</span><span class=n>auto</span><span class=p>()</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>        <span class=n>schema</span> <span class=o>=</span> <span class=n>AvroSchema</span><span class=p>(</span><span class=n>Order</span><span class=o>.</span><span class=n>updated_avro_schema</span><span class=p>(</span><span class=n>Compatibility</span><span class=o>.</span><span class=n>BACKWARD</span><span class=p>))</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>        <span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>orders</span><span class=p>,</span> <span class=n>schema</span><span class=p>)</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>        <span class=n>ttl_rec</span> <span class=o>+=</span> <span class=nb>len</span><span class=p>(</span><span class=n>orders</span><span class=p>)</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;sent </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>orders</span><span class=p>)</span><span class=si>}</span><span class=s2> messages&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>        <span class=n>elapsed_sec</span> <span class=o>=</span> <span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span> <span class=o>-</span> <span class=n>s</span><span class=p>)</span><span class=o>.</span><span class=n>seconds</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>        <span class=k>if</span> <span class=n>elapsed_sec</span> <span class=o>&gt;</span> <span class=nb>int</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;MAX_RUN_SEC&#34;</span><span class=p>,</span> <span class=s2>&#34;60&#34;</span><span class=p>)):</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>ttl_rec</span><span class=si>}</span><span class=s2> records are sent in </span><span class=si>{</span><span class=n>elapsed_sec</span><span class=si>}</span><span class=s2> seconds ...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>
</span></span><span class=line><span class=ln>32</span><span class=cl>
</span></span><span class=line><span class=ln>33</span><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>    <span class=n>producer</span> <span class=o>=</span> <span class=n>Producer</span><span class=p>(</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>        <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&#34;BOOTSTRAP_SERVERS&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>        <span class=n>topic</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&#34;TOPIC_NAME&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>        <span class=n>registry</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&#34;REGISTRY_NAME&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>        <span class=n>is_local</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>    <span class=n>use_more</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;USE_MORE&#34;</span><span class=p>)</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>use_more</span><span class=p>:</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>        <span class=n>orders</span> <span class=o>=</span> <span class=n>Order</span><span class=o>.</span><span class=n>auto</span><span class=p>()</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>        <span class=n>schema</span> <span class=o>=</span> <span class=n>AvroSchema</span><span class=p>(</span><span class=n>Order</span><span class=o>.</span><span class=n>updated_avro_schema</span><span class=p>(</span><span class=n>Compatibility</span><span class=o>.</span><span class=n>BACKWARD</span><span class=p>))</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>        <span class=n>orders</span> <span class=o>=</span> <span class=n>OrderMore</span><span class=o>.</span><span class=n>auto</span><span class=p>()</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>        <span class=n>schema</span> <span class=o>=</span> <span class=n>AvroSchema</span><span class=p>(</span><span class=n>OrderMore</span><span class=o>.</span><span class=n>updated_avro_schema</span><span class=p>(</span><span class=n>Compatibility</span><span class=o>.</span><span class=n>BACKWARD</span><span class=p>))</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>orders</span><span class=p>)</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>    <span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>orders</span><span class=p>,</span> <span class=n>schema</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=lambda-resource data-numberify>Lambda Resource<a class="anchor ms-1" href=#lambda-resource></a></h4><p>The VPC, subnets, Lambda security group and MSK cluster are created in the infra Terraform stack, and they need to be obtained from the Kafka app stack. It can be achieved using the Terraform data sources as shown below. Note that the private subnets can be filtered by a specific tag (<em>Tier: Private</em>), which is added when creating them.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/infra/vpc.tf
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=kr>module</span> <span class=s2>&#34;vpc&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=na>source</span>  = <span class=s2>&#34;terraform-aws-modules/vpc/aws&#34;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=na>version</span> = <span class=s2>&#34;~&gt; 3.14&#34;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=na>name</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=s2>-vpc&#34;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=na>cidr</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>vpc</span><span class=p>.</span><span class=nx>cidr</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=na>azs</span>             = <span class=nx>local</span><span class=p>.</span><span class=nx>vpc</span><span class=p>.</span><span class=nx>azs</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=na>public_subnets</span>  = <span class=p>[</span><span class=k>for</span> <span class=nx>k</span><span class=p>,</span> <span class=nx>v</span> <span class=k>in</span> <span class=nx>local</span><span class=p>.</span><span class=nx>vpc</span><span class=p>.</span><span class=nx>azs</span> <span class=o>:</span> <span class=nb>cidrsubnet</span><span class=p>(</span><span class=nx>local</span><span class=p>.</span><span class=nx>vpc</span><span class=p>.</span><span class=nx>cidr</span><span class=p>,</span> <span class=m>3</span><span class=p>,</span> <span class=nx>k</span><span class=p>)]</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=na>private_subnets</span> = <span class=p>[</span><span class=k>for</span> <span class=nx>k</span><span class=p>,</span> <span class=nx>v</span> <span class=k>in</span> <span class=nx>local</span><span class=p>.</span><span class=nx>vpc</span><span class=p>.</span><span class=nx>azs</span> <span class=o>:</span> <span class=nb>cidrsubnet</span><span class=p>(</span><span class=nx>local</span><span class=p>.</span><span class=nx>vpc</span><span class=p>.</span><span class=nx>cidr</span><span class=p>,</span> <span class=m>3</span><span class=p>,</span> <span class=nx>k</span> <span class=o>+</span> <span class=m>3</span><span class=p>)]</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=na>private_subnet_tags</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=s2>&#34;Tier&#34;</span> <span class=o>=</span> <span class=s2>&#34;Private&#34;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=na>tags</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>tags</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=p>}</span><span class=c1>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=c1>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=c1># glue-schema-registry/app/variables.tf
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1></span><span class=kr>data</span> <span class=s2>&#34;aws_caller_identity&#34;</span> <span class=s2>&#34;current&#34;</span> <span class=p>{}</span>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=kr>data</span> <span class=s2>&#34;aws_region&#34;</span> <span class=s2>&#34;current&#34;</span> <span class=p>{}</span>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=kr>data</span> <span class=s2>&#34;aws_vpc&#34;</span> <span class=s2>&#34;selected&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>  <span class=nx>filter</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=na>name</span>   = <span class=s2>&#34;tag:Name&#34;</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=na>values</span> = <span class=p>[</span><span class=s2>&#34;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>infra_prefix</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>32</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>33</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=kr>data</span> <span class=s2>&#34;aws_subnets&#34;</span> <span class=s2>&#34;private&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>  <span class=nx>filter</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>    <span class=na>name</span>   = <span class=s2>&#34;vpc-id&#34;</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>    <span class=na>values</span> = <span class=p>[</span><span class=nb>data</span><span class=p>.</span><span class=nx>aws_vpc</span><span class=p>.</span><span class=nx>selected</span><span class=p>.</span><span class=nx>id</span><span class=p>]</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>
</span></span><span class=line><span class=ln>40</span><span class=cl>  <span class=na>tags</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>    <span class=na>Tier</span> = <span class=s2>&#34;Private&#34;</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>43</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>44</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>45</span><span class=cl><span class=kr>data</span> <span class=s2>&#34;aws_msk_cluster&#34;</span> <span class=s2>&#34;msk_data_cluster&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>  <span class=na>cluster_name</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>infra_prefix</span><span class=si>}</span><span class=s2>-msk-cluster&#34;</span>
</span></span><span class=line><span class=ln>47</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>48</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>49</span><span class=cl><span class=kr>data</span> <span class=s2>&#34;aws_security_group&#34;</span> <span class=s2>&#34;kafka_producer_lambda&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>  <span class=na>name</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>infra_prefix</span><span class=si>}</span><span class=s2>-lambda-msk-access&#34;</span>
</span></span><span class=line><span class=ln>51</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>
</span></span><span class=line><span class=ln>53</span><span class=cl>
</span></span><span class=line><span class=ln>54</span><span class=cl><span class=nx>locals</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>  <span class=na>infra_prefix</span> = <span class=s2>&#34;glue-schema-registry&#34;</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=ln>58</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <a href=https://registry.terraform.io/modules/terraform-aws-modules/lambda/aws/4.7.2 target=_blank rel="noopener noreferrer">AWS Lambda Terraform module<i class="fas fa-external-link-square-alt ms-1"></i></a> is used to create the producer Lambda function. Note that, in order to develop a Lambda function using AWS SAM, we need to create SAM metadata resource, which provides the AWS SAM CLI with the information it needs to locate Lambda functions and layers, along with their source code, build dependencies, and build logic from within your Terraform project. It is created by default by the Terraform module, which is convenient. Also, we need to give permission to the EventBridge rule to invoke the Lambda function, and it is given by the <code>aws_lambda_permission</code> resource.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/app/variables.tf
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=nx>locals</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=na>name</span>        = <span class=nx>local</span><span class=p>.</span><span class=nx>infra_prefix</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=na>region</span>      = <span class=nb>data</span><span class=p>.</span><span class=nx>aws_region</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>name</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=na>environment</span> = <span class=s2>&#34;dev&#34;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=na>infra_prefix</span> = <span class=s2>&#34;glue-schema-registry&#34;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=na>producer</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=na>src_path</span>          = <span class=s2>&#34;producer&#34;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=na>function_name</span>     = <span class=s2>&#34;kafka_producer&#34;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=na>handler</span>           = <span class=s2>&#34;lambda_handler.lambda_function&#34;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=na>concurrency</span>       = <span class=m>5</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=na>timeout</span>           = <span class=m>90</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=na>memory_size</span>       = <span class=m>128</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=na>runtime</span>           = <span class=s2>&#34;python3.8&#34;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=na>schedule_rate</span>     = <span class=s2>&#34;rate(1 minute)&#34;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=na>to_enable_trigger</span> = <span class=kc>true</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=na>environment</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>      <span class=na>topic_name</span>    = <span class=s2>&#34;orders&#34;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>      <span class=na>registry_name</span> = <span class=s2>&#34;customer&#34;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>      <span class=na>max_run_sec</span>   = <span class=m>60</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>
</span></span><span class=line><span class=ln>26</span><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=p>}</span><span class=c1>
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=c1>
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=c1># glue-schema-registry/app/main.tf
</span></span></span><span class=line><span class=ln>30</span><span class=cl><span class=c1></span><span class=kr>module</span> <span class=s2>&#34;kafka_producer_lambda&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>  <span class=na>source</span> = <span class=s2>&#34;terraform-aws-modules/lambda/aws&#34;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>
</span></span><span class=line><span class=ln>33</span><span class=cl>  <span class=na>function_name</span>          = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>function_name</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>  <span class=na>handler</span>                = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>handler</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>  <span class=na>runtime</span>                = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>runtime</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>  <span class=na>timeout</span>                = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>timeout</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>  <span class=na>memory_size</span>            = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>memory_size</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>  <span class=na>source_path</span>            = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>src_path</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>  <span class=na>vpc_subnet_ids</span>         = <span class=nb>data</span><span class=p>.</span><span class=nx>aws_subnets</span><span class=p>.</span><span class=nx>private</span><span class=p>.</span><span class=nx>ids</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>  <span class=na>vpc_security_group_ids</span> = <span class=p>[</span><span class=nb>data</span><span class=p>.</span><span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>kafka_app_lambda</span><span class=p>.</span><span class=nx>id</span><span class=p>]</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>  <span class=na>attach_network_policy</span>  = <span class=kc>true</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>  <span class=na>attach_policies</span>        = <span class=kc>true</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>  <span class=na>policies</span>               = <span class=p>[</span><span class=nx>aws_iam_policy</span><span class=p>.</span><span class=nx>msk_lambda_producer_permission</span><span class=p>.</span><span class=nx>arn</span><span class=p>]</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>  <span class=na>number_of_policies</span>     = <span class=m>1</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>  <span class=na>environment_variables</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>    <span class=na>BOOTSTRAP_SERVERS</span> = <span class=nb>data</span><span class=p>.</span><span class=nx>aws_msk_cluster</span><span class=p>.</span><span class=nx>msk_data_cluster</span><span class=p>.</span><span class=nx>bootstrap_brokers_sasl_iam</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>    <span class=na>TOPIC_NAME</span>        = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>environment</span><span class=p>.</span><span class=nx>topic_name</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>    <span class=na>REGISTRY_NAME</span>     = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>environment</span><span class=p>.</span><span class=nx>registry_name</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>    <span class=na>MAX_RUN_SEC</span>       = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>environment</span><span class=p>.</span><span class=nx>max_run_sec</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>
</span></span><span class=line><span class=ln>52</span><span class=cl>  <span class=na>tags</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>tags</span>
</span></span><span class=line><span class=ln>53</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>54</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>55</span><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_lambda_function_event_invoke_config&#34;</span> <span class=s2>&#34;kafka_producer_lambda&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>  <span class=na>function_name</span>          = <span class=nb>module</span><span class=p>.</span><span class=nx>kafka_producer_lambda</span><span class=p>.</span><span class=nx>lambda_function_name</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>  <span class=na>maximum_retry_attempts</span> = <span class=m>0</span>
</span></span><span class=line><span class=ln>58</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>59</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>60</span><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_lambda_permission&#34;</span> <span class=s2>&#34;allow_eventbridge&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>  <span class=na>count</span>         = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>to_enable_trigger</span> <span class=o>?</span> <span class=m>1</span> <span class=o>:</span> <span class=m>0</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>  <span class=na>statement_id</span>  = <span class=s2>&#34;InvokeLambdaFunction&#34;</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>  <span class=na>action</span>        = <span class=s2>&#34;lambda:InvokeFunction&#34;</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>  <span class=na>function_name</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>function_name</span>
</span></span><span class=line><span class=ln>65</span><span class=cl>  <span class=na>principal</span>     = <span class=s2>&#34;events.amazonaws.com&#34;</span>
</span></span><span class=line><span class=ln>66</span><span class=cl>  <span class=na>source_arn</span>    = <span class=nb>module</span><span class=p>.</span><span class=nx>eventbridge</span><span class=p>.</span><span class=nx>eventbridge_rule_arns</span><span class=p>[</span><span class=s2>&#34;crons&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>67</span><span class=cl>
</span></span><span class=line><span class=ln>68</span><span class=cl>  <span class=na>depends_on</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln>69</span><span class=cl><span class=kr>    module</span><span class=p>.</span><span class=nx>eventbridge</span>
</span></span><span class=line><span class=ln>70</span><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=ln>71</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h5 id=iam-permission data-numberify>IAM Permission<a class="anchor ms-1" href=#iam-permission></a></h5><p>The producer Lambda function needs permission to send messages to the <em>orders</em> topic of the MSK cluster. Also, it needs permission on the Glue schema registry and schema. The following IAM policy is added to the Lambda function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/app/main.tf
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_iam_policy&#34;</span> <span class=s2>&#34;msk_lambda_producer_permission&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=na>name</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>function_name</span><span class=si>}</span><span class=s2>-msk-lambda-producer-permission&#34;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=na>policy</span> =<span class=nb> jsonencode</span><span class=p>({</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=na>Version</span> = <span class=s2>&#34;2012-10-17&#34;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=na>Statement</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=na>Sid</span> = <span class=s2>&#34;PermissionOnCluster&#34;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=na>Action</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>          <span class=s2>&#34;kafka-cluster:Connect&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>          <span class=s2>&#34;kafka-cluster:AlterCluster&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>          <span class=s2>&#34;kafka-cluster:DescribeCluster&#34;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>        <span class=na>Effect</span>   = <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=na>Resource</span> = <span class=s2>&#34;arn:aws:kafka:</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>region</span><span class=si>}</span><span class=s2>:</span><span class=si>${</span><span class=nb>data</span><span class=p>.</span><span class=nx>aws_caller_identity</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>account_id</span><span class=si>}</span><span class=s2>:cluster/</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>infra_prefix</span><span class=si>}</span><span class=s2>-msk-cluster/*&#34;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>        <span class=na>Sid</span> = <span class=s2>&#34;PermissionOnTopics&#34;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>        <span class=na>Action</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>          <span class=s2>&#34;kafka-cluster:*Topic*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>          <span class=s2>&#34;kafka-cluster:WriteData&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>          <span class=s2>&#34;kafka-cluster:ReadData&#34;</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>        <span class=na>Effect</span>   = <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>        <span class=na>Resource</span> = <span class=s2>&#34;arn:aws:kafka:</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>region</span><span class=si>}</span><span class=s2>:</span><span class=si>${</span><span class=nb>data</span><span class=p>.</span><span class=nx>aws_caller_identity</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>account_id</span><span class=si>}</span><span class=s2>:topic/</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>infra_prefix</span><span class=si>}</span><span class=s2>-msk-cluster/*&#34;</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>        <span class=na>Sid</span> = <span class=s2>&#34;PermissionOnGroups&#34;</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>        <span class=na>Action</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>          <span class=s2>&#34;kafka-cluster:AlterGroup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>          <span class=s2>&#34;kafka-cluster:DescribeGroup&#34;</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>        <span class=na>Effect</span>   = <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>        <span class=na>Resource</span> = <span class=s2>&#34;arn:aws:kafka:</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>region</span><span class=si>}</span><span class=s2>:</span><span class=si>${</span><span class=nb>data</span><span class=p>.</span><span class=nx>aws_caller_identity</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>account_id</span><span class=si>}</span><span class=s2>:group/</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>infra_prefix</span><span class=si>}</span><span class=s2>-msk-cluster/*&#34;</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>        <span class=na>Sid</span> = <span class=s2>&#34;PermissionOnGlueSchema&#34;</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>        <span class=na>Action</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>          <span class=s2>&#34;glue:*Schema*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>          <span class=s2>&#34;glue:GetRegistry&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>          <span class=s2>&#34;glue:CreateRegistry&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>          <span class=s2>&#34;glue:ListRegistries&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>        <span class=na>Effect</span>   = <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>        <span class=na>Resource</span> = <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=ln>50</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=eventbridge-rule data-numberify>EventBridge Rule<a class="anchor ms-1" href=#eventbridge-rule></a></h4><p>The <a href=https://registry.terraform.io/modules/terraform-aws-modules/eventbridge/aws/latest target=_blank rel="noopener noreferrer">AWS EventBridge Terraform module<i class="fas fa-external-link-square-alt ms-1"></i></a> is used to create the EventBridge schedule rule and targets. Note that 5 targets that point to the Kafka producer Lambda function are created so that it is invoked concurrently every minute.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=ln> 1</span><span class=cl><span class=kr>module</span> <span class=s2>&#34;eventbridge&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=na>source</span> = <span class=s2>&#34;terraform-aws-modules/eventbridge/aws&#34;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=na>create_bus</span> = <span class=kc>false</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=na>rules</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=na>crons</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>      <span class=na>description</span>         = <span class=s2>&#34;Kafka producer lambda schedule&#34;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>      <span class=na>schedule_expression</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>schedule_rate</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=na>targets</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=na>crons</span> = <span class=p>[</span><span class=k>for</span> <span class=nx>i</span> <span class=k>in</span><span class=nb> range</span><span class=p>(</span><span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>concurrency</span><span class=p>)</span> <span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>      <span class=na>name</span> = <span class=s2>&#34;lambda-target-</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>      <span class=na>arn</span>  = <span class=nb>module</span><span class=p>.</span><span class=nx>kafka_producer_lambda</span><span class=p>.</span><span class=nx>lambda_function_arn</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=p>}]</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>
</span></span><span class=line><span class=ln>20</span><span class=cl>  <span class=na>depends_on</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=kr>    module</span><span class=p>.</span><span class=nx>kafka_producer_lambda</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>
</span></span><span class=line><span class=ln>24</span><span class=cl>  <span class=na>tags</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>tags</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=consumer-app data-numberify>Consumer App<a class="anchor ms-1" href=#consumer-app></a></h3><h4 id=lambda-handler-1 data-numberify>Lambda Handler<a class="anchor ms-1" href=#lambda-handler-1></a></h4><p>The Lambda event includes records, which is a dictionary where the key is a topic partition (<em>topic_name-partiton_number</em>) and the value is a list of consumer records. The consumer records include both the message metadata (topic, partition, offset, timestamp&mldr;), key and value. An example payload is shown below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln> 1</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=nt>&#34;eventSource&#34;</span><span class=p>:</span> <span class=s2>&#34;aws:kafka&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=nt>&#34;eventSourceArn&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;msk-cluster-arn&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=nt>&#34;bootstrapServers&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;bootstrap-server-addresses&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=nt>&#34;records&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>        <span class=nt>&#34;orders-2&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>                <span class=nt>&#34;topic&#34;</span><span class=p>:</span> <span class=s2>&#34;orders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>                <span class=nt>&#34;partition&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>                <span class=nt>&#34;offset&#34;</span><span class=p>:</span> <span class=mi>10293</span><span class=p>,</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>                <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1680631941838</span><span class=p>,</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>                <span class=nt>&#34;timestampType&#34;</span><span class=p>:</span> <span class=s2>&#34;CREATE_TIME&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;eyJvcmRlcl9pZCI6ICJkNmQ4ZDJjNi1hODYwLTQyNTYtYWY1Yi04ZjU3NDkxZmM4YWYifQ==&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;AwDeD/rgjCxCeawN/ZaIO6VuSGQ2ZDhkMmM2LWE4NjAtNDI1Ni1hZjViLThmNTc0OTFmYzhhZu6pwtfpYQppYWJ4YQa8UBSEHgbkVAYA&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>                <span class=nt>&#34;headers&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <code>ConsumerRecord</code> class parses/formats a consumer record. As the key and value are returned as <em>base64</em> encoded string, it is decoded into bytes, followed by decoding or deserializing appropriately. The <code>LambdaDeserializer</code> class is created to deserialize the value. Also, the message timestamp is converted into the <em>datetime</em> object. The <em>parse_record()</em> method returns the consumer record with parsed/formatted values.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/app/consumer/lambda_handler.py</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=kn>from</span> <span class=nn>aws_schema_registry</span> <span class=kn>import</span> <span class=n>SchemaRegistryClient</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=kn>from</span> <span class=nn>aws_schema_registry.adapter.kafka</span> <span class=kn>import</span> <span class=n>Deserializer</span><span class=p>,</span> <span class=n>KafkaDeserializer</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=k>class</span> <span class=nc>LambdaDeserializer</span><span class=p>(</span><span class=n>Deserializer</span><span class=p>):</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>registry</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>registry</span> <span class=o>=</span> <span class=n>registry</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=nd>@property</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=k>def</span> <span class=nf>deserializer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>        <span class=n>glue_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>            <span class=s2>&#34;glue&#34;</span><span class=p>,</span> <span class=n>region_name</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;AWS_DEFAULT_REGION&#34;</span><span class=p>,</span> <span class=s2>&#34;ap-southeast-2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>        <span class=n>client</span> <span class=o>=</span> <span class=n>SchemaRegistryClient</span><span class=p>(</span><span class=n>glue_client</span><span class=p>,</span> <span class=n>registry_name</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>registry</span><span class=p>)</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>        <span class=k>return</span> <span class=n>KafkaDeserializer</span><span class=p>(</span><span class=n>client</span><span class=p>)</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=k>def</span> <span class=nf>deserialize</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>topic</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>bytes_</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>):</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>deserializer</span><span class=o>.</span><span class=n>deserialize</span><span class=p>(</span><span class=n>topic</span><span class=p>,</span> <span class=n>bytes_</span><span class=p>)</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>
</span></span><span class=line><span class=ln>27</span><span class=cl>
</span></span><span class=line><span class=ln>28</span><span class=cl><span class=k>class</span> <span class=nc>ConsumerRecord</span><span class=p>:</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>record</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>topic</span> <span class=o>=</span> <span class=n>record</span><span class=p>[</span><span class=s2>&#34;topic&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>partition</span> <span class=o>=</span> <span class=n>record</span><span class=p>[</span><span class=s2>&#34;partition&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>offset</span> <span class=o>=</span> <span class=n>record</span><span class=p>[</span><span class=s2>&#34;offset&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>=</span> <span class=n>record</span><span class=p>[</span><span class=s2>&#34;timestamp&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>timestamp_type</span> <span class=o>=</span> <span class=n>record</span><span class=p>[</span><span class=s2>&#34;timestampType&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key</span> <span class=o>=</span> <span class=n>record</span><span class=p>[</span><span class=s2>&#34;key&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>record</span><span class=p>[</span><span class=s2>&#34;value&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>headers</span> <span class=o>=</span> <span class=n>record</span><span class=p>[</span><span class=s2>&#34;headers&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>
</span></span><span class=line><span class=ln>39</span><span class=cl>    <span class=k>def</span> <span class=nf>parse_key</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>        <span class=k>return</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>
</span></span><span class=line><span class=ln>42</span><span class=cl>    <span class=k>def</span> <span class=nf>parse_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>deserializer</span><span class=p>:</span> <span class=n>LambdaDeserializer</span><span class=p>):</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>        <span class=n>parsed</span> <span class=o>=</span> <span class=n>deserializer</span><span class=o>.</span><span class=n>deserialize</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>value</span><span class=p>))</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>        <span class=k>return</span> <span class=n>parsed</span><span class=o>.</span><span class=n>data</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>
</span></span><span class=line><span class=ln>46</span><span class=cl>    <span class=k>def</span> <span class=nf>format_timestamp</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>to_str</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>):</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>        <span class=n>ts</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>/</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>        <span class=k>if</span> <span class=n>to_str</span><span class=p>:</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>            <span class=k>return</span> <span class=n>ts</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>        <span class=k>return</span> <span class=n>ts</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>
</span></span><span class=line><span class=ln>52</span><span class=cl>    <span class=k>def</span> <span class=nf>parse_record</span><span class=p>(</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>        <span class=bp>self</span><span class=p>,</span> <span class=n>deserializer</span><span class=p>:</span> <span class=n>LambdaDeserializer</span><span class=p>,</span> <span class=n>to_str</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=n>to_json</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>    <span class=p>):</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>        <span class=n>rec</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>            <span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>,</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>            <span class=o>**</span><span class=p>{</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>                <span class=s2>&#34;key&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>parse_key</span><span class=p>(),</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>                <span class=s2>&#34;value&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>parse_value</span><span class=p>(</span><span class=n>deserializer</span><span class=p>),</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>                <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>format_timestamp</span><span class=p>(</span><span class=n>to_str</span><span class=p>),</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>        <span class=k>if</span> <span class=n>to_json</span><span class=p>:</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>            <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>rec</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>serialize</span><span class=p>)</span>
</span></span><span class=line><span class=ln>65</span><span class=cl>        <span class=k>return</span> <span class=n>rec</span>
</span></span><span class=line><span class=ln>66</span><span class=cl>
</span></span><span class=line><span class=ln>67</span><span class=cl>    <span class=k>def</span> <span class=nf>serialize</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>):</span>
</span></span><span class=line><span class=ln>68</span><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>):</span>
</span></span><span class=line><span class=ln>69</span><span class=cl>            <span class=k>return</span> <span class=n>obj</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=ln>70</span><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>date</span><span class=p>):</span>
</span></span><span class=line><span class=ln>71</span><span class=cl>            <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
</span></span><span class=line><span class=ln>72</span><span class=cl>        <span class=k>return</span> <span class=n>obj</span>
</span></span><span class=line><span class=ln>73</span><span class=cl>
</span></span><span class=line><span class=ln>74</span><span class=cl>
</span></span><span class=line><span class=ln>75</span><span class=cl><span class=k>def</span> <span class=nf>lambda_function</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=ln>76</span><span class=cl>    <span class=n>deserializer</span> <span class=o>=</span> <span class=n>LambdaDeserializer</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;REGISTRY_NAME&#34;</span><span class=p>,</span> <span class=s2>&#34;customer&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=ln>77</span><span class=cl>    <span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>records</span> <span class=ow>in</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;records&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=ln>78</span><span class=cl>        <span class=k>for</span> <span class=n>record</span> <span class=ow>in</span> <span class=n>records</span><span class=p>:</span>
</span></span><span class=line><span class=ln>79</span><span class=cl>            <span class=n>cr</span> <span class=o>=</span> <span class=n>ConsumerRecord</span><span class=p>(</span><span class=n>record</span><span class=p>)</span>
</span></span><span class=line><span class=ln>80</span><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>cr</span><span class=o>.</span><span class=n>parse_record</span><span class=p>(</span><span class=n>deserializer</span><span class=p>))</span>
</span></span></code></pre></div><h4 id=lambda-resource-1 data-numberify>Lambda Resource<a class="anchor ms-1" href=#lambda-resource-1></a></h4><p>The <a href=https://registry.terraform.io/modules/terraform-aws-modules/lambda/aws/4.7.2 target=_blank rel="noopener noreferrer">AWS Lambda Terraform module<i class="fas fa-external-link-square-alt ms-1"></i></a> is used to create the consumer Lambda function as well. Lambda event source mapping is created so that it polls messages from the <em>orders</em> topic and invoke the consumer function. Also, we need to give permission to the MSK cluster to invoke the Lambda function, and it is given by the <code>aws_lambda_permission</code> resource.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/app/variables.tf
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=nx>locals</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=na>name</span>        = <span class=nx>local</span><span class=p>.</span><span class=nx>infra_prefix</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=na>region</span>      = <span class=nb>data</span><span class=p>.</span><span class=nx>aws_region</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>name</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=na>environment</span> = <span class=s2>&#34;dev&#34;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=na>infra_prefix</span> = <span class=s2>&#34;glue-schema-registry&#34;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=na>consumer</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=na>src_path</span>          = <span class=s2>&#34;consumer&#34;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=na>function_name</span>     = <span class=s2>&#34;kafka_consumer&#34;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=na>handler</span>           = <span class=s2>&#34;lambda_handler.lambda_function&#34;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=na>timeout</span>           = <span class=m>90</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=na>memory_size</span>       = <span class=m>128</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=na>runtime</span>           = <span class=s2>&#34;python3.8&#34;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=na>topic_name</span>        = <span class=s2>&#34;orders&#34;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=na>starting_position</span> = <span class=s2>&#34;TRIM_HORIZON&#34;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=na>environment</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>      <span class=na>registry_name</span> = <span class=s2>&#34;customer&#34;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=p>}</span><span class=c1>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=c1># glue-schema-registry/app/main.tf
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=c1></span><span class=kr>module</span> <span class=s2>&#34;kafka_consumer_lambda&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>  <span class=na>source</span> = <span class=s2>&#34;terraform-aws-modules/lambda/aws&#34;</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>
</span></span><span class=line><span class=ln>30</span><span class=cl>  <span class=na>function_name</span>          = <span class=nx>local</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>function_name</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>  <span class=na>handler</span>                = <span class=nx>local</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>handler</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>  <span class=na>runtime</span>                = <span class=nx>local</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>runtime</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>  <span class=na>timeout</span>                = <span class=nx>local</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>timeout</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>  <span class=na>memory_size</span>            = <span class=nx>local</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>memory_size</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>  <span class=na>source_path</span>            = <span class=nx>local</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>src_path</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>  <span class=na>vpc_subnet_ids</span>         = <span class=nb>data</span><span class=p>.</span><span class=nx>aws_subnets</span><span class=p>.</span><span class=nx>private</span><span class=p>.</span><span class=nx>ids</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>  <span class=na>vpc_security_group_ids</span> = <span class=p>[</span><span class=nb>data</span><span class=p>.</span><span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>kafka_app_lambda</span><span class=p>.</span><span class=nx>id</span><span class=p>]</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>  <span class=na>attach_network_policy</span>  = <span class=kc>true</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>  <span class=na>attach_policies</span>        = <span class=kc>true</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>  <span class=na>policies</span>               = <span class=p>[</span><span class=nx>aws_iam_policy</span><span class=p>.</span><span class=nx>msk_lambda_consumer_permission</span><span class=p>.</span><span class=nx>arn</span><span class=p>]</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>  <span class=na>number_of_policies</span>     = <span class=m>1</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>  <span class=na>environment_variables</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>    <span class=na>REGISTRY_NAME</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>producer</span><span class=p>.</span><span class=nx>environment</span><span class=p>.</span><span class=nx>registry_name</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>
</span></span><span class=line><span class=ln>46</span><span class=cl>  <span class=na>tags</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>tags</span>
</span></span><span class=line><span class=ln>47</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>48</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>49</span><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_lambda_event_source_mapping&#34;</span> <span class=s2>&#34;kafka_consumer_lambda&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>  <span class=na>event_source_arn</span>  = <span class=nb>data</span><span class=p>.</span><span class=nx>aws_msk_cluster</span><span class=p>.</span><span class=nx>msk_data_cluster</span><span class=p>.</span><span class=nx>arn</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>  <span class=na>function_name</span>     = <span class=nb>module</span><span class=p>.</span><span class=nx>kafka_consumer_lambda</span><span class=p>.</span><span class=nx>lambda_function_name</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>  <span class=na>topics</span>            = <span class=p>[</span><span class=nx>local</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>topic_name</span><span class=p>]</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>  <span class=na>starting_position</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>starting_position</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>  <span class=nx>amazon_managed_kafka_event_source_config</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>    <span class=na>consumer_group_id</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>topic_name</span><span class=si>}</span><span class=s2>-group-01&#34;</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>57</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>58</span><span class=cl><span class=kr>
</span></span></span><span class=line><span class=ln>59</span><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_lambda_permission&#34;</span> <span class=s2>&#34;allow_msk&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>  <span class=na>statement_id</span>  = <span class=s2>&#34;InvokeLambdaFunction&#34;</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>  <span class=na>action</span>        = <span class=s2>&#34;lambda:InvokeFunction&#34;</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>  <span class=na>function_name</span> = <span class=nx>local</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>function_name</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>  <span class=na>principal</span>     = <span class=s2>&#34;kafka.amazonaws.com&#34;</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>  <span class=na>source_arn</span>    = <span class=nb>data</span><span class=p>.</span><span class=nx>aws_msk_cluster</span><span class=p>.</span><span class=nx>msk_data_cluster</span><span class=p>.</span><span class=nx>arn</span>
</span></span><span class=line><span class=ln>65</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h5 id=iam-permission-1 data-numberify>IAM Permission<a class="anchor ms-1" href=#iam-permission-1></a></h5><p>As the Lambda event source mapping uses the permission of the Lambda function, we need to add permission related to Kafka cluster, Kafka and networking - see the <a href=https://docs.aws.amazon.com/lambda/latest/dg/with-msk.html target=_blank rel="noopener noreferrer">AWS documentation<i class="fas fa-external-link-square-alt ms-1"></i></a> for details. Finally, permission on the Glue schema registry and schema is added as the consumer should be able to request relevant schemas.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/app/main.tf
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_iam_policy&#34;</span> <span class=s2>&#34;msk_lambda_consumer_permission&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=na>name</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>consumer</span><span class=p>.</span><span class=nx>function_name</span><span class=si>}</span><span class=s2>-msk-lambda-consumer-permission&#34;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=na>policy</span> =<span class=nb> jsonencode</span><span class=p>({</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=na>Version</span> = <span class=s2>&#34;2012-10-17&#34;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=na>Statement</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=na>Sid</span> = <span class=s2>&#34;PermissionOnKafkaCluster&#34;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=na>Action</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>          <span class=s2>&#34;kafka-cluster:Connect&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>          <span class=s2>&#34;kafka-cluster:DescribeGroup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>          <span class=s2>&#34;kafka-cluster:AlterGroup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>          <span class=s2>&#34;kafka-cluster:DescribeTopic&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>          <span class=s2>&#34;kafka-cluster:ReadData&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>          <span class=s2>&#34;kafka-cluster:DescribeClusterDynamicConfiguration&#34;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>        <span class=na>Effect</span> = <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>        <span class=na>Resource</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>          <span class=s2>&#34;arn:aws:kafka:</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>region</span><span class=si>}</span><span class=s2>:</span><span class=si>${</span><span class=nb>data</span><span class=p>.</span><span class=nx>aws_caller_identity</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>account_id</span><span class=si>}</span><span class=s2>:cluster/</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>infra_prefix</span><span class=si>}</span><span class=s2>-msk-cluster/*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>          <span class=s2>&#34;arn:aws:kafka:</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>region</span><span class=si>}</span><span class=s2>:</span><span class=si>${</span><span class=nb>data</span><span class=p>.</span><span class=nx>aws_caller_identity</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>account_id</span><span class=si>}</span><span class=s2>:topic/</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>infra_prefix</span><span class=si>}</span><span class=s2>-msk-cluster/*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>          <span class=s2>&#34;arn:aws:kafka:</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>region</span><span class=si>}</span><span class=s2>:</span><span class=si>${</span><span class=nb>data</span><span class=p>.</span><span class=nx>aws_caller_identity</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>account_id</span><span class=si>}</span><span class=s2>:group/</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>infra_prefix</span><span class=si>}</span><span class=s2>-msk-cluster/*&#34;</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>        <span class=na>Sid</span> = <span class=s2>&#34;PermissionOnKafka&#34;</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>        <span class=na>Action</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>          <span class=s2>&#34;kafka:DescribeCluster&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>          <span class=s2>&#34;kafka:GetBootstrapBrokers&#34;</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>        <span class=na>Effect</span>   = <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>        <span class=na>Resource</span> = <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>        <span class=na>Sid</span> = <span class=s2>&#34;PermissionOnNetwork&#34;</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>        <span class=na>Action</span> = <span class=p>[</span><span class=c1>
</span></span></span><span class=line><span class=ln>37</span><span class=cl><span class=c1>          # The first three actions also exist in netwrok policy attachment in lambda module
</span></span></span><span class=line><span class=ln>38</span><span class=cl><span class=c1>          # &#34;ec2:CreateNetworkInterface&#34;,
</span></span></span><span class=line><span class=ln>39</span><span class=cl><span class=c1>          # &#34;ec2:DescribeNetworkInterfaces&#34;,
</span></span></span><span class=line><span class=ln>40</span><span class=cl><span class=c1>          # &#34;ec2:DeleteNetworkInterface&#34;,
</span></span></span><span class=line><span class=ln>41</span><span class=cl><span class=c1></span>          <span class=s2>&#34;ec2:DescribeVpcs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>          <span class=s2>&#34;ec2:DescribeSubnets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>          <span class=s2>&#34;ec2:DescribeSecurityGroups&#34;</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>        <span class=na>Effect</span>   = <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>        <span class=na>Resource</span> = <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>        <span class=na>Sid</span> = <span class=s2>&#34;PermissionOnGlueSchema&#34;</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>        <span class=na>Action</span> = <span class=p>[</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>          <span class=s2>&#34;glue:*Schema*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>          <span class=s2>&#34;glue:ListRegistries&#34;</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>        <span class=na>Effect</span>   = <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>        <span class=na>Resource</span> = <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=ln>59</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=schema-evolution-demo data-numberify>Schema Evolution Demo<a class="anchor ms-1" href=#schema-evolution-demo></a></h2><p>Before testing the Kafka applications, I&rsquo;ll quickly demonstrate how the schema registry can be used for managing and validating schemas for topic message data. Each schema can have a <a href=https://docs.aws.amazon.com/glue/latest/dg/schema-registry.html#schema-registry-compatibility target=_blank rel="noopener noreferrer">compatibility mode<i class="fas fa-external-link-square-alt ms-1"></i></a> (or disabled) and the scope of changes is restricted by it. For example, the default <em>BACKWARD</em> mode only allows to delete fields or add optional fields. (See the <a href=https://docs.confluent.io/platform/current/schema-registry/fundamentals/avro.html#backward-compatibility target=_blank rel="noopener noreferrer">Confluent document<i class="fas fa-external-link-square-alt ms-1"></i></a> for a quick summary.) Therefore, if we add a mandatory field to an existing schema, it will be not validated, and it fails to send a message to the topic. In order to illustrate it, I created a single node Kafka cluster using docker-compose as shown below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=c># glue-schema-registry/compose-demo.yml</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3.5&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>zookeeper</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/bitnami/zookeeper:3.8</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>      </span>- <span class=s2>&#34;2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>      </span>- <span class=l>kafkanet</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>      </span>- <span class=l>ALLOW_ANONYMOUS_LOGIN=yes</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>      </span>- <span class=l>zookeeper_data:/bitnami/zookeeper</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>  </span><span class=nt>kafka-0</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/bitnami/kafka:3.3</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>kafka-0</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>    </span><span class=nt>expose</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w>      </span>- <span class=m>9092</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w>      </span>- <span class=s2>&#34;9093:9093&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=w>      </span>- <span class=l>kafkanet</span><span class=w>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=w>      </span>- <span class=l>ALLOW_PLAINTEXT_LISTENER=yes</span><span class=w>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=w>      </span>- <span class=l>KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181</span><span class=w>
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=w>      </span>- <span class=l>KAFKA_CFG_BROKER_ID=0</span><span class=w>
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=w>      </span>- <span class=l>KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CLIENT:PLAINTEXT,EXTERNAL:PLAINTEXT</span><span class=w>
</span></span></span><span class=line><span class=ln>30</span><span class=cl><span class=w>      </span>- <span class=l>KAFKA_CFG_LISTENERS=CLIENT://:9092,EXTERNAL://:9093</span><span class=w>
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=w>      </span>- <span class=l>KAFKA_CFG_ADVERTISED_LISTENERS=CLIENT://kafka-0:9092,EXTERNAL://localhost:9093</span><span class=w>
</span></span></span><span class=line><span class=ln>32</span><span class=cl><span class=w>      </span>- <span class=l>KAFKA_CFG_INTER_BROKER_LISTENER_NAME=CLIENT</span><span class=w>
</span></span></span><span class=line><span class=ln>33</span><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=w>      </span>- <span class=l>kafka_0_data:/bitnami/kafka</span><span class=w>
</span></span></span><span class=line><span class=ln>35</span><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>36</span><span class=cl><span class=w>      </span>- <span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=ln>37</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln>38</span><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>39</span><span class=cl><span class=w>  </span><span class=nt>kafkanet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>40</span><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka-network</span><span class=w>
</span></span></span><span class=line><span class=ln>41</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln>42</span><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>43</span><span class=cl><span class=w>  </span><span class=nt>zookeeper_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>44</span><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>local</span><span class=w>
</span></span></span><span class=line><span class=ln>45</span><span class=cl><span class=w>  </span><span class=nt>kafka_0_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>46</span><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>local</span><span class=w>
</span></span></span></code></pre></div><p>Recall that the producer lambda handler has a conditional block, and it is executed when it is called as a script. If we don&rsquo;t specify the environment variable of <em>USE_MORE</em>, it sends a messages based on the <code>Order</code> class. Otherwise, a message is created from the <code>OrderMore</code> class, which has an additional boolean attribute called <em>is_prime</em>. As the compatibility mode is set to be <em>BACKWARD</em>, we can expect the second round of execution will not be successful. As shown below, I executed the lambda handler twice and the second round failed with the following error, which indicates schema validation failure.</p><p><code>aws_schema_registry.exception.SchemaRegistryException: Schema Found but status is FAILURE</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl><span class=nb>export</span> <span class=nv>BOOTSTRAP_SERVERS</span><span class=o>=</span>localhost:9093
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nb>export</span> <span class=nv>TOPIC_NAME</span><span class=o>=</span>demo
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nb>export</span> <span class=nv>REGISTRY_NAME</span><span class=o>=</span>customer
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nb>cd</span> glue-schema-registry/app/producer
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1>## Round 1 - send message from the Order class</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>python lambda_handler.py
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1>## Round 2 - send message from the OrderMore class</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=nb>export</span> <span class=nv>USE_MORE</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>python lambda_handler.py
</span></span></code></pre></div><p>We can see the details from the schema version and the second version is marked as failed.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2023-04-12-integrate-glue-schema-registry/schema-failure.png loading=lazy width=980 height=696></picture></p><p>Note that schema versioning and validation would be more relevant to the clients that tightly link the schema and message records. However, it would still be important for a Python client in order to work together with those clients or Kafka connect.</p><h2 id=deployment data-numberify>Deployment<a class="anchor ms-1" href=#deployment></a></h2><h3 id=topic-creation data-numberify>Topic Creation<a class="anchor ms-1" href=#topic-creation></a></h3><p>We plan to create the <em>orders</em> topic with multiple partitions. Although we can use the Kafka CLI tool, it can be performed easily using <a href=https://docs.kpow.io/ce/ target=_blank rel="noopener noreferrer">Kpow<i class="fas fa-external-link-square-alt ms-1"></i></a>. It is a Kafka monitoring and management tool, which provides a web UI. Also, it supports the Glue Schema Registry and MSK Connect out-of-box, which is quite convenient. In the docker-compose file, we added environment variables for the MSK cluster, MSK Connect and Glue Schema Registry details. Note it fails to start if the schema registry does not exist. I created the registry while I demonstrated schema evolution, or it can be created simply as shown below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>$ aws glue create-registry --registry-name customer
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=c># glue-schema-registry/docker-compose.yml</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3.5&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>kpow</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>factorhouse/kpow-ce:91.2.1</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>kpow</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>      </span>- <span class=s2>&#34;3000:3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>      </span>- <span class=l>kafkanet</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>      </span><span class=nt>AWS_ACCESS_KEY_ID</span><span class=p>:</span><span class=w> </span><span class=l>$AWS_ACCESS_KEY_ID</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>      </span><span class=nt>AWS_SECRET_ACCESS_KEY</span><span class=p>:</span><span class=w> </span><span class=l>$AWS_SECRET_ACCESS_KEY</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>      </span><span class=nt>AWS_SESSION_TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>$AWS_SESSION_TOKEN</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>      </span><span class=c># kafka cluster</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>      </span><span class=nt>BOOTSTRAP</span><span class=p>:</span><span class=w> </span><span class=l>$BOOTSTRAP_SERVERS</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>      </span><span class=nt>SECURITY_PROTOCOL</span><span class=p>:</span><span class=w> </span><span class=l>SASL_SSL</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>      </span><span class=nt>SASL_MECHANISM</span><span class=p>:</span><span class=w> </span><span class=l>AWS_MSK_IAM</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w>      </span><span class=nt>SASL_CLIENT_CALLBACK_HANDLER_CLASS</span><span class=p>:</span><span class=w> </span><span class=l>software.amazon.msk.auth.iam.IAMClientCallbackHandler</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>      </span><span class=nt>SASL_JAAS_CONFIG</span><span class=p>:</span><span class=w> </span><span class=l>software.amazon.msk.auth.iam.IAMLoginModule required;</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w>      </span><span class=c># msk connect</span><span class=w>
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=w>      </span><span class=nt>CONNECT_AWS_REGION</span><span class=p>:</span><span class=w> </span><span class=l>$AWS_DEFAULT_REGION</span><span class=w>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=w>      </span><span class=c># glue schema registry</span><span class=w>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=w>      </span><span class=nt>SCHEMA_REGISTRY_ARN</span><span class=p>:</span><span class=w> </span><span class=l>$SCHEMA_REGISTRY_ARN</span><span class=w>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=w>      </span><span class=nt>SCHEMA_REGISTRY_REGION</span><span class=p>:</span><span class=w> </span><span class=l>$AWS_DEFAULT_REGION</span><span class=w>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=w>  </span><span class=nt>kafkanet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>30</span><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kafka-network</span><span class=w>
</span></span></span></code></pre></div><p>Once started, we can visit the UI on port 3000. The topic is created in the <em>Topic</em> menu by specifying the topic name and the number of partitions.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2023-04-12-integrate-glue-schema-registry/kpow-create-topic-01.png loading=lazy width=1321 height=730></picture></p><p>Once created, we can check details of the topic by selecting the topic from the drop-down menu.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2023-04-12-integrate-glue-schema-registry/kpow-create-topic-02.png loading=lazy width=1318 height=741></picture></p><h3 id=local-testing-with-sam data-numberify>Local Testing with SAM<a class="anchor ms-1" href=#local-testing-with-sam></a></h3><p>To simplify development, the EventBridge permission is disabled by setting <em>to_enable_trigger</em> to false. Also, it is shortened to loop before it gets stopped by reducing <em>max_run_sec</em> to 10.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=ln> 1</span><span class=cl><span class=c1># glue-schema-registry/app/variables.tf
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=nx>locals</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=na>producer</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=na>to_enable_trigger</span> = <span class=kc>false</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=na>environment</span> = <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>      <span class=na>topic_name</span>    = <span class=s2>&#34;orders&#34;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>      <span class=na>registry_name</span> = <span class=s2>&#34;customer&#34;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>      <span class=na>max_run_sec</span>   = <span class=m>10</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The Lambda function can be built with the SAM build command while specifying the hook name as terraform and enabling beta features. Once completed, it stores the build artifacts and template in the <code>.aws-sam</code> folder.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl>$ sam build --hook-name terraform --beta-features
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1># Apply complete! Resources: 3 added, 0 changed, 0 destroyed.</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1># Build Succeeded</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1># Built Artifacts  : .aws-sam/build</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1># Built Template   : .aws-sam/build/template.yaml</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1># Commands you can use next</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1># =========================</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1># [*] Invoke Function: sam local invoke --hook-name terraform</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1># [*] Emulate local Lambda functions: sam local start-lambda --hook-name terraform</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1># SAM CLI update available (1.78.0); (1.70.0 installed)</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1># To download: https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html</span>
</span></span></code></pre></div><p>We can invoke the Lambda function locally using the SAM local invoke command. The Lambda function is invoked in a Docker container and the invocation logs are printed in the terminal as shown below. Note that we should be connected to the VPN server in order to send messages into the MSK cluster, which is deployed in private subnets.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl>$ sam <span class=nb>local</span> invoke --hook-name terraform module.kafka_producer_lambda.aws_lambda_function.this<span class=o>[</span>0<span class=o>]</span> --beta-features
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1># Experimental features are enabled for this session.</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1># Visit the docs page to learn more about the AWS Beta terms https://aws.amazon.com/service-terms/.</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1># Skipped prepare hook. Current application is already prepared.</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1># Invoking lambda_handler.lambda_function (python3.8)</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1># Skip pulling image and use local one: public.ecr.aws/sam/emulation-python3.8:rapid-1.70.0-x86_64.</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1># Mounting /home/jaehyeon/personal/kafka-pocs/glue-schema-registry/app/.aws-sam/build/ModuleKafkaProducerLambdaAwsLambdaFunctionThis069E06354 as /var/task:ro,delegated inside runtime container</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1># START RequestId: fdbba255-e5b0-4e21-90d3-fe0b2ebbf629 Version: $LATEST</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1># sent 100 messages</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1># sent 100 messages</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1># sent 100 messages</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1># sent 100 messages</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1># sent 100 messages</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1># sent 100 messages</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1># sent 100 messages</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=c1># sent 100 messages</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1># sent 100 messages</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=c1># sent 100 messages</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=c1># 1000 records are sent in 11 seconds ...</span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1># END RequestId: fdbba255-e5b0-4e21-90d3-fe0b2ebbf629</span>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1># REPORT RequestId: fdbba255-e5b0-4e21-90d3-fe0b2ebbf629  Init Duration: 0.22 ms  Duration: 12146.61 ms   Billed Duration: 12147 ms       Memory Size: 128 MB     Max Memory Used: 128 MB</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1># null</span>
</span></span></code></pre></div><p>Once completed, we can check the value schema (<em>orders-value</em>) is created in the Kpow UI as shown below.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2023-04-12-integrate-glue-schema-registry/kpow-schema.png loading=lazy width=1317 height=512></picture></p><p>We can check the messages. In order to check them correctly, we need to select AVRO as the value deserializer and <em>glue1</em> as the schema registry.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2023-04-12-integrate-glue-schema-registry/kpow-data-01.png loading=lazy width=1112 height=857></picture></p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2023-04-12-integrate-glue-schema-registry/kpow-data-02.png loading=lazy width=1110 height=825></picture></p><h3 id=kafka-app-deployment data-numberify>Kafka App Deployment<a class="anchor ms-1" href=#kafka-app-deployment></a></h3><p>Now we can deploy the Kafka applications using Terraform as usual after resetting the configuration variables. Once deployed, we can see that the scheduler rule has 5 targets of the same Lambda function.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2023-04-12-integrate-glue-schema-registry/eventbridge.png loading=lazy width=1280 height=807></picture></p><p>We can see the Lambda consumer parses the consumer records correctly in CloudWatch logs.</p><p><picture><img class="img-fluid mx-auto d-block" alt src=/blog/2023-04-12-integrate-glue-schema-registry/consumer.png loading=lazy width=1053 height=505></picture></p><h2 id=summary data-numberify>Summary<a class="anchor ms-1" href=#summary></a></h2><p>Schema registry provides a centralized repository for managing and validating schemas for topic message data. In AWS, the Glue Schema Registry supports features to manage and enforce schemas on data streaming applications using convenient integrations with a range of AWS services. In this post, we discussed how to integrate Python Kafka producer and consumer apps in AWS Lambda with the Glue Schema Registry.</p></div></div></div><div class=card-footer><div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev"><i class="fas fa-fw fa-chevron-down post-prev-icon me-1" data-fa-transform=rotate-90></i>
<a href=/blog/2023-03-14-simplify-streaming-ingestion-athena/>Simplify Streaming Ingestion on AWS – Part 2 MSK and Athena</a></div><div class="post-nav post-next"><a href=/blog/2023-04-24-self-hosted-blog/>Self-Managed Blog With Hugo and GitHub Pages</a>
<i class="fas fa-fw fa-chevron-down post-next-icon ms-1" data-fa-transform=rotate-270></i></div></div></div></article><section class="related-posts row card component"><div class=card-header><h2 class="card-title fs-4 my-2 text-surface">Related Posts</h2></div><div class="card-body slide px-1"><div class="slide-inner row gx-0"><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2023-03-14-simplify-streaming-ingestion-athena/featured_huef6334952f8505bdd5ee5a48de258194_43403_500x0_resize_box_3.png media="(max-width: 576px)" height=258 width=500><img class=img-fluid height=93 width=180 alt=featured.png src=/blog/2023-03-14-simplify-streaming-ingestion-athena/featured_huef6334952f8505bdd5ee5a48de258194_43403_180x0_resize_box_3.png data-src=/blog/2023-03-14-simplify-streaming-ingestion-athena/featured.png loading=lazy>
</picture><a class=post-title href=/blog/2023-03-14-simplify-streaming-ingestion-athena/>Simplify Streaming Ingestion on AWS – Part 2 MSK and Athena</a><div class="post-meta mb-0">March 14, 2023</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2023-02-08-simplify-streaming-ingestion-redshift/featured_hu77abd5c8ed84cebc51bde5ecaefc7320_32864_500x0_resize_box_3.png media="(max-width: 576px)" height=239 width=500><img class=img-fluid height=86 width=180 alt=featured.png src=/blog/2023-02-08-simplify-streaming-ingestion-redshift/featured_hu77abd5c8ed84cebc51bde5ecaefc7320_32864_180x0_resize_box_3.png data-src=/blog/2023-02-08-simplify-streaming-ingestion-redshift/featured.png loading=lazy>
</picture><a class=post-title href=/blog/2023-02-08-simplify-streaming-ingestion-redshift/>Simplify Streaming Ingestion on AWS – Part 1 MSK and Redshift</a><div class="post-meta mb-0">February 8, 2023</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2022-04-03-schema-registry-part2/featured_hu55ef0aeef397b55768e961367d004bbc_59689_500x0_resize_box_3.png media="(max-width: 576px)" height=252 width=500><img class=img-fluid height=91 width=180 alt=featured.png src=/blog/2022-04-03-schema-registry-part2/featured_hu55ef0aeef397b55768e961367d004bbc_59689_180x0_resize_box_3.png data-src=/blog/2022-04-03-schema-registry-part2/featured.png loading=lazy>
</picture><a class=post-title href=/blog/2022-04-03-schema-registry-part2/>Use External Schema Registry With MSK Connect – Part 2 MSK Deployment</a><div class="post-meta mb-0">April 3, 2022</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2022-08-06-revisit-lambda-operator/featured_hudaeb25d8660dc3c0c83176a3034f7899_24814_500x0_resize_box_3.png media="(max-width: 576px)" height=290 width=500><img class=img-fluid height=105 width=180 alt=featured.png src=/blog/2022-08-06-revisit-lambda-operator/featured_hudaeb25d8660dc3c0c83176a3034f7899_24814_180x0_resize_box_3.png data-src=/blog/2022-08-06-revisit-lambda-operator/featured.png loading=lazy>
</picture><a class=post-title href=/blog/2022-08-06-revisit-lambda-operator/>Revisit AWS Lambda Invoke Function Operator of Apache Airflow</a><div class="post-meta mb-0">August 6, 2022</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2022-03-07-schema-registry-part1/featured_hu55ef0aeef397b55768e961367d004bbc_59689_500x0_resize_box_3.png media="(max-width: 576px)" height=252 width=500><img class=img-fluid height=91 width=180 alt=featured.png src=/blog/2022-03-07-schema-registry-part1/featured_hu55ef0aeef397b55768e961367d004bbc_59689_180x0_resize_box_3.png data-src=/blog/2022-03-07-schema-registry-part1/featured.png loading=lazy>
</picture><a class=post-title href=/blog/2022-03-07-schema-registry-part1/>Use External Schema Registry With MSK Connect – Part 1 Local Development</a><div class="post-meta mb-0">March 7, 2022</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2021-12-19-datalake-demo-part3/featured_hua25eccd3824300d3b1ed87f56797248c_164526_500x0_resize_box_3.png media="(max-width: 576px)" height=229 width=500><img class=img-fluid height=83 width=180 alt=featured.png src=/blog/2021-12-19-datalake-demo-part3/featured_hua25eccd3824300d3b1ed87f56797248c_164526_180x0_resize_box_3.png data-src=/blog/2021-12-19-datalake-demo-part3/featured.png loading=lazy>
</picture><a class=post-title href=/blog/2021-12-19-datalake-demo-part3/>Data Lake Demo Using Change Data Capture (CDC) on AWS – Part 3 Implement Data Lake</a><div class="post-meta mb-0">December 19, 2021</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2021-12-12-datalake-demo-part2/featured_hua25eccd3824300d3b1ed87f56797248c_164526_500x0_resize_box_3.png media="(max-width: 576px)" height=229 width=500><img class=img-fluid height=83 width=180 alt=featured.png src=/blog/2021-12-12-datalake-demo-part2/featured_hua25eccd3824300d3b1ed87f56797248c_164526_180x0_resize_box_3.png data-src=/blog/2021-12-12-datalake-demo-part2/featured.png loading=lazy>
</picture><a class=post-title href=/blog/2021-12-12-datalake-demo-part2/>Data Lake Demo Using Change Data Capture (CDC) on AWS – Part 2 Implement CDC</a><div class="post-meta mb-0">December 12, 2021</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2021-12-05-datalake-demo-part1/featured_hua25eccd3824300d3b1ed87f56797248c_164526_500x0_resize_box_3.png media="(max-width: 576px)" height=229 width=500><img class=img-fluid height=83 width=180 alt=featured.png src=/blog/2021-12-05-datalake-demo-part1/featured_hua25eccd3824300d3b1ed87f56797248c_164526_180x0_resize_box_3.png data-src=/blog/2021-12-05-datalake-demo-part1/featured.png loading=lazy>
</picture><a class=post-title href=/blog/2021-12-05-datalake-demo-part1/>Data Lake Demo Using Change Data Capture (CDC) on AWS – Part 1 Local Development</a><div class="post-meta mb-0">December 5, 2021</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2020-04-13-airflow-lambda-operator/featured_hu1fb366ed8468cd95c289e8b53adf2b4c_44994_500x0_resize_box_3.png media="(max-width: 576px)" height=144 width=500><img class=img-fluid height=52 width=180 alt=featured.png src=/blog/2020-04-13-airflow-lambda-operator/featured_hu1fb366ed8468cd95c289e8b53adf2b4c_44994_180x0_resize_box_3.png data-src=/blog/2020-04-13-airflow-lambda-operator/featured.png loading=lazy>
</picture><a class=post-title href=/blog/2020-04-13-airflow-lambda-operator/>Thoughts on Apache Airflow AWS Lambda Operator</a><div class="post-meta mb-0">April 13, 2020</div></div></div><div class="col-12 col-md-6 col-lg-4 me-2"><div class="post-card card card-body p-0 border-0 surface"><picture><source srcset=/blog/2019-07-20-aws-localstack/featured_hu76363859e2b475a85e538ad8f869426e_164886_500x0_resize_box_3.png media="(max-width: 576px)" height=300 width=500><img class=img-fluid height=108 width=180 alt=featured.png src=/blog/2019-07-20-aws-localstack/featured_hu76363859e2b475a85e538ad8f869426e_164886_180x0_resize_box_3.png data-src=/blog/2019-07-20-aws-localstack/featured.png loading=lazy>
</picture><a class=post-title href=/blog/2019-07-20-aws-localstack/>AWS Local Development With LocalStack</a><div class="post-meta mb-0">July 20, 2019</div></div></div></div><button class=slide-control-left>
<i class="fas fa-2x fa-chevron-circle-down" data-fa-transform=rotate-90></i>
<span class=visually-hidden>Left</span>
</button>
<button class=slide-control-right>
<i class="fas fa-2x fa-chevron-circle-down" data-fa-transform=rotate-270></i>
<span class=visually-hidden>Right</span></button></div></section><div class="card component row post-comments" id=post-comments><div class=card-header><h2 class="card-title my-2 fs-4 text-surface">Comments</h2></div><div class=card-body><div class=giscus></div></div></div></div></div><aside class="col-xxl-4 sidebar d-flex"><div class="container d-flex flex-column"><div class="accordion profile"><div class="accordion-item card row text-center component"><div class="accordion-header card-header border-0" id=profile-header><a class="accordion-button d-lg-none mb-2 shadow-none p-0 bg-transparent text-surface" role=button data-bs-toggle=collapse href=#profile aria-expanded=true aria-controls=profile>Profile</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id=profile aria-labelledby=profile-header><div class="col-12 d-flex align-items-center justify-content-center"><picture><img class="profile-avatar rounded-circle" alt="Jaehyeon Kim" src="https://jaehyeon.me/images/profile.png?v=5ee9c3e6035422e33c63a669417c692e" loading=lazy data-viewer-invisible width=200 height=200></picture></div><div class="col-12 profile-meta"><div class="profile-name fw-fold fs-lg">Jaehyeon Kim</div><div class=profile-bio>Data Engineer 💡 Blogger ⚡ Data Streaming Enthusiast ☁ AWS Community Builder</div></div><nav class="social-links nav justify-content-center mt-1 justify-content-around"><a class="nav-link social-link" href=mailto:dottami@gmail.com title=Email><i class="fas fa-fw fa-2x fa-envelope" style=color:#0963ac></i>
</a><a class="nav-link social-link" target=_blank href=https://github.com/jaehyeon-kim title=GitHub rel=me><i class="fa-fw fa-2x fab fa-github"></i>
</a><a class="nav-link social-link" target=_blank href=https://linkedin.com/in/jaehyeon-kim-76b93429 title=LinkedIn rel=me><i class="fa-fw fa-2x fab fa-linkedin-in" style=color:#0a66c2></i>
</a><a class="nav-link social-link" target=_blank href=https://www.paypal.com/paypalme/dottami title=PayPal rel=me><i class="fa-fw fa-2x fab fa-paypal"></i></a></nav></div></div></div><div class="accordion taxonomies-toggle"><div class="row card component accordion-item"><div class="accordion-header card-header border-0"><a class="accordion-button d-lg-none mb-1 shadow-none p-0 bg-transparent" role=button data-bs-toggle=collapse href=#taxonomies-toggle aria-expanded=true aria-controls=taxonomies-toggle>Taxonomies</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id=taxonomies-toggle><ul class="nav nav-pills nav-fill" role=tablist><li class=nav-item role=presentation><button class="nav-link active" id=taxonomyCategoriesTab data-bs-toggle=tab data-bs-target=#taxonomyCategories type=button role=tab aria-controls=taxonomyCategories aria-selected=true>
Categories</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomyTagsTab data-bs-toggle=tab data-bs-target=#taxonomyTags type=button role=tab aria-controls=taxonomyTags aria-selected=true>
Tags</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomySeriesTab data-bs-toggle=tab data-bs-target=#taxonomySeries type=button role=tab aria-controls=taxonomySeries aria-selected=true>
Series</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomyArchivesTab data-bs-toggle=tab data-bs-target=#taxonomyArchives type=button role=tab aria-controls=taxonomyArchives aria-selected=true>
Archives</button></li></ul><div class="tab-content mt-3"><div class="tab-pane active" id=taxonomyCategories role=tabpanel aria-labelledby=taxonomyCategoriesTab tabindex=0><a href=/categories/data-streaming/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Data Streaming">Data Streaming
<span class="badge badge-sm text-secondary bg-white ms-1">25</span>
</a><a href=/categories/data-engineering/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Data Engineering">Data Engineering
<span class="badge badge-sm text-secondary bg-white ms-1">24</span>
</a><a href=/categories/development/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=Development>Development
<span class="badge badge-sm text-secondary bg-white ms-1">19</span>
</a><a href=/categories/r/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=R>R
<span class="badge badge-sm text-secondary bg-white ms-1">15</span>
</a><a href=/categories/apache-kafka/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Apache Kafka">Apache Kafka
<span class="badge badge-sm text-secondary bg-white ms-1">14</span>
</a><a href=/categories/machine-learning/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Machine Learning">Machine Learning
<span class="badge badge-sm text-secondary bg-white ms-1">7</span>
</a><a href=/categories/general/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title=General>General
<span class="badge badge-sm text-secondary bg-white ms-1">5</span>
</a><a href=/categories/apache-beam/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Apache Beam">Apache Beam
<span class="badge badge-sm text-secondary bg-white ms-1">2</span></a></div><div class=tab-pane id=taxonomyTags role=tabpanel aria-labelledby=taxonomyTagsTab tabindex=0><a href=/tags/docker/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Docker>Docker
<span class="badge badge-sm text-secondary bg-white ms-1">51</span>
</a><a href=/tags/python/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Python>Python
<span class="badge badge-sm text-secondary bg-white ms-1">47</span>
</a><a href=/tags/apache-kafka/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Apache Kafka">Apache Kafka
<span class="badge badge-sm text-secondary bg-white ms-1">44</span>
</a><a href=/tags/aws/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=AWS>AWS
<span class="badge badge-sm text-secondary bg-white ms-1">43</span>
</a><a href=/tags/docker-compose/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Docker Compose">Docker Compose
<span class="badge badge-sm text-secondary bg-white ms-1">43</span>
</a><a href=/tags/r/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=R>R
<span class="badge badge-sm text-secondary bg-white ms-1">36</span>
</a><a href=/tags/amazon-msk/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon MSK">Amazon MSK
<span class="badge badge-sm text-secondary bg-white ms-1">21</span>
</a><a href=/tags/apache-spark/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Apache Spark">Apache Spark
<span class="badge badge-sm text-secondary bg-white ms-1">17</span>
</a><a href=/tags/kafka-connect/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Kafka Connect">Kafka Connect
<span class="badge badge-sm text-secondary bg-white ms-1">17</span>
</a><a href=/tags/aws-lambda/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="AWS Lambda">AWS Lambda
<span class="badge badge-sm text-secondary bg-white ms-1">15</span>
</a><a href=/tags/apache-flink/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Apache Flink">Apache Flink
<span class="badge badge-sm text-secondary bg-white ms-1">14</span>
</a><a href=/tags/terraform/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Terraform>Terraform
<span class="badge badge-sm text-secondary bg-white ms-1">14</span>
</a><a href=/tags/amazon-emr/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon EMR">Amazon EMR
<span class="badge badge-sm text-secondary bg-white ms-1">11</span>
</a><a href=/tags/data-build-tool-dbt/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Data Build Tool (DBT)">Data Build Tool (DBT)
<span class="badge badge-sm text-secondary bg-white ms-1">11</span>
</a><a href=/tags/pyflink/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=PyFlink>PyFlink
<span class="badge badge-sm text-secondary bg-white ms-1">11</span>
</a><a href=/tags/amazon-msk-connect/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon MSK Connect">Amazon MSK Connect
<span class="badge badge-sm text-secondary bg-white ms-1">9</span>
</a><a href=/tags/kubernetes/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Kubernetes>Kubernetes
<span class="badge badge-sm text-secondary bg-white ms-1">8</span>
</a><a href=/tags/amazon-athena/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon Athena">Amazon Athena
<span class="badge badge-sm text-secondary bg-white ms-1">6</span>
</a><a href=/tags/pyspark/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=PySpark>PySpark
<span class="badge badge-sm text-secondary bg-white ms-1">6</span>
</a><a href=/tags/amazon-dynamodb/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon DynamoDB">Amazon DynamoDB
<span class="badge badge-sm text-secondary bg-white ms-1">5</span>
</a><a href=/tags/apache-airflow/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Apache Airflow">Apache Airflow
<span class="badge badge-sm text-secondary bg-white ms-1">5</span>
</a><a href=/tags/rserve/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Rserve>Rserve
<span class="badge badge-sm text-secondary bg-white ms-1">5</span>
</a><a href=/tags/visual-studio-code/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Visual Studio Code">Visual Studio Code
<span class="badge badge-sm text-secondary bg-white ms-1">5</span>
</a><a href=/tags/amazon-api-gateway/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon API Gateway">Amazon API Gateway
<span class="badge badge-sm text-secondary bg-white ms-1">4</span>
</a><a href=/tags/amazon-managed-flink/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon Managed Flink">Amazon Managed Flink
<span class="badge badge-sm text-secondary bg-white ms-1">4</span>
</a><a href=/tags/amazon-managed-service-for-apache-flink/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon Managed Service for Apache Flink">Amazon Managed Service for Apache Flink
<span class="badge badge-sm text-secondary bg-white ms-1">4</span>
</a><a href=/tags/amazon-quicksight/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon QuickSight">Amazon QuickSight
<span class="badge badge-sm text-secondary bg-white ms-1">4</span>
</a><a href=/tags/aws-glue/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="AWS Glue">AWS Glue
<span class="badge badge-sm text-secondary bg-white ms-1">4</span>
</a><a href=/tags/minikube/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Minikube>Minikube
<span class="badge badge-sm text-secondary bg-white ms-1">4</span>
</a><a href=/tags/opensearch/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=OpenSearch>OpenSearch
<span class="badge badge-sm text-secondary bg-white ms-1">4</span>
</a><a href=/tags/security/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Security>Security
<span class="badge badge-sm text-secondary bg-white ms-1">4</span>
</a><a href=/tags/shiny/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Shiny>Shiny
<span class="badge badge-sm text-secondary bg-white ms-1">4</span>
</a><a href=/tags/amazon-eks/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon EKS">Amazon EKS
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=/tags/amazon-opensearch-service/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon OpenSearch Service">Amazon OpenSearch Service
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=/tags/amazon-s3/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Amazon S3">Amazon S3
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=/tags/apache-camel/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Apache Camel">Apache Camel
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=/tags/apache-hudi/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Apache Hudi">Apache Hudi
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=/tags/apache-iceberg/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Apache Iceberg">Apache Iceberg
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=/tags/aws-sam/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="AWS SAM">AWS SAM
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=/tags/change-data-capture/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Change Data Capture">Change Data Capture
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=https://jaehyeon.me/tags class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=ALL>ALL
<span class="badge badge-sm text-secondary bg-white ms-1">97</span></a></div><div class=tab-pane id=taxonomySeries role=tabpanel aria-labelledby=taxonomySeriesTab tabindex=0><a href=/series/kafka-development-with-docker/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Kafka Development With Docker">Kafka Development With Docker
<span class="badge badge-sm text-secondary bg-white ms-1">11</span>
</a><a href=/series/real-time-streaming-with-kafka-and-flink/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Real Time Streaming With Kafka and Flink">Real Time Streaming With Kafka and Flink
<span class="badge badge-sm text-secondary bg-white ms-1">7</span>
</a><a href=/series/dbt-pizza-shop-demo/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="DBT Pizza Shop Demo">DBT Pizza Shop Demo
<span class="badge badge-sm text-secondary bg-white ms-1">6</span>
</a><a href=/series/tree-based-methods-in-r/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Tree Based Methods in R">Tree Based Methods in R
<span class="badge badge-sm text-secondary bg-white ms-1">6</span>
</a><a href=/series/dbt-for-effective-data-transformation-on-aws/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="DBT for Effective Data Transformation on AWS">DBT for Effective Data Transformation on AWS
<span class="badge badge-sm text-secondary bg-white ms-1">5</span>
</a><a href=/series/kafka-connect-for-aws-services-integration/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Kafka Connect for AWS Services Integration">Kafka Connect for AWS Services Integration
<span class="badge badge-sm text-secondary bg-white ms-1">5</span>
</a><a href=/series/serverless-data-product/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Serverless Data Product">Serverless Data Product
<span class="badge badge-sm text-secondary bg-white ms-1">4</span>
</a><a href=/series/data-lake-demo-using-change-data-capture/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Data Lake Demo Using Change Data Capture">Data Lake Demo Using Change Data Capture
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=/series/getting-started-with-pyflink-on-aws/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Getting Started With Pyflink on AWS">Getting Started With Pyflink on AWS
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=/series/kafka-development-on-kubernetes/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Kafka Development on Kubernetes">Kafka Development on Kubernetes
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=/series/parallel-processing-on-single-machine/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Parallel Processing on Single Machine">Parallel Processing on Single Machine
<span class="badge badge-sm text-secondary bg-white ms-1">3</span>
</a><a href=/series/apache-beam-local-development-with-python/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Apache Beam Local Development With Python">Apache Beam Local Development With Python
<span class="badge badge-sm text-secondary bg-white ms-1">2</span>
</a><a href=/series/api-development-with-r/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="API Development With R">API Development With R
<span class="badge badge-sm text-secondary bg-white ms-1">2</span>
</a><a href=/series/integrate-schema-registry-with-msk-connect/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Integrate Schema Registry With MSK Connect">Integrate Schema Registry With MSK Connect
<span class="badge badge-sm text-secondary bg-white ms-1">2</span>
</a><a href=/series/kafka-flink-and-dynamodb-for-real-time-fraud-detection/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Kafka, Flink and DynamoDB for Real Time Fraud Detection">Kafka, Flink and DynamoDB for Real Time Fraud Detection
<span class="badge badge-sm text-secondary bg-white ms-1">2</span>
</a><a href=/series/simplify-streaming-ingestion-on-aws/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Simplify Streaming Ingestion on AWS">Simplify Streaming Ingestion on AWS
<span class="badge badge-sm text-secondary bg-white ms-1">2</span></a></div><div class=tab-pane id=taxonomyArchives role=tabpanel aria-labelledby=taxonomyArchivesTab tabindex=0><a href=/archives/2024/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2024>2024 <span class="badge badge-sm text-secondary bg-white ms-1">10</span>
</a><a href=/archives/2023/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2023>2023 <span class="badge badge-sm text-secondary bg-white ms-1">39</span>
</a><a href=/archives/2022/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2022>2022 <span class="badge badge-sm text-secondary bg-white ms-1">15</span>
</a><a href=/archives/2021/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2021>2021 <span class="badge badge-sm text-secondary bg-white ms-1">7</span>
</a><a href=/archives/2020/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2020>2020 <span class="badge badge-sm text-secondary bg-white ms-1">1</span>
</a><a href=/archives/2019/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2019>2019 <span class="badge badge-sm text-secondary bg-white ms-1">5</span>
</a><a href=/archives/2018/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2018>2018 <span class="badge badge-sm text-secondary bg-white ms-1">2</span>
</a><a href=/archives/2017/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2017>2017 <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
</a><a href=/archives/2016/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2016>2016 <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
</a><a href=/archives/2015/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2015>2015 <span class="badge badge-sm text-secondary bg-white ms-1">15</span>
</a><a href=/archives/2014/ class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2014>2014 <span class="badge badge-sm text-secondary bg-white ms-1">5</span></a></div></div></div></div></div><div class="accordion posts-toggle"><div class="row card component accordion-item"><div class="accordion-header card-header border-0"><a class="accordion-button d-lg-none mb-1 shadow-none p-0 bg-transparent" role=button data-bs-toggle=collapse href=#posts-toggle aria-expanded=true aria-controls=posts-toggle>Posts</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id=posts-toggle><ul class="nav nav-pills nav-fill" role=tablist><li class=nav-item role=presentation><button class="nav-link active" id=featured-posts-tab data-bs-toggle=tab data-bs-target=#featured-posts type=button role=tab aria-controls=featured-posts aria-selected=true>
Featured Posts</button></li><li class=nav-item role=presentation><button class=nav-link id=recent-posts-tab data-bs-toggle=tab data-bs-target=#recent-posts type=button role=tab aria-controls=recent-posts aria-selected=true>
Recent Posts</button></li></ul><div class="tab-content mt-3"><div class="tab-pane active" id=featured-posts role=tabpanel aria-labelledby=featured-posts-tab tabindex=0><ul class="post-list list-unstyled ms-1"><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-04-04-beam-local-dev-2/featured_huc60febc0cd72955054b95c3bf20650a7_55405_500x0_resize_box_3.png media="(max-width: 576px)" height=330 width=500><img class=img-fluid height=119 width=180 alt=featured.png src=/blog/2024-04-04-beam-local-dev-2/featured_huc60febc0cd72955054b95c3bf20650a7_55405_180x0_resize_box_3.png data-src=/blog/2024-04-04-beam-local-dev-2/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-04-04-beam-local-dev-2/>Apache Beam Local Development With Python - Part 2 Batch Pipelines</a><div class="post-meta mt-2"><span class=post-date>April 4, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-03-28-beam-local-dev-1/featured_hu8df3c1065468b257d73fe4ccb72b4c47_88260_500x0_resize_box_3.png media="(max-width: 576px)" height=338 width=500><img class=img-fluid height=122 width=180 alt=featured.png src=/blog/2024-03-28-beam-local-dev-1/featured_hu8df3c1065468b257d73fe4ccb72b4c47_88260_180x0_resize_box_3.png data-src=/blog/2024-03-28-beam-local-dev-1/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-03-28-beam-local-dev-1/>Apache Beam Local Development With Python - Part 1 Pipeline, Notebook, SQL and DataFrame</a><div class="post-meta mt-2"><span class=post-date>March 28, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-03-14-dbt-pizza-shop-6/featured_hu72fe52c30196d9a511f344ff548f2036_82921_500x0_resize_box_3.png media="(max-width: 576px)" height=256 width=500><img class=img-fluid height=92 width=180 alt=featured.png src=/blog/2024-03-14-dbt-pizza-shop-6/featured_hu72fe52c30196d9a511f344ff548f2036_82921_180x0_resize_box_3.png data-src=/blog/2024-03-14-dbt-pizza-shop-6/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-03-14-dbt-pizza-shop-6/>Data Build Tool (Dbt) Pizza Shop Demo - Part 6 ETL on Amazon Athena via Airflow</a><div class="post-meta mt-2"><span class=post-date>March 14, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-03-07-dbt-pizza-shop-5/featured_hu5822ed54c6b6e6cff286a9a560a4b806_61499_500x0_resize_box_3.png media="(max-width: 576px)" height=187 width=500><img class=img-fluid height=67 width=180 alt=featured.png src=/blog/2024-03-07-dbt-pizza-shop-5/featured_hu5822ed54c6b6e6cff286a9a560a4b806_61499_180x0_resize_box_3.png data-src=/blog/2024-03-07-dbt-pizza-shop-5/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-03-07-dbt-pizza-shop-5/>Data Build Tool (Dbt) Pizza Shop Demo - Part 5 Modelling on Amazon Athena</a><div class="post-meta mt-2"><span class=post-date>March 7, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-02-22-dbt-pizza-shop-4/featured_hu487187112b89f2568f433199221f000a_89588_500x0_resize_box_3.png media="(max-width: 576px)" height=327 width=500><img class=img-fluid height=118 width=180 alt=featured.png src=/blog/2024-02-22-dbt-pizza-shop-4/featured_hu487187112b89f2568f433199221f000a_89588_180x0_resize_box_3.png data-src=/blog/2024-02-22-dbt-pizza-shop-4/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-02-22-dbt-pizza-shop-4/>Data Build Tool (Dbt) Pizza Shop Demo - Part 4 ETL on BigQuery via Airflow</a><div class="post-meta mt-2"><span class=post-date>February 22, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-02-08-dbt-pizza-shop-3/featured_hu5082aedceaa438015dc31206ac8f27c2_70297_500x0_resize_box_3.png media="(max-width: 576px)" height=241 width=500><img class=img-fluid height=87 width=180 alt=featured.png src=/blog/2024-02-08-dbt-pizza-shop-3/featured_hu5082aedceaa438015dc31206ac8f27c2_70297_180x0_resize_box_3.png data-src=/blog/2024-02-08-dbt-pizza-shop-3/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-02-08-dbt-pizza-shop-3/>Data Build Tool (Dbt) Pizza Shop Demo - Part 3 Modelling on BigQuery</a><div class="post-meta mt-2"><span class=post-date>February 8, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-01-25-dbt-pizza-shop-2/featured_hu32c9a8b2df36b3a1704029fc725738dd_77355_500x0_resize_box_3.png media="(max-width: 576px)" height=328 width=500><img class=img-fluid height=118 width=180 alt=featured.png src=/blog/2024-01-25-dbt-pizza-shop-2/featured_hu32c9a8b2df36b3a1704029fc725738dd_77355_180x0_resize_box_3.png data-src=/blog/2024-01-25-dbt-pizza-shop-2/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-01-25-dbt-pizza-shop-2/>Data Build Tool (Dbt) Pizza Shop Demo - Part 2 ETL on PostgreSQL via Airflow</a><div class="post-meta mt-2"><span class=post-date>January 25, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-01-18-dbt-pizza-shop-1/featured_hua8fc52ecfe83e5abaf1872cc948e583f_85093_500x0_resize_box_3.png media="(max-width: 576px)" height=238 width=500><img class=img-fluid height=86 width=180 alt=featured.png src=/blog/2024-01-18-dbt-pizza-shop-1/featured_hua8fc52ecfe83e5abaf1872cc948e583f_85093_180x0_resize_box_3.png data-src=/blog/2024-01-18-dbt-pizza-shop-1/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-01-18-dbt-pizza-shop-1/>Data Build Tool (Dbt) Pizza Shop Demo - Part 1 Modelling on PostgreSQL</a><div class="post-meta mt-2"><span class=post-date>January 18, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2023-12-21-kafka-development-on-k8s-part-1/featured_hu216964ff6c7a4996550e95c3e0e5f209_108975_500x0_resize_box_3.png media="(max-width: 576px)" height=263 width=500><img class=img-fluid height=95 width=180 alt=featured.png src=/blog/2023-12-21-kafka-development-on-k8s-part-1/featured_hu216964ff6c7a4996550e95c3e0e5f209_108975_180x0_resize_box_3.png data-src=/blog/2023-12-21-kafka-development-on-k8s-part-1/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2023-12-21-kafka-development-on-k8s-part-1/>Kafka Development on Kubernetes - Part 1 Cluster Setup</a><div class="post-meta mt-2"><span class=post-date>December 21, 2023</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2023-12-07-flink-spark-local-dev/featured_hu7a73c8ca7d8b8a4ddf49d1a9b8fe40bd_133053_500x0_resize_box_3.png media="(max-width: 576px)" height=373 width=500><img class=img-fluid height=134 width=180 alt=featured.png src=/blog/2023-12-07-flink-spark-local-dev/featured_hu7a73c8ca7d8b8a4ddf49d1a9b8fe40bd_133053_180x0_resize_box_3.png data-src=/blog/2023-12-07-flink-spark-local-dev/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2023-12-07-flink-spark-local-dev/>Setup Local Development Environment for Apache Flink and Spark Using EMR Container Images</a><div class="post-meta mt-2"><span class=post-date>December 7, 2023</span></div></div></div></li></ul></div><div class=tab-pane id=recent-posts role=tabpanel aria-labelledby=recent-posts-tab tabindex=0><ul class="post-list list-unstyled ms-1"><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-04-04-beam-local-dev-2/featured_huc60febc0cd72955054b95c3bf20650a7_55405_500x0_resize_box_3.png media="(max-width: 576px)" height=330 width=500><img class=img-fluid height=119 width=180 alt=featured.png src=/blog/2024-04-04-beam-local-dev-2/featured_huc60febc0cd72955054b95c3bf20650a7_55405_180x0_resize_box_3.png data-src=/blog/2024-04-04-beam-local-dev-2/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-04-04-beam-local-dev-2/>Apache Beam Local Development With Python - Part 2 Batch Pipelines</a><div class="post-meta mt-2"><span class=post-date>April 4, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-03-28-beam-local-dev-1/featured_hu8df3c1065468b257d73fe4ccb72b4c47_88260_500x0_resize_box_3.png media="(max-width: 576px)" height=338 width=500><img class=img-fluid height=122 width=180 alt=featured.png src=/blog/2024-03-28-beam-local-dev-1/featured_hu8df3c1065468b257d73fe4ccb72b4c47_88260_180x0_resize_box_3.png data-src=/blog/2024-03-28-beam-local-dev-1/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-03-28-beam-local-dev-1/>Apache Beam Local Development With Python - Part 1 Pipeline, Notebook, SQL and DataFrame</a><div class="post-meta mt-2"><span class=post-date>March 28, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-03-14-dbt-pizza-shop-6/featured_hu72fe52c30196d9a511f344ff548f2036_82921_500x0_resize_box_3.png media="(max-width: 576px)" height=256 width=500><img class=img-fluid height=92 width=180 alt=featured.png src=/blog/2024-03-14-dbt-pizza-shop-6/featured_hu72fe52c30196d9a511f344ff548f2036_82921_180x0_resize_box_3.png data-src=/blog/2024-03-14-dbt-pizza-shop-6/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-03-14-dbt-pizza-shop-6/>Data Build Tool (Dbt) Pizza Shop Demo - Part 6 ETL on Amazon Athena via Airflow</a><div class="post-meta mt-2"><span class=post-date>March 14, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-03-07-dbt-pizza-shop-5/featured_hu5822ed54c6b6e6cff286a9a560a4b806_61499_500x0_resize_box_3.png media="(max-width: 576px)" height=187 width=500><img class=img-fluid height=67 width=180 alt=featured.png src=/blog/2024-03-07-dbt-pizza-shop-5/featured_hu5822ed54c6b6e6cff286a9a560a4b806_61499_180x0_resize_box_3.png data-src=/blog/2024-03-07-dbt-pizza-shop-5/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-03-07-dbt-pizza-shop-5/>Data Build Tool (Dbt) Pizza Shop Demo - Part 5 Modelling on Amazon Athena</a><div class="post-meta mt-2"><span class=post-date>March 7, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-02-22-dbt-pizza-shop-4/featured_hu487187112b89f2568f433199221f000a_89588_500x0_resize_box_3.png media="(max-width: 576px)" height=327 width=500><img class=img-fluid height=118 width=180 alt=featured.png src=/blog/2024-02-22-dbt-pizza-shop-4/featured_hu487187112b89f2568f433199221f000a_89588_180x0_resize_box_3.png data-src=/blog/2024-02-22-dbt-pizza-shop-4/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-02-22-dbt-pizza-shop-4/>Data Build Tool (Dbt) Pizza Shop Demo - Part 4 ETL on BigQuery via Airflow</a><div class="post-meta mt-2"><span class=post-date>February 22, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-02-08-dbt-pizza-shop-3/featured_hu5082aedceaa438015dc31206ac8f27c2_70297_500x0_resize_box_3.png media="(max-width: 576px)" height=241 width=500><img class=img-fluid height=87 width=180 alt=featured.png src=/blog/2024-02-08-dbt-pizza-shop-3/featured_hu5082aedceaa438015dc31206ac8f27c2_70297_180x0_resize_box_3.png data-src=/blog/2024-02-08-dbt-pizza-shop-3/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-02-08-dbt-pizza-shop-3/>Data Build Tool (Dbt) Pizza Shop Demo - Part 3 Modelling on BigQuery</a><div class="post-meta mt-2"><span class=post-date>February 8, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-01-25-dbt-pizza-shop-2/featured_hu32c9a8b2df36b3a1704029fc725738dd_77355_500x0_resize_box_3.png media="(max-width: 576px)" height=328 width=500><img class=img-fluid height=118 width=180 alt=featured.png src=/blog/2024-01-25-dbt-pizza-shop-2/featured_hu32c9a8b2df36b3a1704029fc725738dd_77355_180x0_resize_box_3.png data-src=/blog/2024-01-25-dbt-pizza-shop-2/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-01-25-dbt-pizza-shop-2/>Data Build Tool (Dbt) Pizza Shop Demo - Part 2 ETL on PostgreSQL via Airflow</a><div class="post-meta mt-2"><span class=post-date>January 25, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-01-18-dbt-pizza-shop-1/featured_hua8fc52ecfe83e5abaf1872cc948e583f_85093_500x0_resize_box_3.png media="(max-width: 576px)" height=238 width=500><img class=img-fluid height=86 width=180 alt=featured.png src=/blog/2024-01-18-dbt-pizza-shop-1/featured_hua8fc52ecfe83e5abaf1872cc948e583f_85093_180x0_resize_box_3.png data-src=/blog/2024-01-18-dbt-pizza-shop-1/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-01-18-dbt-pizza-shop-1/>Data Build Tool (Dbt) Pizza Shop Demo - Part 1 Modelling on PostgreSQL</a><div class="post-meta mt-2"><span class=post-date>January 18, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-01-11-kafka-development-on-k8s-part-3/featured_hu95d566cb28d7f91b2d6baddb7d8bb440_97270_500x0_resize_box_3.png media="(max-width: 576px)" height=216 width=500><img class=img-fluid height=78 width=180 alt=featured.png src=/blog/2024-01-11-kafka-development-on-k8s-part-3/featured_hu95d566cb28d7f91b2d6baddb7d8bb440_97270_180x0_resize_box_3.png data-src=/blog/2024-01-11-kafka-development-on-k8s-part-3/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-01-11-kafka-development-on-k8s-part-3/>Kafka Development on Kubernetes - Part 3 Kafka Connect</a><div class="post-meta mt-2"><span class=post-date>January 11, 2024</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-shrink-0 d-flex justify-content-center align-items-center" style=max-width:100px><picture><source srcset=/blog/2024-01-04-kafka-development-on-k8s-part-2/featured_hu866886d7082b1c38bf0c33066b35072f_75889_500x0_resize_box_3.png media="(max-width: 576px)" height=263 width=500><img class=img-fluid height=95 width=180 alt=featured.png src=/blog/2024-01-04-kafka-development-on-k8s-part-2/featured_hu866886d7082b1c38bf0c33066b35072f_75889_180x0_resize_box_3.png data-src=/blog/2024-01-04-kafka-development-on-k8s-part-2/featured.png loading=lazy></picture></div><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center ms-3"><a class=post-title href=/blog/2024-01-04-kafka-development-on-k8s-part-2/>Kafka Development on Kubernetes - Part 2 Producer and Consumer</a><div class="post-meta mt-2"><span class=post-date>January 4, 2024</span></div></div></div></li></ul></div></div></div></div></div></div></aside></div></main><footer class="footer mt-auto py-3 text-center container"><div class="offcanvas offcanvas-bottom h-auto" tabindex=-1 id=offcanvasActionsPanel aria-labelledby=offcanvasActionsPanelLabel><div class=offcanvas-header><div class="offcanvas-title h5" id=offcanvasActionsPanelLabel><i class="fas fa-fw fa-th-large me-1"></i>
Actions</div><button type=button class="btn-close ms-auto" data-bs-dismiss=offcanvas data-bs-target=offcanvasActionsPanel aria-label=Close></button></div><div class="offcanvas-body mt-2"><div class="actions d-flex overflow-auto align-items-center"><a role=button class="action action-go-back d-flex flex-column align-items-center me-3" href="javascript: window.history.back();"><span class="action-icon mb-2"><i class="fas fa-2x fa-chevron-circle-down" data-fa-transform=rotate-90></i></span> Go back
</a><a role=button class="action action-reload-page d-flex flex-column align-items-center me-3"><span class="action-icon mb-2"><i class="fas fa-2x fa-redo-alt"></i></span> Reload
</a><a role=button class="action action-copy-url d-flex flex-column align-items-center me-3"><span class="action-icon mb-2"><i class="fas fa-2x fa-link"></i></span> Copy URL</a></div></div></div><div class="row text-center"><div class="col-12 mt-2"><p class=mb-2>Jaehyeon Kim</p><p class="text-secondary mb-2"><small>Data Engineer 💡 Blogger ⚡ Data Streaming Enthusiast ☁ AWS Community Builder</small></p><div class="copyright mb-2 text-secondary"><small>Copyright © 2023-2024 Jaehyeon Kim. All Rights Reserved.</small></div><nav class="social-links nav justify-content-center mb-2 mt-3"><a class="nav-link social-link p-0 me-1 mb-2" target=_blank href=/index.xml title=RSS rel=me><i class="fas fa-fw fa-2x fa-rss" style=color:#ea6221></i></a></nav></div><div class="col-12 col-lg-8 offset-0 offset-lg-1"></div></div></footer><script data-precache src=/assets/main/bundle.min.0ec8d79b95bd8d39246804f325aa5ba906dd898c752c661cb355262f78ecadcb.js integrity="sha256-DsjXm5W9jTkkaATzJapbqQbdiYx1LGYcs1UmL3jsrcs=" crossorigin=anonymous async></script><script data-precache src=/assets/icons/bundle.min.4f30d5267a9f2f9d45ed93969d45ec626100a969a8b91f71f753315a261e9034.js integrity="sha256-TzDVJnqfL51F7ZOWnUXsYmEAqWmouR9x91MxWiYekDQ=" crossorigin=anonymous defer></script><script data-precache src=/assets/viewer/bundle.min.06371891cfe6d10d36cba465c61c4d7cb17591a3be2fd9af4a38444d2074e709.js integrity="sha256-BjcYkc/m0Q02y6RlxhxNfLF1kaO+L9mvSjhETSB05wk=" crossorigin=anonymous defer></script><script data-precache defer src=/assets/katex/bundle.min.1a8cd88028fe1b600e81e2e780a8d8c388134c8237d5da89efed53ddfa28216e.js integrity="sha256-GozYgCj+G2AOgeLngKjYw4gTTII31dqJ7+1T3fooIW4=" crossorigin=anonymous></script><script data-precache defer src=/assets/mermaid/bundle.min.8d91e77f8b2cd5ebfd6d2af4e214fa37b555b15ad65dc1bdec5564ce709176f9.js integrity="sha256-jZHnf4ss1ev9bSr04hT6N7VVsVrWXcG97FVkznCRdvk=" crossorigin=anonymous></script><script src=/js/sw-register.js defer></script><script src=https://giscus.app/client.js data-repo=jaehyeon-kim/jaehyeon-kim.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkyNjgwMjU0NQ==" data-category data-category-id=DIC_kwDOAZj5cc4CV2fp data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=1 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous defer></script></body></html>