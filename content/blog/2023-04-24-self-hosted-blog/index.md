---
title: Self-managed Blog with Hugo and GitHub Pages
date: 2023-04-24
draft: false
featured: false
comment: true
toc: true
reward: false
pinned: false
carousel: false
featuredImage: false
# series:
#   - 
categories:
  - General
tags: 
  - Hugo
  - Bootstrap
  - GitHub Pages
authors:
  - JaehyeonKim
images: []
description: We can quickly create a blog site with a static site generator and host via GitHub pages. After searching mainly Hugo, Jekyll and Pelican, I chose Hugo as it has more themes with good features. In this post, I'll demonstrate how I set up this blog site.
---

I started blogging in 2014. At first, it was based on a simple Jekyll theme that supports posting [Markdown](https://en.wikipedia.org/wiki/Markdown) files, which are converted from [R Markdown](https://github.com/rstudio/rmarkdown) files. Most of my work was in [R](https://www.r-project.org/about.html) at that time and the simple theme was good enough, and it was hosted via [GitHub Pages](https://pages.github.com/). It was around 2018 when I changed my blog with a single page application, built by [Vue.js](https://vuejs.org/) and hosted on AWS. It was fun as I was teaching myself web development while building an analytics portal at work. In 2020, I paused blogging for some time while expecting a baby and restarted publishing posts to my [company's blog page](https://cevo.com.au/author/jaehyeon-kim/) from mid-2021. It is good as I can have peer-reviews and the company provides an incentive for each post published. However, it is not the right place to publish all the posts that I plan. For example, I am recommended to keep in mind e.g. *how an article translates into better customer outcomes*. That's understandable but not all posts can fit into it. Currently, I am teaching myself [modern data streaming architectures](https://docs.aws.amazon.com/whitepapers/latest/build-modern-data-streaming-analytics-architectures/build-modern-data-streaming-analytics-architectures.html), and some articles could be inadequate for customers until I gain competency. Therefore, I thought I need another place that I can publish posts without worrying about undermining my company's reputation. I'd keep publishing to the company site, and I probably repost some of them to this new blog with delay.

I wouldn't like to use the existing site as it misses some features, and it'd take time to add those to it. As I prefer a self-managed blog over a blog platform, I thought a [static site generator](https://jamstack.org/generators/) and GitHub Pages would be one of the quickest options. After searching mainly [Hugo](https://gohugo.io/), [Jekyll](https://jekyllrb.com/) and [Pelican](https://getpelican.com/), Hugo caught up my eyes as it has [more themes with good features](https://themes.gohugo.io/). Among those I chose the [Hugo Bootstrap Theme](https://github.com/razonyang/hugo-theme-bootstrap). In this post, I'll demonstrate how I set up this blog site.

## Quick Start

I used the [starter template](https://github.com/razonyang/hugo-theme-bootstrap-skeleton) of the [Hugo Bootstrap Theme](https://github.com/razonyang/hugo-theme-bootstrap). After installing _Node.js (16+)_, I cloned the template and installed NPN packages by executing `npm install`. Then I changed the module name in the `go.mod` file into mine (i.e. `module github.com/jaehyeon-kim/jaehyeon-kim.github.io`). Finally, I started the site using *docker-compose* with the compose file shown below. Without docker, I have to install [_Hugo (0.97.0+)_](https://hbs.razonyang.com/v1/en/docs/getting-started/prerequisites/#build-tools) but the apt repo has an older version and I wouldn't like to be bothered to install a supported version from source. Using *docker-compose* is a much easier way for me. Note it reloads the site when there is a change in the current directory so that updated contents can be checked on a browser seamlessly.

```yaml
version: "3.5"

services:
  hugo:
      image: klakegg/hugo:0.107.0-ext-ubuntu
      command: server -D -F -E --poll 700ms
      container_name: hugo
      volumes:
        - $PWD:/src
        - /etc/ssl/certs:/etc/ssl/certs
      ports:
        - "1313:1313"
```

Below shows the site generated by the template. As it has way more sections and menus, I reduced those by updating configurations.

![](before.png#center)

## Update Configuration

The `config/_default` folder contains default configurations and I mainly updated the site configuration (*config.yaml*), site parameters (*params.yaml*) and menu configuration (*menu.yaml*). Note they can be overridden by those in the `config/production` folder.

```bash
$ tree config
config
├── _default
│   ├── author.yaml
│   ├── config.yaml
│   ├── languages.yaml
│   ├── menu.yaml
│   ├── params.yaml
│   ├── server.yaml
│   └── social.yaml
└── production
    ├── config.yaml
    └── params.yaml
```

### Site Configuration

The [site configuration](https://hbs.razonyang.com/v1/en/docs/configuration/site/) section includes [Hugo-defined variables](https://gohugo.io/getting-started/configuration/#all-configuration-settings). I mainly updated *title*, *copyright* and *taxonomies*. Also, the [*markup* config](https://gohugo.io/getting-started/configuration-markup/) is added to override the default config of code highlight and table of contents.

```yaml
# config/_default/config.yaml
baseURL: /
title: Jaehyeon
theme: github.com/razonyang/hugo-theme-bootstrap
copyright: 'Copyright © 2023-{year} Jaehyeon Kim. All Rights Reserved.'
defaultContentLanguage: en
...
taxonomies:
  category: categories
  series: series
  tag: tags
...
markup:
  highlight:
    lineNos: true
    lineNumbersInTable: false
    noClasses: false
  tableOfContents:
    endLevel: 6
    ordered: false
    startLevel: 2
```

### Site Parameters

The [site parameters](https://hbs.razonyang.com/v1/en/docs/configuration/site-params/) section includes specific config variables for the Hugo theme. They are self-explanatory and have comments that explain further. Configuration of site parameters would require trials and errors, and we can quickly check the updated content thanks to Hugo's hot reloading feature.

```yaml
# config/_default/params.yaml
mainSections:
  - blog
  - posts
description: <description>
keywords: <keyword-1>, <keyword-2>
images:
  - site-feature-image.png
...
logo: false # Disable Logo
brand: Jaehyeon Kim
palette: blue-gray
color: light # light, dark or auto. Default to auto.
...
googleAdsense: <AdSense Publisher ID>
math: true # Enable math globally.
toc: true # Disable TOC globally.
tocPosition: content # sidebar or content
...
searchBar: true # disable search-bar
poweredBy: false # Whether to show powered by.
readingTime: true # Whether to display the reading time.
postDate: true # Whether to display the post date in the post meta section.
...
sidebarTaxonomies: [categories, tags, series] # The order of taxonomies on the sidebar.
...
codeBlock:
  maxLines: 20
  lineNos: true # true/false represents that show/hide the line numbers by default.
...
post:
  excerpt: description
  excerptMaxLength: 200
  copyright: false # Whether to display copyright section on each post.
  featuredImage: true # Show the featured image above the content.
  numberifyHeadings: false # Count headings automatically.
  numberifyHeadingsSeparator: . # The separator between of number and headings.
  imageTitleAsCaption: true
...
search:
  paginate: 5 # Pagination. Default to 10.
  fuse:
    threshold: 0.1
...
topAppBar:
  social:
    github: <GitHub User ID>
    linkedin: <LinkedIn ID>
    paypal: <Paypal.Me Link ID>
```

### Menu Configuration

For now, I only need the blog menu and all other items are removed from the [menu configuration](https://hbs.razonyang.com/v1/en/docs/configuration/menu/).

```yaml
# config/_default/menu.yaml
main:
  - name: Blog
    identifier: blog
    params:
      icon: '<i class="fas fa-fw fa-blog text-warning"></i>'
      description:
```

### Production Configuration

As mentioned, the production configuration can be overridden. I'll host it using a custom domain, and the base URL is updated accordingly. I added the Google Analytics measurement ID as well, and it'll ensure the site activities are tracked only when it is deployed.

```yaml
# config/production/config.yaml
baseURL: https://jaehyeon.me/
googleAnalytics: <Measurement ID>
```

## Content Configuration

Contents of a post are kept in a subfolder of the `content/blog` folder - e.g. `content/blog/2023-04-27-self-hosted-blog`. The article is written in *index.md*, and the post folder includes figures that can be referenced within the article. Note *featured.png* will be showing at the top of the post page as well as in the post list - see the [featured image configuration](https://hbs.razonyang.com/v1/en/docs/content/#featured-images-selection-order) for details.

```bash
$ tree content/blog/2023-04-24-self-hosted-blog/
content/blog/2023-04-24-self-hosted-blog/
├── after.png
├── before.png
├── comment-1.png
├── comment-2.png
├── comment-3.png
├── comment-4.png
├── custom-domain-1.png
├── custom-domain-2.png
├── custom-domain-3.png
├── discussion-1.png
├── discussion-2.png
├── featured.png
├── giscus-1.png
├── giscus-2.png
└── index.md
```

The [page parameters](https://hbs.razonyang.com/v1/en/docs/configuration/page-params/) can be added at the top. It allows you to configure post components (e.g. *comment*, *toc*, *carousel*, ...), visibility (e.g. *draft*) etc.

```yaml
---
title: Self-managed Blog with Hugo and GitHub Pages
date: 2023-04-24
draft: true
featured: false
comment: true
toc: true
reward: false
pinned: false
carousel: false
featuredImage: false
# series:
#   - 
categories:
  - Blog
tags: 
  - Hugo
  - Bootstrap
  - GitHub Pages
authors:
  - JaehyeonKim
images: []
description: <description>
---

<article contents>
```

Once created, we can check it appears in the post list as shown below. We can visit the post by clicking the title or the *Read More* button.

![](after.png#center)

## Configure Custom Domain

The GitHub Pages has a [good documentation](https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site) about custom domain configuration. I'll sketch how I set it up so that my custom domain (*jaehyeon.me*) is used to serve the site.

### Create ACM Certificate

I bought the domain from Route53, and a public hosted zone is created automatically. In order to serve the site via HTTPS, an ACM certificate is create for the domain and all of its subdomains. We can create a certificate by CloudFormation, and domain validation can be automated via DNS validation. 

```yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: Create an ACM certificate for a domain and all of its subdomains.
Parameters:
  DomainName:
    Description: Fully qualified domain name (eg example.com)
    Type: String
  HostedZoneId:
    Description: Route53 hosted zone id
    Type: String
Resources:
  ACMCertificate:
    Type: AWS::CertificateManager::Certificate
    Properties:
      DomainName: Ref: DomainName
      DomainValidationOptions:
        - DomainName: Ref: DomainName
          HostedZoneId: Ref: HostedZoneId
      SubjectAlternativeNames:
        - !Sub "*.${DomainName}"
      ValidationMethod: DNS
Outputs:
  ACMCertificateArn:
    Value:
      Ref: ACMCertificate
```

### Manage Custom Domain

I plan to configure the apex domain (*jaehyeon.me*) primarily and added the A and AAAA records to the hosted zone as indicated in the [documentation](https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site). Also, the WWW subdomain (*www.jaehyeon.me*) is configured by adding a CNAME record to it. In this way, if someone visits the site by *www.jaehyeon.me*, it'll be redirected to *jaehyeon.me*.

![](custom-domain-1.png#center)

I saved the custom domain in the repository setting, and it is checked successfully. Note I do not enforce HTTPS as Google AdSense fails to verify the `ads.txt` file when it was enforced. 

![](custom-domain-2.png#center)

### Verify Custom Domain

The GitHub Pages recommends [verifying the custom domain](https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/verifying-your-custom-domain-for-github-pages) in order to increase security by avoiding takeover attacks. The domain is verified as shown below.

![](custom-domain-3.png#center)

## Deployment

The starter template has a GitHub workflow ([.github/workflows/gh-pages.yml](https://github.com/jaehyeon-kim/jaehyeon-kim.github.io/blob/master/.github/workflows/gh-pages.yml)). It builds the site and deploys the `./public` folder to the remote *gh-pages* branch. Note GitHub Pages should be linked to the *gh-pages* branch.

I added three additional files to the `./public` folder so that they are found in the deployed site. *CNAME* includes the custom domain name (*jaehyeon.me*) so that it keeps being linked to the site. [*ads.txt*](https://support.google.com/adsense/answer/7532444?hl=en) is required by Google AdSense, and *site-feature-image.png* is as per the site parameter configuration.

```bash
$ tree public
public
├── CNAME
├── ads.txt
└── site-feature-image.png
```

Once it is deployed, we can visit the site using the custom domain.

## (Optional) Comment Widget

While it supports multiple [comment widgets](https://hbs.razonyang.com/v1/en/docs/widgets/comments/), I decided to use [Giscus](https://giscus.app/), which is a lightweight comment widget built on GitHub discussions.

I first enabled *Discussions* in the repository *Settings* as shown below.

![](discussion-1.png#center)

After that the *Discussions* tab is showing at the top, and we can see multiple discussion categories in that menu. As shown below, the widget requires a category where comments are saved, and I chose the *General* category.

![](discussion-2.png#center)

Then we need to install the widget as a GitHub app, and it can be installed by visiting its [GitHub App page](https://github.com/apps/giscus).

![](giscus-1.png#center)

I only selected the repository for the blog site and clicked the *Install* button.

![](giscus-2.png#center)

The *Giscus* configuration can be found in the site parameter configuration. It requires the repository name/ID and category ID.

```yaml
# config/_default/params.yaml
...
giscus:
  repo: <repo-owner>/<repository-name>
  repoId: "<repository-id>"
  # category: ""
  categoryId: "<catetory-id>"
  # theme: "dark" # Default to auto.
  # mapping: "title" # Default to pathname.
  inputPosition: "bottom" # Default to top.
  reactions: true # Disable reactions.
  metadata: true # Emit discussion metadata.
  # lang: "en" # Specify language, default to site language.
  # lazyLoading: false # Default to true.
...
```

The repository and category IDs can be obtained from the [GitHub GraphQL API Explorer](https://docs.github.com/en/graphql/overview/explorer). In the query, it is limited to show only the first one category, and you may increase the number if the category you want to use is not queried.

```graphql
query {
  repository(owner: "<repo-owner>", name: "<repository-name>") {
    id # RepositoryID
    name
    discussionCategories(first: 1) {
      nodes {
        id # CategoryID
        name
      }
    }
  }
}
```

```json
{
  "data": {
    "repository": {
      "id": "<repository-id>",
      "name": "<repository-name>",
      "discussionCategories": {
        "nodes": [
          {
            "id": "<catetory-id>",
            "name": "General"
          }
        ]
      }
    }
  }
}
```

Once the configuration is updated, we can see the *Comments* section appears correctly. We first need to sign in with GitHub to leave a comment.

![](comment-1.png#center)

Once signed in, the text area is enabled, and we can leave a comment.

![](comment-2.png#center)

The comment can also be checked on the *Discussion > General* of the repository and a reply can be made from it.

![](comment-3.png#center)

On the post page, we can see the reply

![](comment-4.png#center)

## Updates

### 2023-05-28

The Hugo version is updated to `0.112.3`, and the following changes are made.

1. A new docker images is used as the existing one doesn't support the updated Hugo version. As a result, the docker compose file is updated as following.

```yaml
version: "3.5"

services:
  hugo:
      image: peaceiris/hugo:v0.112.3-full
      command: server -D -F -E --poll 700ms --bind=0.0.0.0
      container_name: hugo
      volumes:
        - $PWD:/src
        - /etc/ssl/certs:/etc/ssl/certs
      ports:
        - "1313:1313"
```

2. The template module is updated to `v1.0.2`. As I don't have *go* installed, it is updated inside the new docker image.

```bash
$ docker run --rm -it -v $PWD:/src --entrypoint bash peaceiris/hugo:v0.112.3-full
## inside docker
root@<container-id>:/src# hugo mod get github.com/razonyang/hugo-theme-bootstrap@v1.0.2
root@<container-id>:/src# hugo mod npm pack
root@<container-id>:/src# npm update
## the changes will be committed on the host outside docker
root@<container-id>:/src# exit
$ git add go.mod go.sum package.json package-lock.json
$ git commit -m 'update them to v1.0.2'
```